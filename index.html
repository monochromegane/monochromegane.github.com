<!doctype html><html><head><meta name=generator content="Hugo 0.154.2"><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=author content><title>THINKING MEGANE</title><meta name=twitter:card content="summary"><meta name=twitter:site content="@monochromegane"><meta property="og:description" content="THINKING MEGANE"><meta property="og:title" content="THINKING MEGANE"><meta property="og:url" content="https://blog.monochromegane.com/"><meta property="og:image" content="https://blog.monochromegane.com/images/ogp.png"><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href='//fonts.googleapis.com/css?family=Source+Code+Pro' type=text/css><link rel=stylesheet href='//fonts.googleapis.com/css?family=Montserrat' type=text/css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/ir_black.min.css><link rel=stylesheet href=/css/text.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/layout.css><link rel=apple-touch-icon-precomposed sizes=57x57 href=/images/apple-touch-icon-57-precomposed.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/images/apple-touch-icon-114-precomposed.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/images/apple-touch-icon-72-precomposed.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=/images/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/images/favicon.ico><link rel=canonical href=https://blog.monochromegane.com/><link href=https://blog.monochromegane.com/index.xml rel=alternate type=application/rss+xml title="THINKING MEGANE"><script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML' async>MathJax.Hub.Config({HTML:["input/TeX","output/HTML-CSS"],TeX:{Macros:{bm:["\\boldsymbol{#1}",1],argmax:["\\mathop{\\rm arg\\,max}\\limits"],argmin:["\\mathop{\\rm arg\\,min}\\limits"]},extensions:["AMSmath.js","AMSsymbols.js"],equationNumbers:{autoNumber:"AMS"}},extensions:["tex2jax.js"],jax:["input/TeX","output/HTML-CSS"],tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},"HTML-CSS":{availableFonts:["TeX"],linebreaks:{automatic:!0}}})</script></head><body><div class=header><header><h1 class=logo><a href=https://blog.monochromegane.com/>THINKING MEGANE</a></h1><nav><ul class=menu><li><a href=/self-introduction/>Home</a></li><li><a href=/post/>Archives</a></li><li><a href=/diary/>Diary</a></li><li><a href=http://thinking-megane.blogspot.jp/>Old Blog</a></li></ul></nav></header></div><div class=container><div class=posts><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2026/01/03/dotfiles/>dotfilesを5年ぶりに整備した</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2026-01-03</div></time></header><div class=post-inner><p>なんとdotfilesも5年更新していなかった。
なにかと気忙しいのではあるが、木こりのジレンマに陥らないよう再起動していきたい。</p><p>さて、昨年末にMacbook Proを新調してまっさらな開発環境が手に入ったのに合わせてdotfilesを見直した。</p><ul><li><a href=https://github.com/monochromegane/dotfiles>monochromegane/dotfiles</a></li></ul><p>大きくは以下。</p><ul><li>dotfiles管理を<a href=https://www.chezmoi.io/>chezmoi</a>に変更</li><li>開発ツール管理を<a href=https://mise.jdx.dev/>mise</a>に変更</li><li>ターミナルエミュレーターを<a href=https://ghostty.org/>Ghostty</a>に変更</li></ul><p>以下、それぞれについて簡単にメモをしておく。</p><h2 id=chezmoi>chezmoi</h2><p>各ツールの設定などは大幅に変えていないのだが、dotfiles管理には<a href=https://www.chezmoi.io/>chezmoi</a>を導入した。
これまで自作インストールスクリプトは、メンテナンスできていなかったし、設定ファイルの変更後のリポジトリへの反映ルールのようなものがなく反映漏れなど生じていたので、これを機にchezmoiの流儀に任せることにした。</p><h3 id=設定ファイル>設定ファイル</h3><p>既存dotfilesがある場合、ファイルを<code>chezumoi add</code>していくと、chezmoiの命名規則に沿ったファイル名でリポジトリに加えていくことができる。
命名規則はホームディレクトリ以下のディレクトリもしくはファイル名のそれぞれについて<code>.</code>を<code>dot_</code>に置き換えたものになる。
例えば、<code>~/.config/zsh/.zshrc</code>であれば<code>dot_config/zsh/dot_zshrc</code>として管理する。</p><p>自分の場合は、このタイミングでXDG Base Directoryに合わせるようにもしたかったのと新しいPCで<code>~</code>が綺麗だったのもあり、chezmoi側（<code>chezmoi cd</code>で移動できるリポジトリのclone先。<code>~/.local/share/chezmoi</code>）で上記の命名に合わせて変更した上で、<code>chezmoi apply</code>をすることで反映する方法を取った。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ chezmoi init git@github.com:monochromegane/dotfiles.git
</span></span><span style=display:flex><span>$ chezmoi cd
</span></span><span style=display:flex><span>$ mv zshrc dot_config/zsh/dot_zshrc
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>snip<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>$ chezmoi apply
</span></span></code></pre></div><p>今もリポジトリへの反映を忘れないよう基本はchezmoi側で修正してapplyをする運用にしている。</p><p>なお、dotfiles内の実行権限が必要なファイルについてはファイルに属性付与ではなく、<code>bin/executable_git_diff_wrapper</code>のように命名規則で制御する必要がある。</p><h3 id=インストールスクリプト>インストールスクリプト</h3><p>chezmoiではインストールスクリプトも管理できる。
dotfilesリポジトリの直下におくこともできるが<code>.chezmoiscripts</code>という名前のディレクトリを作ると複数スクリプトがあっても整理されるのでこの構成を採用した。</p><p>管理用ツールを導入するからには動作確認の必要な自作スクリプトの役割は最低限にしたかったので、パッケージ管理ツールのインストールのみに抑え、各パッケージのインストールなどはパッケージマネージャーに任せるようにしている。</p><p>具体的には、ツールや開発環境のパッケージ管理のためのHomebrew、miseと、Vim用のミニマルなパッケージ管理である<a href=https://github.com/k-takata/minpac>minpac</a>だけをインストールしている。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ chezmoi cd
</span></span><span style=display:flex><span>$ ls .chezmoiscripts
</span></span><span style=display:flex><span>run_once_after_01_install-brew.sh   run_once_after_03_install-mise.sh
</span></span><span style=display:flex><span>run_once_after_02_install-minpac.sh
</span></span></code></pre></div><p>上記のような命名にすることで、apply後に一度だけスクリプトが順番に実行される。</p><h2 id=mise>mise</h2><p>開発環境やツール類はHomebrewで雑多に入れていたのと、言語ランタイムの<code>*env</code>系が増えてしまっていたのを整理すべく、<a href=https://mise.jdx.dev/>mise</a>に寄せることにした。</p><p>&ldquo;The front-end to your dev env"というコンセプト通り、開発環境構築に関連する多くのことができるのだが、ひとまずは、グローバルに各種言語ランタイムといくつかのツールを入れるようにしている。
ディレクトリごとに<code>mise.toml</code>を作って利用するツールを使い分けられるのはとても良さそう。</p><p>例えば、このブログで使っている<a href=https://gohugo.io/>hugo</a>コマンドなどはブログ用のリポジトリでだけ使えれば良いので<code>mise use go:github.com/gohugoio/hugo@latest</code>とすれば、そのディレクトリ配下では<code>~/.local/share/mise/installs/go-github-com-gohugoio-hugo/0.154.2/bin/hugo</code>がPATH環境変数に追加されてコマンドが認識される状態になる。</p><p>なお、caskが便利なのもあり、しばらくはBrewfileによるHomebrewと併用していくことになると思う。</p><h2 id=ghostty>Ghostty</h2><p>長年iTerm2を使っていて特に不満はなかったが、chezmoi導入にあたって設定をファイルで管理したくなり、Ghosttyを使ってみることにした。</p><p>&ldquo;Zero Configuration Philosophy"を謳っているだけあり、以下の設定で十分、動作も軽快で特に問題なく利用できている。念の為iTerm2もまだ入れているがこのまま乗り換えで良さそう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>command = /opt/homebrew/bin/zsh -l
</span></span><span style=display:flex><span>mouse-hide-while-typing = true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Theme
</span></span><span style=display:flex><span>theme = Dracula+
</span></span><span style=display:flex><span>background = #0f1015
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Title bar
</span></span><span style=display:flex><span>macos-titlebar-proxy-icon = hidden
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Font
</span></span><span style=display:flex><span>font-family = Moralerspace Neon
</span></span><span style=display:flex><span>font-thicken = true
</span></span><span style=display:flex><span>font-thicken-strength = 1
</span></span><span style=display:flex><span>font-feature = -dlig
</span></span><span style=display:flex><span>font-size = 15
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Cursor
</span></span><span style=display:flex><span>shell-integration-features = no-cursor
</span></span><span style=display:flex><span>cursor-style = block
</span></span><span style=display:flex><span>cursor-style-blink = false
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># TERM
</span></span><span style=display:flex><span>term = &#34;xterm-256color&#34;
</span></span></code></pre></div><h3 id=フォントとテーマ>フォントとテーマ</h3><p>せっかくなので、フォントやテーマも変更してみた。</p><p>Ghosttyの標準だと日本語表示が微妙だったので、フォントとして<a href=https://github.com/yuru7/moralerspace>Moralerspace</a>を導入し、<code>Neon</code>を設定し、上記設定にあるように太め大きめにしている。</p><p>また、テーマには、ダーク系のテーマでVim側ともマッチするものとして、<code>Dracula+</code>テーマを採用した。
<a href=https://draculatheme.com/ghostty>Dracula Theme for Ghostty</a>としてもあるが、標準で選択できるようになっている。
Vim側も<a href=https://draculatheme.com/vim>Dracula Theme for Vim</a>として公開されているので、minpackで以下のように設定を追加した。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vimrc data-lang=vimrc><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#a6e22e>minpac</span>#<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#39;dracula/vim&#39;</span>, {<span style=color:#e6db74>&#39;name&#39;</span>: <span style=color:#e6db74>&#39;dracula&#39;</span>})
</span></span></code></pre></div><p>テーマそのままだと背景がグレー寄りで個人的にはややぼやけたように見えてしまうので、Ghostty側で<code>background</code>を設定し、以下のようにctermbgをNoneにすることでGhostty側の背景色と同じにして統一感を出している。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vimrc data-lang=vimrc><span style=display:flex><span><span style=color:#75715e>&#34;colorschemeを設定する</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span>! <span style=color:#a6e22e>s</span>:<span style=color:#a6e22e>customize_dracula_bg</span>() <span style=color:#a6e22e>abort</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>highlight</span> <span style=color:#a6e22e>Normal</span>       <span style=color:#a6e22e>ctermbg</span>=<span style=color:#a6e22e>None</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>highlight</span> <span style=color:#a6e22e>CursorLine</span>   <span style=color:#a6e22e>ctermbg</span>=<span style=color:#a6e22e>None</span> <span style=color:#a6e22e>cterm</span>=underline
</span></span><span style=display:flex><span><span style=color:#66d9ef>endfunction</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>augroup</span> <span style=color:#a6e22e>DraculaCustomization</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>autocmd</span>!
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>autocmd</span> <span style=color:#a6e22e>ColorScheme</span> <span style=color:#a6e22e>dracula</span> <span style=color:#a6e22e>call</span> <span style=color:#a6e22e>s</span>:<span style=color:#a6e22e>customize_dracula_bg</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>augroup</span> <span style=color:#a6e22e>END</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>colorscheme</span> <span style=color:#a6e22e>dracula</span>
</span></span></code></pre></div><p>GhosttyでDraculaで、背景色<code>#0f1015</code>の青みがかった夜空みたいな色でコンセプト的にも統一できてなかなか気に入っている。</p><h2 id=その他>その他</h2><p>いわゆるコーディングエージェント系の設定も見直していってるが長くなるのでまた次回とする。</p><h2 id=後記的なもの>後記的なもの</h2><p>昨年、ブログを一本も書いていないことに気づいたのが今日。
年始に『<a href=https://www.kodansha.co.jp/book/products/0000415692>「書くこと」の哲学　ことばの再履修</a>』を読みながら、今回の記事のような、やったことや事実ベースの「書きえる」ことすら書かずして、何を書けようという気持ちからブログ再開してみたのであるが、ただ書き出すことの爽快さを思い出せてとても良かった。
気負わずに再開していきたい。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/></a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2024/12/31/2024/>2024</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2024-12-31</div></time></header><div class=post-inner><p>今年は、九州大学大学院システム情報科学府博士後期課程を修了し、博士（情報科学）の学位を授与されたことが、一番のハイライトだった。
指導くださった先生方、ペパボ研究所の皆さんをはじめとする同僚、切磋琢磨した社会人学生の皆さん、そして家族へ、改めて心から感謝したい。</p><p>達成感でいっぱいであるものの、年度中の博士論文執筆と事業への貢献の両立は、想像以上に大変だった。
研究においては元々、事業への貢献も求められるため、自身の専門領域から様々な分析や提案、実装を並行して進めていたが、博士論文の執筆中は、その複雑さと膨大さゆえに脳内のリソースを極限まで使い続ける日々であり、これまで以上に研究と実務の両立の難易度が高かったように思う。
それでも、最後までやり切ることができたことに、今はただ安堵している。
一方で、これらの分析や提案については、伝え方や巻き込む人々の選定をもっと考えることで、より事業成果につなげられたのではないかという反省もある。</p><p>来年は博士として、今の専門性に加え、さらに高い期待が寄せられる立場となるはずである。
不確実で混沌とした課題領域において、比較・体系化・言語化を通じて、誰もがその課題を共有し、迅速かつ効果的な対策を講じられる基盤を整えることが求められる。
このスキルを活かし、事業に携わる人々が互いの専門性を最大限に発揮し、成果につながる環境を作り上げることを目指していきたい。</p><p>振り返れば、多忙の連続であった一年で、正直なところ鮮明な記憶が残っていない。
それでも、この積み重ねや振り返りが今後の糧になると信じ、今後も一歩一歩進んでいきたい。
来年もどうぞよろしくお願いいたします。</p><h1 id=実績>実績</h1><p>以下、実績を列挙する。</p><h2 id=論文>論文</h2><p>博論と国際会議論文1本。本数としては少なくなってしまったが博論と並行して国際会議に投稿・発表し、博論の質を向上させることができたのは自身を褒めてあげたい。
来年はより水準の高い会議へも挑戦していきたい。</p><ul><li>三宅 悠介, 多様かつ継続的に変化する環境に適応する情報システム, 九州大学博士学位論文, 2024. <a href=https://speakerdeck.com/monochromegane/thesis-defense-presentation>[発表資料]</a></li><li>Yusuke Miyake, Ryuji Watanabe, Tsunenori Mine, <a href=https://ieeexplore.ieee.org/document/10633680>Online Nonstationary and Nonlinear Bandits with Recursive Weighted Gaussian Process</a>, The 48th IEEE International Conference on Computers, Software, and Applications (COMPSAC 2024), pp.11-20, Jul 2024. <a href=https://speakerdeck.com/monochromegane/online-nonstationary-and-nonlinear-bandits-with-recursive-weighted-gaussian-process>[発表資料]</a></li></ul><h2 id=国内発表>国内発表</h2><p>福岡で開催した技術イベントで1回（博論の公聴会を除く）。
来年は全国規模の技術イベントへの復帰を果たしたいところ。</p><ul><li>三宅 悠介 <a href=https://speakerdeck.com/monochromegane/fukuokago20-afa>Go言語でターミナルフレンドリーなAIコマンド、afaを作った</a>, <a href=https://fukuokago.connpass.com/event/330951/>Fukuoka.go#20</a>, 2024年10月.</li></ul><h2 id=oss>OSS</h2><p>AIを開発環境に取り込んでいくためのツール群を整えた。来年はもう一歩先の統合を目指したい。</p><ul><li><a href=https://github.com/monochromegane/afa>AFA - AFA is a terminal-friendly AI command.</a></li><li><a href=https://github.com/monochromegane/afa-tui>AFA-TUI - AFA-TUI is a rich Text User Interface for AFA.</a></li></ul><h2 id=コミュニティ活動>コミュニティ活動</h2><p>Fukuoka.goを再開できたのがよかった。いつの間にか10周年だったので来年3月ごろにお祝い的な会も開催を考えている。学会系では、研究会の運営委員を継続している。</p><ul><li><a href=https://fukuokago.connpass.com/event/330951/>Fukuoka.go#20</a></li></ul><h2 id=ブログ>ブログ</h2><p>3本。ここ数年に比べると増えた。OSS紹介、思い出、考えのまとめなど雑多な内容だが、博士課程が終わってとにかく思いついたら書くことができているので来年も継続的に書いていきたい。</p><ul><li><a href=https://blog.monochromegane.com/blog/2024/09/16/afa/>ターミナルフレンドリーなAIコマンド、afaを作った</a></li><li><a href=https://blog.monochromegane.com/blog/2024/10/05/doctor-information-science/>ペパボに入って12年が経った。気付けば博士になっていた</a></li><li><a href=https://blog.monochromegane.com/blog/2024/12/23/nakayoku/>みんなと仲良くすること</a></li></ul><h2 id=その他>その他</h2><p>研究所で開催した社内向けの勉強会の記事。来年はAI前提を踏まえこれらを事業にどんどん適用していく。</p><ul><li><a href=https://rand.pepabo.com/article/2024/03/28/ai/>AIを前提とした体験の実現に向けての勉強会を開催しました</a></li></ul><p>国際会議採択のニュースリリース。
来年はプレスリリース目指して頑張りたい。</p><ul><li><a href="https://pepabo.com/news/information/202404231200/?_gl=1*19uunue*_ga*MTM3Mjc5NzQyMC4xNzEzODUwNzk1*_ga_LER6JRTV8K*MTczNTY1MzAwMS42MC4xLjE3MzU2NTQ4MzcuMC4wLjA.#_ga=2.198738415.1525457293.1735640790-1372797420.1713850795">ペパボ研究所の論文がIEEEの国際会議「COMPSAC 2024」に採択</a></li></ul></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/%E3%81%B5%E3%82%8A%E3%81%8B%E3%81%88%E3%82%8A>ふりかえり</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2024/12/23/nakayoku/>みんなと仲良くすること</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2024-12-23</div></time></header><div class=post-inner><p>ここ数ヶ月、思うように成果が出なかったことに対するボスからのフィードバックを中心に自分なりに来年の仕事の指針としてまとめておく。</p><p>多くの事業では、環境の変化へ追従するためにプロジェクトの優先順位は目まぐるしく整理・最適化されていく。
また、近年では、データ駆動な意思決定、機械学習やAIのような新しい自動化の導入によって、事業に求められる水準も高度化している。
このような質・量ともに認知負荷の高い状況に対処するため、専門性を高めた分業やチーム体制が出来上がるのは必然である。
しかしながら、例え、各々が目的やビジョンを揃えていたとしても、皆が足並みを揃えて進むことは存外に難しい。
この要因として、分業した専門の観点ごとにゴールまでの過程における課題の内容や具体度が異なることが考えられる。
描く経路が異なれば、当然、足並みが揃うことはない。</p><p>よって、ある程度以上の規模や難易度の仕事を成功させるなら、関わる人々の間での関心度を高めないといけない。
しかし、分業による過程のカプセル化と無関心は紙一重である。
せっかく認知負荷を下げることができたのだから、わざわざ相手の事情を汲むような工程を挟まずに、阿吽の呼吸で足並みを揃えて進んでほしいと思いたくもなる。
それでもやはり、関わる範囲が広範囲だったり内容が高度になるに伴い、表面上の理解や想像による補完では立ち行かなくなってしまう。
だからこそ、互いの専門領域の広さと難しさを前提とし、労力を払って関心を維持することが仕事を成功させるために必要になってくる。</p><p>もちろん、全体としてのコミュニケーションコストを低減させるため、各々の専門領域に照らした道程について、聞き手に応じた表現で過不足なく効率的に伝えることが求められる。
そのために、伝えたいことを抽象的な概念上の枠組みに変換し、効率的に伝えるために図解をはじめとした表現方法を駆使するスキルが求められる。
発信側の労力も抑えるため、この実現にはAIも積極的に活用し、聞き手に応じたバリエーション生成まで即時に行える仕組みも構築したい。
また、関心は関係する人々がそれぞれ双方向に接続されている状態が望ましいが、返報性の原理を期待して、まずは制御可能な自身から関心を維持することを始めるのが良いだろう。</p><p>ペパボで大切にしている三つのことのうち一つに「みんなと仲良くすること」というものがある。
これを表面上の摩擦がない状態と捉えてしまうと無関心に通じてしまうので、仕事の達成を念頭において、伝えるべきことをしっかり伝えるというのが、自身のこれまでの理解であった。
ただ、これも一方向のコミュニケーションに過ぎず、ある種の無関心とも言えるのではないかと考え直したのが今回である。
今後は、仕事を達成するため、もう一段階踏み込んだ「みんなと仲良くすること」を常に意識的に実施していきたい。
そうすることで、無関心による安易な想像に起因する問題を回避したり、問題が生じたとしても、なぜ齟齬が発生しているのかを構造ベースで捉えて建設的に解決に進めることができると思う。</p><hr><p>実際はフィードバックは以下のように端的にまとめてくれていたのだが、自分なりの解釈に落とし込むために書いてみました。これぐらいズバッとまとめられるようになりたい。</p><p><img src=/images/2024/12/boss.png alt=feedback></p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/></a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2024/10/05/doctor-information-science/>ペパボに入って12年が経った。気付けば博士になっていた</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2024-10-05</div></time></header><div class=post-inner><p>先月、博士（情報科学）の学位を取得した。</p><p>12年前、<code>福岡 おもしろい it 会社</code>と検索をして、株式会社paperboy&amp;co.（現GMOペパボ株式会社）に運用開発エンジニアとして転職した時<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>からすると、予想だにしなかった状態である。
転機は2017年1月だった。
ペパボで切磋琢磨できる仲間に恵まれ、OSS活動や登壇を通したアウトプット、社内での成果を自負する一方で、社内でもレベルの高いエンジニアとの仕事の機会を通して、自分の限界も感じ始めていた。
そんな折、研究所の所長から研究職への打診があった。
確か、当時進めていたログ活用基盤の構築とその内容の研究所のコンセプトへの親和性からだったように記憶している。
感じていた限界を「コンピュータサイエンス」ってやつや「研究的アプローチ」ってやつで突破できるかもしれない、研究って何もわからないけれども何とかなるだろう、渡りに船だとばかりにこの誘いに乗ることにした。</p><p>結果、丸々二年間、滑稽なぐらい迷走した<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>。
「研究」をするぞと意気込みは空回りし、研究所の同僚からのアドバイスも虚しく、納得する成果を出せずに時間だけが過ぎ、短時間で効果が出るものを求め悪循環が始まった。
元来の己の精神的な弱さ、四十歳前後という年齢特有の焦り、人生最高潮に達したあらゆるものに対する固執が目を曇らせ、足を引っ張った。
長く暗い時期だったが、ほんとうにほんとうにありがたいことに、さまざまな人に支えられ、何度も内省を進めることでかろうじて持ち直していった。
研究所の同僚、エンジニアと研究者が集うWSA研<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>、研究者の先輩方、そして家族には感謝の念が尽きることはない。
それでも距離をおくことを選択した縁もあり、たくさん迷惑をかけてしまった。</p><p>「研究」は難しい。
これは高度という意味での難しさではなく、ソフトウェアによる課題解決とは目的が違うことに起因する難しさについてである。
博士課程を終えて、研究とは「人類が新たに学べる領域を作り出すこと」であると考えるようになった。
すなわち、ソフトウェアによる課題解決は、目的に連なる目標のうちの一つであり、その解決も含めて、新たに学べる状態に仕上げねばならない。
そして、後進が学べる状態であるには、どこがこれまでの方法と異なるのか、どれぐらいの効果があるのか、それらが主張とその裏付けという形で明確に述べられたかといった要件に落とし込まれる。
これは、論文における「新規性」「有用性」「了解性」の観点に対応し、論文を記述する際には、これらの観点を満たすための様々なサーベイやライティング手法を駆使して臨むことになる。
そのような過程を経ることで初めてそのアウトプットは、未来の誰かの手による学べる領域の更なる拡大を支えていくことができる。
落とし穴は、ソフトウェアによる課題解決を目標ではなく目的に据えてしまうことである。
ここに陥ると、課題の解決こそが研究であり、課題解決のみで研究であるためには、大層な水準の課題を解決せねばならないとなりかねない。
自分が最初に躓いたのはここではないかと思う。</p><p>この頃の自身の振り返りを読むと、感情との付き合い方<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>の他に、研究とは何かを手探りで模索している様子が見て取れる<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup> <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>。
解決したことを伝えていかないといけないのだな、そのためにはたくさんの根拠を示さないといけないのだな、だから一朝一夕じゃ無理で時間をかけて向き合うことが必要なんだな、程度の理解度ではあるものの、この辺りから前に進み出したのだろうと思う。
2020年6月に初めてジャーナルの採録通知を受け取り<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>、10月には社会人学生として九州大学大学院システム情報科学府博士後期課程へ社会人学生として進学した<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup>。
進学の後押しも研究所の所長だったと思う。
これまでの経緯もあり、及び腰だった自分に「研究職続けるなら博士号はあった方がいいし、いずれは取るのだから最短で効果が出せることをやったらいいんじゃないですか」と言われ、それもそうだなと挑戦を決めた。
暗中模索の中でも進めていた十本弱の研究報告やジャーナルの実績をもって修士を飛ばしての出願と入学が認められたこともあり、積み重ねは無駄じゃなかったなあ、ようしやるぞとここからは順風満帆。
といかないのがいかにも自分らしくて思い出しても苦笑してしまうのだが。</p><p>博士課程の修了には一定数の実績が必要となる。
自分の場合は、在学中に国内ジャーナル論文をもう一本、一定水準以上の国際会議での採択が一回が最低基準であった。
国内ジャーナルこそなんとか通せたものの、国際会議については、2021年5月の初投稿から丸二年、七回目の挑戦にしてようやくの採択となり長い我慢の時期を過ごした<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup>。
そんな中、指導教官は一貫して、研究という最短ルートはない道程において、同じ道を回ることなく、常に何かしらの前進という成果を得るためのアドバイスを与えてくれたと思う。
それは例えば「難しいものと認識した上でそれに挑戦する喜び」であったり「ダメだった場合は改善してただ次に行くだけ」であったり、「自分で決めて悔いのないように進む」こと、そして「結果に対して本質的な面白さを見出して言語化し、これまでの取り組みと有機的に関連づけていくこと」などである。
博士課程という自分の研究の型を体得していく中で、指導教官の存在は本当にありがたいものであった。
指導教官は、分野の専門性が重なっていることが望ましいが、それ以上に相性があると思うので、できれば共著を先に一度執筆するなどコミュニケーションを取れると良いと思う。
幸い、自分の場合は、進学前の共同研究の際に知り合うことができたのでこの点でも恵まれていたと思う。</p><p>とはいえ、博士課程は、自身で主体的に研究を推進しなければならない。
これは、博士課程が「人類が新たに学べる領域を作り出すこと」という研究を達成する、「その方法論を、特定の研究テーマに基づく実践を通して身につける課程」だからだと思われる。
新たに学べる領域を作り上げているのであるから、指導教官にとってもわからない部分を切り開いていくのであり、そしてその開拓の方法は、自身でやり方を模索していかなければならない。
主体性については、能動的に動くことが前提の社会人であれば特段問題にならないかと思う。
博士課程での大変さは、この研究を推し進めるやり方の模索に対するフィードバックが、アウトプットに対してのみ得られるという点だったと思う。
それは主に査読結果や、国際会議での発表に対する議論の形を取るが、いずれにせよ論文の形にまとめる必要がある。
これは研究を学ぶには研究をしなければならないという構造であり、研究テーマ自体も発展させなければならないことも相まって、随分鍛えられたと感じている。
幸い、指導教官のアドバイスはこれに即したものであり、博士論文に着手する前の三年間で研究報告や不採択のものも含めると十六本、おおよそ二、三ヶ月に一本は何かしら研究成果を出して論文執筆していたことになる。
成長が遅いのは仕方ないとはいえ、研究開発員として、事業への貢献も求められる中でも諦めずに課程を継続したことは自分を褒めてあげたい。</p><p>2024年4月には、追加でもう一つ国際会議に採択され、最終的に、入学前のジャーナル論文と合わせて計四本の実績をもとに、学位申請のための博士論文を執筆した<sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup>。
博論の執筆では、これまでの実績を「人類が新たに学べる領域」として再構成する。
四本の論文の整合性を取りながら、領域の世界観の確立も必要で、非常に難易度の高い執筆であり、実績達成以上にまだ大変な工程が残っているのかと驚いた。
しかしながら、この工程を通して初めて、ボトムアップな進め方であった自身の研究テーマに対し、トップダウンからの位置付けを与えることができたように思える。
実際に、自身の研究観である「人類が新たに学べる領域を作り出すこと」というのもこの段階を経て感じるようになった。
これまで各論文においても「新規性」「有用性」「了解性」の観点を満たせるよう突き詰めてきたが、複数論文をまとめる中で、それぞれの点が関連し、補い合う形で（まだ非常に狭いながら）初めて領域として形をなしていったように思う。
なお、世界観の確立については、ペパボ研究所のコンセプトである「なめらかなシステム」についての、所長との数年間に渡るディスカッションが非常に役立った。
このようなハイコンセプトな思考だけでなく実践的にも抽象的にも自在に観点を行き来しながら多面的に研究を見直す機会があるのがペパボ研究所の長所だと思う。
博士課程を考えている方はぜひ検討してほしい。
その後、公聴会を経て、2024年9月25日付けで博士（情報科学）の学位を授与された。
在学は四年間。
標準年度の三年には間に合わなかったが、なんとか修了に漕ぎ着けることができて安堵している。</p><p>さて、ここまでして博士課程を終了する必要はあったのか。そしてこれからも研究をする必要はあるのか。
サンクコストを差し引いたとしても、自分自身としては「はい」と答えたい。
「課題解決」と「研究（新たに学べる領域を作り出すこと）」は相補的な関係であり、それぞれの存在がお互いを必要としていると思う。
また、特にソフトウェアやエンジニアリングの分野においては、それぞれは明確に分離している訳でもないと思う。
研究的なアプローチによって、同じ課題に対しても体系化・一般化・言語化・比較整理などを通して、多面的に捉え直し、新しい観点からちょっと面白い発想が出るかもしれない。
研究による成果物によって、ある課題に対してある状況において有用な方式を広く適用できるかもしれない。
その方式がうまくいかない場合も、理論的な裏付けもしくは再現可能な部分評価を元に、そこから学んで最短で適用できる改善を思いつけるかもしれない。
学べる状態にするのは手間がかかる。
それでもどこかの誰かの巨人の肩になるのだと信じて、研究というのを仕事にする人がいても良いのではないかと思う。</p><p>もちろん、企業研究所に所属する研究員としては、より実践的に、博士課程で得たスキルを早速活用していきたい。
改めて、博士号を取得したということは、不確実で混沌とした課題領域においても、比較・体系化・言語化を通して、誰もがその課題を共有し、時間をかけることなく効果のある対策を講じられる基盤を整えられるスキルを持つ、すなわち、学べる領域を作り出せる人材であることが期待されるようになったのだと思う。
今後は、自身の研究テーマの推進はもちろんのこと、さまざまな施策において、所属する研究所のミッションである「研究開発により『事業を差別化できる技術』を生み出す」ことができるよう、さらに精進していきたい。
そして、これまで辛抱強く支えてくれたペパボに恩返ししていきたい。</p><p>ペパボに入社して十二年。
タイトルの「気付けば」も大袈裟ではなくて、特に研究職になってからは時間が飛ぶようにすぎていった。
それでも、いろんなことがあったけれども、誰かと比較してではなく、過去最高の自分に仕上がっているというのは四十三歳にしては悪くないのではないか。
これからも「虚仮の一念、岩をも通す」の精神で頑張っていきたい。</p><h3 id=お知らせ>お知らせ</h3><p>僕のキャリアを支援してくれたことからも分かるように、GMOペパボ株式会社はどうすればインターネットを面白くできるのか、これを真面目に考えてさまざまななやり方で取り組んでいます。
研究開発的なアプローチに対してでも良いですし、事業に対してでも大丈夫です。
こんなペパボに興味持たれた方、もっと雰囲気知りたい方、お気軽にお声がけください。</p><p><a href=https://rand.pepabo.com/>ペパボ研究所</a></p><h3 id=参考>参考</h3><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=/blog/2016/10/30/5th-year-at-pepabo/>ペパボに入って4年が経った</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=/blog/2017/12/31/2017/>2017年, 12月のライオン</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://websystemarchitecture.hatenablog.jp/>WSA研</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=/blog/2018/08/16/reason/>理性の人</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=/blog/2019/02/25/entrance-of-research/>わかるとわからないの間</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=/blog/2019/11/27/guidepost_for_writing_paper/>論文執筆の道しるべ</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><a href=/blog/2019/12/31/2019/>2019</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><a href=/blog/2020/06/28/my-first-journal/>ペパ研から研究をはじめてジャーナルでのアクセプトまでいけた日</a>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p><a href=/blog/2020/09/21/isee-kyushu-u/>九州大学大学院システム情報科学府博士後期課程に入学します</a>&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p><a href=/blog/2023/12/30/international-conference-struggles/>社会人大学院生の七転び八起き国際会議奮闘記</a>&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p><a href=https://rand.pepabo.com/article/2024/09/25/miyakey-doctor/>博士後期課程を修了し、博士（情報科学）の学位を授与されました</a>&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/%E5%8D%9A%E5%A3%AB%E5%BE%8C%E6%9C%9F%E8%AA%B2%E7%A8%8B>博士後期課程</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2024/09/16/afa/>ターミナルフレンドリーなAIコマンド、afaを作った</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2024-09-16</div></time></header><div class=post-inner><p>Go言語で、AIモデルに対する推論をコマンドラインで実行する<a href=https://github.com/monochromegane/afa>afa</a>というツールを作りました。入出力としてテキストストリームを前提としており、パイプやリダイレクトを用いて他のコマンドと連携しやすいのが特徴です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ echo $ERROR_MESSAGE | afa new -p <span style=color:#e6db74>&#34;What is happening?&#34;</span> /path/to/file1 /path/to/file2
</span></span></code></pre></div><p>与えるプロンプトやコンテキスト情報によってAIモデルが柔軟に振る舞いを変えてくれるので、これまでの個別ツールでは対応が難しかった用途における自動化にも有用でしょう。
また、テキストストリームを扱えるリッチなTUIのコマンド<a href=https://github.com/monochromegane/afa-tui>afa-tui</a>も別途提供しているので、ターミナル上でのチャットも快適です。</p><h2 id=デモ>デモ</h2><h3 id=リッチtuiによるチャット>リッチTUIによるチャット</h3><p>快適なインタラクティブチャットのため、Markdownを装飾して描画しつつ、<code>less</code>コマンド相当の操作感のページャーと、プロンプトの入力欄を持つViewerと連携できます。</p><p><img src=/images/2024/09/chat.gif alt=Chat></p><h3 id=zsh-line-editorzleを用いたターミナル上でのコマンド提案>Zsh Line Editor(ZLE)を用いたターミナル上でのコマンド提案</h3><p>ZLEと連携すれば、コマンドライン上でのプロンプトをそのまま提案されたコマンドに置き換えて実行できます。</p><p><img src=/images/2024/09/command_suggestion.gif alt="Command Suggestions"></p><h3 id=vim上でのコード提案>Vim上でのコード提案</h3><p>Vimと連携すれば、選択範囲のコードを提案されたものに置換できます。使い慣れたエディタであればdiff表示や差分の部分反映もお手のものですね。</p><p><img src=/images/2024/09/code_suggestion.gif alt="Code Suggestions"></p><h2 id=機能一覧>機能一覧</h2><ul><li>ターミナルフレンドリーなAIコマンドとして機能します。</li><li>リッチなターミナルユーザーインターフェース（TUI）を持つチャットクライアントとして機能します。</li><li>システムとユーザーのための文脈に応じたプロンプトをテンプレートを使用してサポートします。</li><li>プロンプト、標準入力、およびファイルパスを文脈として受け付けます。</li><li>セッションを管理し、<code>resume</code> サブコマンドを介して迅速に再開できるようにします。</li><li>安全にエスケープされたJSONオプションで構造化された出力をサポートし、他のコマンドとの統合を容易にします。</li><li>コアアプリケーションはサードパーティライブラリに依存せずに独立して動作します。</li><li>AIモデルとして<code>OpenAI</code>をサポートします（他のAIモデルのサポートは将来計画されています）。</li></ul><p>なお、この文章は、英語で書かれたafaのREADMEのFeatures項目をコピーして、<code>pbpaste | afa new -script -p "翻訳して" | pbcopy</code>で貼り付けました。便利ですね。</p><h2 id=基本的な使い方>基本的な使い方</h2><p>Viewerを使用しないシンプルなチャットを起動する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ afa new
</span></span></code></pre></div><p>Viewerを使用してチャットを起動する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ afa new -V
</span></span></code></pre></div><p>コンテキスト情報を加えてチャットを起動する。コンテキスト情報には「標準入力」「プロンプトメッセージ(-pオプションによるもの)」、そして「ファイルパス」を与えることができる。
ただし、仕様上、標準入力を与えるとキーボードからの入力を継続できないため、インタラクティブなチャットはできない。この場合は、プロセス置換（<code>&lt;()</code>）をファイルパスとして与えることを検討されたい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ echo $ERROR_MESSAGE | afa new -p <span style=color:#e6db74>&#34;What is happening?&#34;</span> /path/to/file1 /path/to/file2
</span></span><span style=display:flex><span><span style=color:#75715e># Please be cautious; when standard input is provided, interactive mode is disabled.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Consider using process substitution.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#=&gt; afa new -p &#34;What is happening?&#34; /path/to/file1 /path/to/file2 &lt;( echo $ERROR_MESSAGE )</span>
</span></span></code></pre></div><p>直近のセッションを再開する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ afa resume
</span></span></code></pre></div><p>指定したセッションを再開する。なお、<code>afa list</code>コマンドでセッション一覧を表示できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># The command `afa list` displays past sessions.</span>
</span></span><span style=display:flex><span>$ afa source -l SESSION_NAME
</span></span></code></pre></div><p>ユーザープロンプトを指定する。ユーザープロンプトは、Go言語のテンプレート形式であり、テンプレート内ではプリセットの値としてコンテキスト情報に対応する、<code>Message</code>、<code>MessageStdin</code>、そして <code>Name</code>と<code>Content</code>をメンバとする<code>File</code>構造体のリストである<code>Files</code>を以下のように呼べる。これにより動的なプロンプトの生成が可能となる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># `Message`, `MessageStdin`, and `Files` that include `File` with `Name` and `Content` members can be used in the template file.</span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;Please explain the following.\n{{ (index .Files 0).Content }}&#34;</span> &gt; CONFIG_PATH/templates/user/explain.tmpl
</span></span><span style=display:flex><span>afa -u explain /path/to/file
</span></span></code></pre></div><p>スクリプトモードを指定して起動する。コマンドライン実行に適したモードのオプション設定を一括で行う<code>-script</code>オプションを指定することで、他のコマンドとの連携が容易になる。具体的には<code>-I=false -H=false -S=false -V=false -L=false</code>が設定される。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>pbpaste | afa new -script -p <span style=color:#e6db74>&#34;Transrate this&#34;</span> | pbcopy
</span></span></code></pre></div><p><code>OpenAI</code>の独自機能として提供される<code>Structured Output</code>用のスキーマを指定できる。これは指定したJSON構造体に沿うような出力を強制する機能である。例えば、余分な説明が不要なコマンド提案などに適している。
クオート文字のエスケープを担う<code>-Q</code>オプションと合わせて使うことで<code>jq</code>による整形が容易になるので活用されたい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat <span style=color:#f92672>&lt;&lt;&lt;</span> EOS &gt; CONFIG_PATH/schemas/command_suggestion.json
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;properties&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;suggested_command&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;additionalProperties&#34;</span>: false,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;required&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;suggested_command&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>EOS
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ P<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;List Go files from the directory named &#39;internal&#39; and print the first line of each file.&#34;</span>
</span></span><span style=display:flex><span>$ afa new -script -Q -j command_suggestion -p $P | jq <span style=color:#e6db74>&#39;. | fromjson&#39;</span> | jq -r <span style=color:#e6db74>&#39;.suggested_command&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#=&gt; find internal -name &#39;*.go&#39; -exec head -n 1 {} \;</span>
</span></span></code></pre></div><h2 id=実践例>実践例</h2><p>実践例を列挙します。
もし使いたい例があれば、GitHubのリポジトリの<a href="https://github.com/monochromegane/afa?tab=readme-ov-file#practical-examples">README</a>にプロンプトや設定例と共に載せているので参考にしてみてください。</p><ul><li>Zsh Line Editor(ZLE)を用いたターミナル上でのコマンド提案<ul><li>デモで紹介したものです</li></ul></li><li>Vim上でのコード提案<ul><li>これもデモで紹介したものです</li></ul></li><li>ターミナルに表示されたエラーメッセージの分析<ul><li><code>tmux</code>の<code>capture-pane</code>を使って直近の実行結果を分析できます。複数行にわたるエラーメッセージのコピペの手間が省けて便利ですね</li></ul></li><li>GitHubのプルリクエストの自動生成<ul><li><code>git diff</code>と<code>git log</code>の情報を元にタイトルと要約を生成してプルリクエストを開きます。ZLEを想定しているので背景情報も踏まえて考えてもらえるようになっています。また、既存のテンプレートの上に要約を差し込む形にしているので、どのリポジトリでも使いやすいかなと思います。</li></ul></li><li>pecoを用いたセッションの絞り込みと読み込み<ul><li>インタラクティブな絞り込みで素早く過去のセッションにアクセスできます。</li></ul></li></ul><h2 id=afa>AFA</h2><p>AFAは<code>AI for All</code>の略で、あらゆるコマンドラインツールに対して連携可能（$\forall x \in X , \exists \mathrm{AI}(x)$、つまりコマンドラインツールの集合<code>X</code>の全ての要素<code>x</code>に対し、その結果を入力とする<code>AI(x)</code>な組み合わせが存在する）なAIコマンドになるといいなと思って付けた名前です。</p><p>現時点でもまだViewerの入力欄が不調になることがあったりWindowsでの動作確認ができていないなど課題はありますが、通常使う分には十分な品質になったと思うので公開しました。よく使うオプションセットをconfigに設定し、いくつかのユーザープロンプトを登録しておいて<code>alias af='afa new'</code>とするだけで、個人的には、調べ物やチャットを含め、ブラウザの利用頻度がかなり減ったことを実感しています。</p><p>Homebrewによるインストール<code>brew install monochromegane/tap/afa monochromegane/tap/afa-tui</code>も提供していますので、よければ使ってみてください。</p><p>将来的には、サーバー上での異常検知のような定式化の難易度が高いタスクでの適用も検討しています（サードパーティー製ライブラリへの非依存とViewerツールとの分離は、そのためでもあります）。AFAであれば、他のコマンドラインツールとの親和性を活かして、通知やロギングは従来の仕組みも活用できると考えています。適用例など共有してもらえたら嬉しいです。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/></a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2023/12/30/international-conference-struggles/>社会人大学院生の七転び八起き国際会議奮闘記</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2023-12-30</div></time></header><div class=post-inner><p>2023年10月に初めてのアカデミックな国際会議での発表を終えました。
社会人博士課程に進学後、2021年5月の初投稿から丸2年、7回目の挑戦にしてようやくの採択ということで、自慢できるものではないのですが、同様に博士課程において日々挑戦している方々に何かの参考になればと思い、まとめておきます。</p><h1 id=略歴と背景>略歴と背景</h1><p>2017年から<a href=https://rand.pepabo.com/>ペパボ研究所</a>で研究開発職に従事しています。
情報システムの自律適応等の研究に取り組み、<a href=/blog/2020/09/21/isee-kyushu-u/>2020年10月に社会人博士課程に進学</a>しました。
博士課程では、多様かつ継続的に変化する環境に適応する実用的な情報システムの実現に向けて、多腕バンディット方策を用いる機構の研究を進めています。</p><p>修士を飛ばした進学であったこともあり、進学時の実績としては<a href=/blog/2020/06/28/my-first-journal/>国内ジャーナル論文1本</a>のみでしたので、博士号取得に向けてはジャーナル論文をもう1本と、水準を満たす国際会議での採択1本を目指しての挑戦となりました。</p><h1 id=年表>年表</h1><p>以下に挑戦した国際会議とその結果について時系列にまとめました。</p><h2 id=recsys2021-reject>RecSys2021 (Reject)</h2><p>2021/05投稿。
提案手法において変化する環境への適応能力を向上させるべく進学後に試行錯誤した結果をまとめたものを投稿。</p><p>2021/07不採択通知。
Review結果は5点中、1点4点2点2点2点と散々でした。
総評としてはアイディアやアプローチの萌芽は理解できるが、それらを納得させるような位置付けや妥当性の説明が不十分であるというもの。
この時点では、国際会議に向けての<a href=/blog/2021/05/15/survey-method/>集中的サーベイ</a>や、初めての英語論文を書き上げるのに精一杯で、論文としてまだ議論の土台に立てていなかったと思います。</p><h2 id=wsdm2022-reject>WSDM2022 (Reject)</h2><p>2021/08投稿。
前回のRecSys2021の指摘事項を踏まえ、記述を見直して投稿。
当初は前回投稿に対するレビュアーからの指摘事項を個別に反映しただけでしたが、指導教官より、研究の位置付けが明確になるよう全体を通した見直しはどうですかとアドバイスをいただき、導入や関連研究を中心に大幅にリライトして投稿。</p><p>2021/10不採択通知。
Review結果は、Weak rejectが3名、Rejectが1名でまだまだ採択には遠かったです。
それでも、総評には、サーベイの充実度や記述の了解性に対する前向きなコメントが多く、前進が感じられました。
なお、分野のexpertからは、提案の新規性や理論的な裏付け、もう一歩踏み込んだ評価の必要性などが指摘されています。</p><h2 id=sac2022-rs-track-reject>SAC2022 RS Track (Reject)</h2><p>2021/10投稿。
前回のWSDM2022の指摘のうち、提案手法を維持したまま対応できる部分を記述面で更新して投稿。</p><p>2021/12不採択通知。
Review結果は、スコアが明記されていないもののReject寄りのコメントが2名、Accept寄りのコメントが1名でした。
採択に多少は近づいたように感じられるものの、総評としては前回とほぼ同様であり、次の提案方式の検討も進んでいたことから、この方式での国際会議への挑戦はここで一旦終えています。</p><p>なお、この方式については、国内の論文誌に投稿し、無事採択されました（2本目の国内ジャーナル論文の実績）。
その査読においても新規性・有用性に関しての議論は行われ、採録条件に応える中で、これらを向上させることができたと思います。</p><h2 id=cikm2022-reject>CIKM2022 (Reject)</h2><p>2022/05投稿。
提案手法において変化する環境への適応能力とオンライン性能を両立させるための方式を検討したものを投稿。
先んじて国内研究会で途中経過をまとめる機会があったこと、前年の執筆経験が蓄積されていることもあり、同様に新規書き下ろしであったRecSys2021の時よりも短い期間で投稿できました。</p><p>2022/08不採択通知。
Review結果は、Weak rejectが1名、Weak acceptが2名で、メタの判断によっては採択されていたかもしれず、惜しいと感じました。
総評は、研究の位置付けやアプローチの妥当性、記述の了解性に対しては一定の水準を満たすものの、手法の有効性を示すための評価方法の改善を求める指摘が多くありました。
前年と比べて手法自体の新規性の観点では認められつつあるなと感じるものの、その有用性を示すための工夫をどうするべきか考えあぐねていた時期だったと思います。</p><h2 id=aamas2023-reject>AAMAS2023 (Reject)</h2><p>2022/10投稿。
前回のCIKM2022の通知を待つ間に、提案手法に関連するサーベイが進んだこともあり、位置付けの補強を兼ねて、それらを盛り込み、イントロダクションと関連研究を中心にリライトして投稿。</p><p>2023/01不採択通知。
Review結果は、Weak paperが1名、Decent paperが2名。
総評としては、やや厳し目で、了解性や位置付けに関する指摘が再発してしまいました。
おそらく追加的なサーベイを自身で消化しきれておらず、結果的に解決したい課題に対して不要に広い議論となってしまったのではないかと考えています。
また、前回の有用性をどう示すかという指摘についても、具体的な解決策を検討できないまま、記述で頑張ろうとしてしまったのも不明瞭になった遠因かもしれません。</p><p>この時期は、なかなか国際会議に採択されないため、博論執筆に向けた実績を満たせないことに対する焦りが募っていきました。</p><h2 id=pakdd2023-reject>PAKDD2023 (Reject)</h2><p>2022/12投稿。
AAMAS2023への投稿と並行して、提案手法のもう一つの要素技術についてコンセプト的な実装と評価を進めていたものを投稿。</p><p>2023/02不採択通知。
Review結果は、Weak rejectが2名、Weak acceptが2名でした。
総評は、課題と提案の位置付けや妥当性は納得できるものの、提案の新規性に関する疑問があるとのことで、課題に対する提案手法の検討の甘さが見透かされたように思えます。</p><h2 id=smc2023-accept>SMC2023 (Accept!)</h2><p>2023/04投稿。
研究としてはAAMAS2023の手法とPAKDD2023の手法が二つ並行している状態でしたが、まずは提案として完成しているAAMAS2023の手法を着地させるべく投稿。
一度、PAKDD2023の研究で離れたことが功を奏したのか、改めて関連文献を読み込む機会を通して知識の再整理が進み、提案手法の課題設定と採用するアプローチにおいて無理なく接続できるような定式化と説明ができたと喜んだ記憶があります。
また、執筆中に最新のサーベイで類似手法が見つかって焦る場面もありましたが、提案手法との差異を検討する中で結果的に提案の新規性の主張が明確にできたのでよかったです。</p><p>2023/06採択通知。
Review結果は、スコアが明記されていないもののAccept寄りのコメントが3名、Reject寄りのコメントが1名でした。
総評では、研究や提案の位置付け、記述の明快さなどについて前向きなコメントがあり、新規性の多寡についての議論も若干ありました。
一方で、有用性や評価に関する不足のコメントがほぼ見られなかったのは興味深かったです。
これは定式化を進め、課題設定や解決する部分についての曖昧性が減少したことで、最小限の記述で過不足ない評価内容について、査読者と認識を揃えることができたためではないかと考えています。
この論文の執筆を通して、改めて、査読者のコメントを局所的に解釈するのではなく、その疑問が発生する根本について対局的にみて解決していくことの重要性を感じました。
これは2度目のWSDM2022への投稿時に指導教官からのアドバイスそのものであり、ようやく自分のものとすることができた時だったのかなと思えます。</p><h1 id=まとめ>まとめ</h1><p>国際会議への長い挑戦を通して、研究を世界的な基準で議論できる水準まで押し上げていくのは一朝一夕にできるものではないのだなあと感じました。
自分の場合は、自身の研究の発展はもちろんのこと、研究を推し進めていく力を高めたいと考え、博士後期課程へ挑戦したこともあり、研究自体と研究力を同時に前進させる必要があり、特に時間がかかってしまっているのだろうと思います。
すぐ成果が出るものではないと頭では分かっているつもりでしたが、やはり2年間全く結果が出なかったというのは心理的な負担が大きかったです。
特に、研究開発員として、事業への貢献も求められる中、不採択による論文執筆期間の延長は、各種施策のスケジュールにも影響するため、とても心苦しい思いをしました。</p><p>そのような中でも、最初の国際会議の採択に漕ぎ着けることができたのは、ひとえに指導教官、研究所の仲間、そして会社の皆様の支援のおかげだと考えています。
本当にありがとうございます。</p><p>最後に、自分にとって研究は「<a href=/blog/2017/12/31/2017/>自分の思い描く世界に至るための過程</a>」であり、そのためには問題に向き合い続けることが大切だと考えています。
問題に向き合い続けるには、行き詰まらないよう多面的に見ることが重要です。
とは言え、博士課程の進学前は、多面的にあれこれ手を出すことはできていたものの、どこかでやりきれなかったり発散してしまっていたように思えます。
しかし、博士課程の進学後は、指導教官からの指導の中で、絶対に止まらない方法、収束させる方法というのを体得できているように感じます。
それは例えば、「難しいものと認識した上でそれに挑戦する喜び」であったり「ダメだった場合は改善してただ次に行くだけ」であったり、「自分で決めて悔いのないように進む」こと、そして「結果に対して本質的な面白さを見出して言語化し、これまでの取り組みと有機的に関連づけていくこと」などです。
これらはつまり、研究という最短ルートはない道程において、同じ道を回ることなく、常に何かしらの前進という成果を得るための能力です。
現在は、2回目の国際会議に向けてPAKDD2023に挑戦した時の手法を一層発展させたものを投稿中です。
この論文の取り組みは、国際会議の実績を得た後に更に取り組んだもので、継続的な研究が常態となったことを示すものなのかなと思っています。</p><p>来年はおそらく博論に着手できる状態ですので、4年目に突入してしまいましたが博士号を確実に取得できるよう精一杯頑張ります。
そして、このように時間をかけて体得してきた研究と研究力の、支えてくれた皆様への還元を始めていきたいです。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/%E5%8D%9A%E5%A3%AB%E5%BE%8C%E6%9C%9F%E8%AA%B2%E7%A8%8B>博士後期課程</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2022/09/11/kernel-ridge-regression/>カーネルリッジ回帰 入門</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2022-09-11</div></time></header><div class=post-inner><p>基底関数を用いた線形回帰モデルのように入力に非線形な変換を施してモデルの表現力の向上を図る手法では、以下の2つの問題が発生する。</p><ol><li>特徴ベクトルの次元数の増加に伴う計算量の増加</li><li>予測に有用な基底関数の選定</li></ol><p>カーネルリッジ回帰は、カーネル関数を用いて上記の課題を解決する。
このエントリは、このカーネルリッジ回帰を最初に学んだ際の内容を自分なりにまとめたものである。</p><p>以下では、はじめに、記法の整理を兼ねて基本的な線形回帰モデルを説明する。
次に、カーネル法を用いた線形回帰であるカーネルリッジ回帰の説明を通して上記の課題の解決アプローチを学ぶ。
最後に、カーネル法における計算量の課題を解決するためのアプローチである、Random Fourier Featuresも紹介する。</p><h2 id=1-線形回帰モデル>1. 線形回帰モデル</h2><p>線形回帰モデルの問題設定と解法について述べる。
いま、$N$個の入力$X=(\boldsymbol{x}_1,\ldots,\boldsymbol{x}_N)^{\top} \in \mathbb{R}^{N \times D}$と出力$\boldsymbol{y}=(y_1,\ldots,y_N)^{\top} \in \mathbb{R}^{N}$が与えられている。
このとき、$y$は$\boldsymbol{x}$を入力とした線形回帰モデル$\hat{y} = \boldsymbol{w}^{\top}\boldsymbol{\phi}(\boldsymbol{x})$の出力として得られると仮定する。
ここで、$\boldsymbol{\phi}(\boldsymbol{x}) = (\phi_1(\boldsymbol{x}),\ldots,\phi_F(\boldsymbol{x}))^{\top} \in \mathbb{R}^{F}$は$F$個の基底関数$\phi: \mathbb{R}^{D} \rightarrow \mathbb{R}$からなる特徴ベクトル、$\boldsymbol{w} \in \mathbb{R}^{F}$はこれに対応する係数ベクトルである。
このとき、この係数ベクトル$\boldsymbol{w}$を推定することが本問題の目標である。</p><p>推定には最小二乗法を用いる。
なお、実用上は汎化性能の考慮から正則化を施すことが多いと思われるので、これを適用した<strong>リッジ回帰</strong>を行う。
すなわち、$\Phi = (\boldsymbol{\phi}(\boldsymbol{x}_1),\ldots,\boldsymbol{\phi}(\boldsymbol{x}_N))^{\top} \in \mathbb{R}^{N \times F}$としたとき、学習データに対する誤差の二乗和（に正則化項を加えたもの）$E(\boldsymbol{w}) = \| \Phi \boldsymbol{w} - \boldsymbol{y} \|^2 + \lambda \| \boldsymbol{w} \|^2$を最小化する$\boldsymbol{w}$を求める。</p><p>このために、まず$E(\boldsymbol{w})$を次のように整理する。</p><p>\begin{align}
\begin{split}
E(\boldsymbol{w}) &= (\Phi \boldsymbol{w} - \boldsymbol{y})^{\top}(\Phi \boldsymbol{w} - \boldsymbol{y}) + \lambda\boldsymbol{w}^{\top}\boldsymbol{w} \\
&= ((\Phi \boldsymbol{w})^{\top} - \boldsymbol{y}^{\top})(\Phi \boldsymbol{w} - \boldsymbol{y}) + \lambda\boldsymbol{w}^{\top}\boldsymbol{w}\\
&= ( \boldsymbol{w}^{\top}\Phi^{\top} - \boldsymbol{y}^{\top})(\Phi \boldsymbol{w} - \boldsymbol{y}) + \lambda\boldsymbol{w}^{\top}\boldsymbol{w}\\
&= \boldsymbol{w}^{\top}\Phi^{\top}\Phi\boldsymbol{w} - \boldsymbol{w}^{\top}\Phi^{\top}\boldsymbol{y} - \boldsymbol{y}^{\top}\Phi\boldsymbol{w} + \boldsymbol{y}^{\top}\boldsymbol{y} + \lambda\boldsymbol{w}^{\top}\boldsymbol{w}\\
&= \boldsymbol{w}^{\top}\Phi^{\top}\Phi\boldsymbol{w} - \boldsymbol{w}^{\top}\Phi^{\top}\boldsymbol{y} - \boldsymbol{w}^{\top}\Phi^{\top}\boldsymbol{y} + \boldsymbol{y}^{\top}\boldsymbol{y} + \lambda\boldsymbol{w}^{\top}\boldsymbol{w}\\
&= \boldsymbol{w}^{\top}\Phi^{\top}\Phi\boldsymbol{w} - 2\boldsymbol{w}^{\top}\Phi^{\top}\boldsymbol{y} + \boldsymbol{y}^{\top}\boldsymbol{y} + \lambda\boldsymbol{w}^{\top}\boldsymbol{w}.
\label{eq:ew}
\end{split}
\end{align}</p><p>整理には、行列の定理$(AB)^{\top}=B^{\top}A^{\top}$と、スカラーは転置しても値が同じであることを利用した（$\boldsymbol{y}^{\top}\Phi\boldsymbol{w} = (\boldsymbol{y}^{\top}\Phi\boldsymbol{w})^{\top} = \boldsymbol{w}^{\top}\Phi^{\top}\boldsymbol{y}$）。</p><p>次に、$E(\boldsymbol{w})$を最小化する$\boldsymbol{w}$を求めるために$\boldsymbol{w}$について偏微分して0とおく。</p><p>\begin{align}
\frac{\partial E(\boldsymbol{w})}{\partial \boldsymbol{w}} &= 2\Phi^{\top}\Phi\boldsymbol{w} -2\Phi^{\top}\boldsymbol{y} + 0 + 2\lambda\boldsymbol{w} = 0.
\end{align}</p><p>偏微分には、対称行列（$A=\Phi^{\top}\Phi=A^{\top}$）に対する二次形式（$\boldsymbol{w}^{\top}A\boldsymbol{w}$）の$\boldsymbol{w}$の偏微分が$(A + A^{\top})\boldsymbol{w} = 2A\boldsymbol{w}$であること、$\boldsymbol{w}^{\top}\boldsymbol{a}, \boldsymbol{a}=\Phi^{\top}\boldsymbol{y}$としたときの$\boldsymbol{w}$の偏微分が$\boldsymbol{a}$であることを利用した。</p><p>最後に、$\boldsymbol{w}$について整理する。</p><p>\begin{align}
\begin{split}
2\Phi^{\top}\Phi\boldsymbol{w} -2\Phi^{\top}\boldsymbol{y} + 2\lambda\boldsymbol{w} &= 0\\
2\Phi^{\top}\Phi\boldsymbol{w} + 2\lambda\boldsymbol{w} &= 2\Phi^{\top}\boldsymbol{y}\\
\Phi^{\top}\Phi\boldsymbol{w} + \lambda\boldsymbol{w} &= \Phi^{\top}\boldsymbol{y}\\
(\Phi^{\top}\Phi + \lambda I_F)\boldsymbol{w} &= \Phi^{\top}\boldsymbol{y}\\
\boldsymbol{w} &= (\Phi^{\top}\Phi + \lambda I_F)^{-1}\Phi^{\top}\boldsymbol{y}.
\label{eq:w}
\end{split}
\end{align}</p><p>ここでは、行列のサイズが$F \times F$の単位行列を$I_{F}$と表記した。</p><p>新しい入力$\boldsymbol{x}$に対する出力は推定した$\boldsymbol{w}$を用いて、$\hat{y} = \boldsymbol{w}^{\top}\boldsymbol{\phi}(\boldsymbol{x})$と予測できる。</p><h2 id=2-カーネル法による線形回帰モデル>2. カーネル法による線形回帰モデル</h2><p>上述の線形回帰モデルを利用する際には、基底関数を増やし多くの特徴量の候補から予測に有用なものに重み付けできれば良いと考えられることから、特徴ベクトルの次元数$F$を増やすアプローチが検討される。
しかしながら、この場合、パラメータ$\boldsymbol{w}$の推定や出力$\hat{y}$の予測に必要な計算量も同時に増加してしまう。
そこで、カーネル法による線形回帰モデルでは、パラメータの次元数を$N$に抑えるようなアプローチをとる。
これは、学習データ数$N$が特徴ベクトルの次元数$F$よりも少ない場合に有効である。
また、線形回帰モデルにはもう一つ、予測に対して有用な基底関数の種類や数が明らかではないという課題がある。
これに対しカーネル法による線形回帰モデルは、カーネル関数を導入することで、基底関数の選定を省略することができる。</p><p>以下、上述のリッジ回帰にカーネル法を適用した<strong>カーネルリッジ回帰</strong>を説明する。</p><h3 id=21-線形回帰モデルの双対表現>2.1. 線形回帰モデルの双対表現</h3><p>パラメータの次元数を$N$に抑えるため、$F$次元の$\boldsymbol{w}$についての線形モデル$\hat{y} = \boldsymbol{w}^{\top}\boldsymbol{\phi}(\boldsymbol{x})$を、$N$個の学習データ$\Phi$に対応するパラメータ$\boldsymbol{\alpha} \in \mathbb{R}^{N}$で表現することを考える。</p><p>そのために、式\eqref{eq:w}の3行目以降の変形を以下のように進める。</p><p>\begin{align}
\begin{split}
\Phi^{\top}\Phi\boldsymbol{w} + \lambda\boldsymbol{w} &= \Phi^{\top}\boldsymbol{y}\\
\lambda\boldsymbol{w} &= - \Phi^{\top}\Phi\boldsymbol{w} + \Phi^{\top}\boldsymbol{y}\\
\lambda\boldsymbol{w} &= - \Phi^{\top}(\Phi\boldsymbol{w} - \boldsymbol{y})\\
\boldsymbol{w} &= - \frac{1}{\lambda} \Phi^{\top}(\Phi\boldsymbol{w} - \boldsymbol{y}).
\end{split}
\end{align}</p><p>ここで$\boldsymbol{\alpha} = - \frac{1}{\lambda}(\Phi\boldsymbol{w} - \boldsymbol{y})$とすると、$\boldsymbol{w} = \Phi^{\top}\boldsymbol{\alpha}$となる。
これにより、元の線形回帰モデルを$\hat{y} = (\Phi^{\top}\boldsymbol{\alpha})^{\top}\phi(\boldsymbol{x})$と、（右辺にも$\boldsymbol{w}$は含まれるが）見かけ上は$\boldsymbol{w}$を含まない形で表現できるようになった（<strong>双対表現</strong>）。</p><p>この双対表現の線形回帰モデルについて、最小二乗法を用いて$\boldsymbol{\alpha}$を推定する。
これは上述の$E(\boldsymbol{w})$を双対表現の線形回帰モデルで記述し、解を求めることと同等である。</p><p>このために、式\eqref{eq:ew}に$\boldsymbol{w} = \Phi^{\top}\boldsymbol{\alpha}$を代入し$\boldsymbol{\alpha}$についての関数$E(\boldsymbol{\alpha})$とした上で、以下のように整理する。</p><p>\begin{align}
\begin{split}
E(\boldsymbol{\alpha}) &= (\Phi^{\top}\boldsymbol{\alpha})^{\top}\Phi^{\top}\Phi(\Phi^{\top}\boldsymbol{\alpha}) - 2(\Phi^{\top}\boldsymbol{\alpha})^{\top}\Phi^{\top}\boldsymbol{y} + \boldsymbol{y}^{\top}\boldsymbol{y} + \lambda(\Phi^{\top}\boldsymbol{\alpha})^{\top}(\Phi^{\top}\boldsymbol{\alpha})\\
&= \boldsymbol{\alpha}^{\top}\Phi\Phi^{\top}\Phi\Phi^{\top}\boldsymbol{\alpha} - 2\boldsymbol{\alpha}^{\top}\Phi\Phi^{\top}\boldsymbol{y} + \boldsymbol{y}^{\top}\boldsymbol{y} + \lambda\boldsymbol{\alpha}^{\top}\Phi\Phi^{\top}\boldsymbol{\alpha}\\
&= \boldsymbol{\alpha}^{\top}KK\boldsymbol{\alpha} - 2\boldsymbol{\alpha}^{\top}K\boldsymbol{y} + \boldsymbol{y}^{\top}\boldsymbol{y} + \lambda\boldsymbol{\alpha}^{\top}K\boldsymbol{\alpha}.
\end{split}
\end{align}</p><p>なお、
\[
K = \Phi\Phi^{\top} =
\begin{pmatrix}
\boldsymbol{\phi}(\boldsymbol{x}_1)^{\top}\boldsymbol{\phi}(\boldsymbol{x}_1) & \ldots & \boldsymbol{\phi}(\boldsymbol{x}_1)^{\top}\boldsymbol{\phi}(\boldsymbol{x}_N) \\
\vdots & \ddots & \vdots \\
\boldsymbol{\phi}(\boldsymbol{x}_N)^{\top}\boldsymbol{\phi}(\boldsymbol{x}_1) & \ldots & \boldsymbol{\phi}(\boldsymbol{x}_N)^{\top}\boldsymbol{\phi}(\boldsymbol{x}_N)
\end{pmatrix} =
\begin{pmatrix}
k(\boldsymbol{x}_1,\boldsymbol{x}_1) & \ldots & k(\boldsymbol{x}_1,\boldsymbol{x}_N) \\
\vdots & \ddots & \vdots \\
k(\boldsymbol{x}_N,\boldsymbol{x}_1) & \ldots & k(\boldsymbol{x}_N,\boldsymbol{x}_N)
\end{pmatrix}
\in \mathbb{R}^{N \times N}
\]
とした。
ここで、入力$\boldsymbol{p}$と$\boldsymbol{q}$を$\boldsymbol{\phi}$によって特徴ベクトルに変換し内積をとる操作である$k(\boldsymbol{p},\boldsymbol{q})$をカーネル関数と呼ぶ。
また、学習データ$X$に対する全ての組み合わせである$K$をグラム行列と呼ぶ。</p><p>次に、$E(\boldsymbol{\alpha})$を最小化する$\boldsymbol{\alpha}$を求めるために$\boldsymbol{\alpha}$について偏微分して0とおく。</p><p>\begin{align}
\begin{split}
\frac{\partial E(\boldsymbol{\alpha})}{\partial \boldsymbol{\alpha}} &= 2KK\boldsymbol{\alpha} - 2K\boldsymbol{y} + 0 + 2\lambda K\boldsymbol{\alpha}= 0.
\end{split}
\end{align}</p><p>最後に、$\boldsymbol{\alpha}$について整理する。</p><p>\begin{align}
\begin{split}
2KK\boldsymbol{\alpha} - 2K\boldsymbol{y} + 2\lambda K\boldsymbol{\alpha} &= 0\\
KK\boldsymbol{\alpha} - K\boldsymbol{y} + \lambda K\boldsymbol{\alpha} &= 0\\
KK\boldsymbol{\alpha} + \lambda K\boldsymbol{\alpha} &= K\boldsymbol{y}\\
K\boldsymbol{\alpha} + \lambda \boldsymbol{\alpha} &= \boldsymbol{y}\\
(K + \lambda I_N)\boldsymbol{\alpha} &= \boldsymbol{y}\\
\boldsymbol{\alpha} &= (K + \lambda I_N)^{-1}\boldsymbol{y}.
\label{eq:alpha}
\end{split}
\end{align}</p><p>新しい入力$\boldsymbol{x}$に対する出力は、推定した$\boldsymbol{\alpha}$を用いて以下のように予測できる。</p><p>\begin{align}
\begin{split}
\hat{y} &= (\Phi^{\top}\boldsymbol{\alpha})^{\top}\boldsymbol{\phi}(\boldsymbol{x}) \\
&= \boldsymbol{\alpha}^{\top}\Phi\boldsymbol{\phi}(\boldsymbol{x}) \\
&= \sum_{n=1}^{N} \alpha_n \boldsymbol{\phi}(\boldsymbol{x}_n)^{\top}\boldsymbol{\phi}(\boldsymbol{x}) \\
&= \sum_{n=1}^{N} \alpha_n k(\boldsymbol{x}_n, \boldsymbol{x}).
\label{eq:yk}
\end{split}
\end{align}</p><p>すなわち、$F$次元の$\boldsymbol{w}$を用いず、学習データ数$N$を次元とする$\boldsymbol{\alpha}$で予測できるようになった。</p><h3 id=22-カーネル関数の構成>2.2. カーネル関数の構成</h3><p>ここまで、$F$個の基底関数$\phi$を用いた特徴ベクトルとしての$\boldsymbol{\phi}$同士の内積として、カーネル関数をボトムアップ的に定義した。</p><p>この場合、どのような基底関数を選定するかという線形回帰モデルのもう一つの課題が残る。
カーネル法を用いた線形回帰モデルでは、発想を逆転させ、カーネル関数をトップダウン的に先に直接定義することで、その内部の基底関数を陽に知らずにすませるというアプローチをとる。</p><p>ただし、この場合は定義したカーネル関数が正定値性を満たす必要がある。
すなわち、任意の$M$個の点から計算される、定義したカーネル関数による$M \times M$のグラム行列$K$の2次形式が常に非負（任意の$\boldsymbol{\mu} \in \mathbb{R}^M$に対して$\boldsymbol{\mu}^{\top}K\boldsymbol{\mu} \geq 0$）となる必要がある。</p><p>このような条件を満たすカーネル関数を直接定義できたならば、これはなんらかの特徴ベクトル同士の内積と考えることができる。
ありがたいことに、式\eqref{eq:yk}は基底関数$\phi$を使わず全てカーネル関数$k$で表現できているため、直接定義したカーネル関数があれば、基底関数の選定が不要となる（<strong>カーネルトリック</strong>）。</p><p>幸い、さまざまなカーネル関数が考案されているため、まずはそれらのカーネル関数を利用することとなる。
以下、多項式カーネルとガウスカーネルを紹介する。</p><h4 id=多項式カーネル>多項式カーネル</h4><p>多項式カーネルは$k(\boldsymbol{p}, \boldsymbol{q}) = (\boldsymbol{p}^{\top}\boldsymbol{q} + c)^{m}$の形をとるカーネル関数である。
上述のカーネルリッジ回帰を利用するにあたってはどのような特徴ベクトルが利用されているのかを陽に知る必要はないが、例えば$m=2,\boldsymbol{p},\boldsymbol{q} \in \mathbb{R}^2$であれば次のような特徴ベクトルが対応することが分かる。</p><p>対応する特徴ベクトルを調べるために、多項式カーネルを特徴ベクトルの内積$\boldsymbol{\phi}(\boldsymbol{p})^{\top}\boldsymbol{\phi}(\boldsymbol{q})$に変形する。</p><p>\begin{align}
\begin{split}
k(\boldsymbol{p}, \boldsymbol{q}) &= (\boldsymbol{p}^{\top}\boldsymbol{q} + c)^{2} \\
&= ((p_1, p_2)^{\top}(q_1, q_2) + c)^2 \\
&= (p_1q_1 + p_2q_2 + c)^2 \\
&= p_1^2q_1^2 + p_2^2q_2^2 + c^2 + 2p_1q_1p_2q_2 + 2cp_2q_2 + 2cp_1q_1\\
&= p_1^2q_1^2 + p_2^2q_2^2 + c^2 + 2p_1p_2q_1q_2 + 2cp_2q_2 + 2cp_1q_1\\
&= p_1^2q_1^2 + p_2^2q_2^2 + c^2 + \sqrt{2}p_1p_2\sqrt{2}q_1q_2 + \sqrt{2c}p_2\sqrt{2c}q_2 + \sqrt{2c}p_1\sqrt{2c}q_1\\
&= (p_1^2, p_2^2, c, \sqrt{2}p_1p_2, \sqrt{2c}p_2, \sqrt{2c}p_1)^{\top}(q_1^2, q_2^2, c, \sqrt{2}q_1q_2, \sqrt{2c}q_2, \sqrt{2c}q_1).
\end{split}
\end{align}</p><p>つまり、今回の例では、特徴ベクトルが$\boldsymbol{\phi}(\boldsymbol{x}) = (x_1^2, x_2^2, c, \sqrt{2}x_1x_2, \sqrt{2c}x_2, \sqrt{2c}x_1)$として扱われていたことが分かる。
言葉を返せば、多項式カーネルを用いると、このような変換を行う6つの基底関数を明示的に選定して地道に内積を取った場合と同様の結果を得られる。</p><p>なお、多項式カーネルの$m=1,c=0$の場合、これを線形カーネルと呼び、この時の特徴ベクトルは入力と等しい（$\boldsymbol{\phi}(\boldsymbol{x}) = \boldsymbol{x}$）。</p><h4 id=ガウスカーネル>ガウスカーネル</h4><p>ガウスカーネルは$k(\boldsymbol{p}, \boldsymbol{q}) = \exp(-\frac{\| \boldsymbol{p} - \boldsymbol{q}\|^2}{2\sigma^2})$の形をとるカーネル関数である。</p><p>以下では、ガウスカーネルにどのような特徴ベクトルが対応するかを確認する。
まず、ガウスカーネルを以下のように展開、変形する。</p><p>\begin{align}
\begin{split}
k(\boldsymbol{p}, \boldsymbol{q}) &= \exp(-\frac{\| \boldsymbol{p} - \boldsymbol{q}\|^2}{2\sigma^2}) \\
&= \exp(-\frac{(\boldsymbol{p} - \boldsymbol{q})^{\top}(\boldsymbol{p} - \boldsymbol{q})}{2\sigma^2}) \\
&= \exp(-\frac{(\boldsymbol{p}^{\top} - \boldsymbol{q}^{\top})(\boldsymbol{p} - \boldsymbol{q})}{2\sigma^2}) \\
&= \exp(-\frac{\boldsymbol{p}^{\top}\boldsymbol{p} - \boldsymbol{q}^{\top}\boldsymbol{p} - \boldsymbol{p}^{\top}\boldsymbol{q} + \boldsymbol{q}^{\top}\boldsymbol{q}}{2\sigma^2}) \\
&= \exp(-\frac{\boldsymbol{p}^{\top}\boldsymbol{p} - (\boldsymbol{q}^{\top}\boldsymbol{p})^{\top} - \boldsymbol{p}^{\top}\boldsymbol{q} + \boldsymbol{q}^{\top}\boldsymbol{q}}{2\sigma^2}) \\
&= \exp(-\frac{\boldsymbol{p}^{\top}\boldsymbol{p} - \boldsymbol{p}^{\top}\boldsymbol{q} - \boldsymbol{p}^{\top}\boldsymbol{q} + \boldsymbol{q}^{\top}\boldsymbol{q}}{2\sigma^2}) \\
&= \exp(-\frac{\boldsymbol{p}^{\top}\boldsymbol{p} - 2\boldsymbol{p}^{\top}\boldsymbol{q} + \boldsymbol{q}^{\top}\boldsymbol{q}}{2\sigma^2}) \\
&= \exp(\frac{-\boldsymbol{p}^{\top}\boldsymbol{p}}{2\sigma^2} + \frac{\boldsymbol{p}^{\top}\boldsymbol{q}}{\sigma^2} + \frac{-\boldsymbol{q}^{\top}\boldsymbol{q}}{2\sigma^2}) \\
&= \exp(\frac{-\boldsymbol{p}^{\top}\boldsymbol{p}}{2\sigma^2})\exp(\frac{\boldsymbol{p}^{\top}\boldsymbol{q}}{\sigma^2})\exp(\frac{-\boldsymbol{q}^{\top}\boldsymbol{q}}{2\sigma^2}) \\
&= \rho\exp(\frac{\boldsymbol{p}^{\top}\boldsymbol{q}}{\sigma^2})\psi \\
&= \rho\psi\exp(\frac{\boldsymbol{p}^{\top}\boldsymbol{q}}{\sigma^2}).
\end{split}
\end{align}</p><p>最後の2行では以降の展開を見やすくするため、$\rho=\exp(\frac{-\boldsymbol{p}^{\top}\boldsymbol{p}}{2\sigma^2}), \psi=\exp(\frac{-\boldsymbol{q}^{\top}\boldsymbol{q}}{2\sigma^2})$とおいた。</p><p>次に、$e^x$のマクローリン展開の公式（$e^x = \sum_{i=0}^{\infty} \frac{x^i}{i!} = 1 + x + \frac{x^2}{2} + \frac{x^3}{6} + \cdots$）を使い、特徴ベクトルの内積$\boldsymbol{\phi}(\boldsymbol{p})^{\top}\boldsymbol{\phi}(\boldsymbol{q})$に変形する。</p><p>簡単のため$\sigma=1$とすると、次のような式が得られる。</p><p>\begin{align}
\begin{split}
\rho\psi\exp(\boldsymbol{p}^{\top}\boldsymbol{q}) &= \rho\psi \left(1 + (\boldsymbol{p}^{\top}\boldsymbol{q})^1 + \frac{(\boldsymbol{p}^{\top}\boldsymbol{q})^2}{2} + \frac{(\boldsymbol{p}^{\top}\boldsymbol{q})^3}{6} + \ldots \right).
\end{split}
\end{align}</p><p>これは$c=0$の多項式カーネルを次数$m$を増やしながら無限回足したものである。
よって例えば、$\boldsymbol{p},\boldsymbol{q} \in \mathbb{R}^2$では、次のような<strong>無限次元</strong>の特徴ベクトルが対応することが分かる。</p><p>\begin{align}
\begin{split}
\rho\psi\exp(\boldsymbol{p}^{\top}\boldsymbol{q}) &= \rho\psi \left(1 + (\boldsymbol{p}^{\top}\boldsymbol{q})^1 + \frac{(\boldsymbol{p}^{\top}\boldsymbol{q})^2}{2} + \frac{(\boldsymbol{p}^{\top}\boldsymbol{q})^3}{6} + \ldots \right) \\
&= \rho\psi \left(1 + (p_1q_1 + p_2q_2) + \frac{p_1^2q_1^2 + p_2^2q_2^2 + \sqrt{2}p_1p_2\sqrt{2}q_1q_2}{2} + \frac{p_1^3q_1^3 + p_2^3q_2^3 + \sqrt{3}p_1^2p_2\sqrt{3}q_1^2q_2 + \sqrt{3}p_1p_2^2\sqrt{3}q_1q_2^2}{6} + \ldots \right) \\
&= \rho\left(1, p_1, p_2, \frac{p_1^2}{\sqrt{2}}, \frac{p_2^2}{\sqrt{2}}, \frac{\sqrt{2}p_1p_2}{\sqrt{2}}, \frac{p_1^3}{\sqrt{6}}, \frac{p_2^3}{\sqrt{6}}, \frac{\sqrt{3}p_1^2p_2}{\sqrt{6}}, \frac{\sqrt{3}p_1p_2^2}{\sqrt{6}}, \ldots \right)^{\top}\psi\left(1, q_1, q_2, \frac{q_1^2}{\sqrt{2}}, \frac{q_2^2}{\sqrt{2}}, \frac{\sqrt{2}q_1q_2}{\sqrt{2}}, \frac{q_1^3}{\sqrt{6}}, \frac{q_2^3}{\sqrt{6}}, \frac{\sqrt{3}q_1^2q_2}{\sqrt{6}}, \frac{\sqrt{3}q_1q_2^2}{\sqrt{6}},\ldots \right) \\
&= \rho\left(1, p_1, p_2, \frac{p_1^2}{\sqrt{2}}, \frac{p_2^2}{\sqrt{2}}, p_1p_2, \frac{p_1^3}{\sqrt{6}}, \frac{p_2^3}{\sqrt{6}}, \frac{p_1^2p_2}{\sqrt{2}}, \frac{p_1p_2^2}{\sqrt{2}}, \ldots \right)^{\top}\psi\left(1, q_1, q_2, \frac{q_1^2}{\sqrt{2}}, \frac{q_2^2}{\sqrt{2}}, q_1q_2, \frac{q_1^3}{\sqrt{6}}, \frac{q_2^3}{\sqrt{6}}, \frac{q_1^2q_2}{\sqrt{2}}, \frac{q_1q_2^2}{\sqrt{2}},\ldots \right).
\end{split}
\end{align}</p><p>ガウスカーネルでは、このような無限個の基底関数を用意して内積を地道に計算した結果が、$k(\boldsymbol{p}, \boldsymbol{q}) = \exp(-\frac{\| \boldsymbol{p} - \boldsymbol{q}\|^2}{2\sigma^2})$のみの計算から得られるとも考えられる。</p><h2 id=3-random-fourier-features乱択化フーリエ特徴>3. Random Fourier Features（乱択化フーリエ特徴）</h2><p>カーネルリッジ回帰による入力$\boldsymbol{x}$に対する予測は式\eqref{eq:alpha}\eqref{eq:yk}より、$\hat{y} = \sum_{n=1}^{N} \alpha_n k(\boldsymbol{x}_n, \boldsymbol{x}), \boldsymbol{\alpha} = (K + \lambda I_N)^{-1}\boldsymbol{y}$となるのであった。
カーネルリッジ回帰では、$F \gg N$となるような学習データ数$N$に対し十分大きい$F$個の基底関数を用いる場合に、双対表現によってパラメータ数を$N$に抑えつつ、カーネル関数の導入によって$F$次元の特徴ベクトルの直接的な算出を回避できた。</p><p>しかしながら、カーネルリッジ回帰は、学習データ数$N$に対して計算量が指数的に増加してしまう課題がある。
これは、グラム行列$K$のサイズが$N \times N$であるため、$\boldsymbol{\alpha}$の計算にあたって、必要なカーネル関数の計算が$N^2$のオーダーで増加することからも分かる。
また、逆行列の計算も$K$のサイズに応じて計算量が増加する。
加えて、$\hat{y}$の計算にあたっても、新しい入力$\boldsymbol{x}$に対して$N$回のカーネル関数の計算が都度必要となってしまう。</p><p><strong>Random Fourier Features</strong>は、ある確率分布からのサンプリング結果でカーネル関数とグラム行列を近似することで、上述の課題を解決する、高速化のための手法である。</p><p>この手法では、$\mathbb{R}^D$上のカーネル関数$k(\boldsymbol{p},\boldsymbol{q})$が$\boldsymbol{p}$と$\boldsymbol{q}$の差の形（$k(\boldsymbol{p}-\boldsymbol{q})$）で表せるとき、このカーネル関数が、ある確率密度関数$p(\boldsymbol{\omega})$のフーリエ変換で表せることを利用する。</p><p>\begin{align}
\begin{split}
k(\boldsymbol{p},\boldsymbol{q}) &= k(\boldsymbol{p} - \boldsymbol{q})\\
&= \int_{\mathbb{R}^{D}} p(\boldsymbol{\omega}) \exp(i \boldsymbol{\omega}^{\top}(\boldsymbol{p} - \boldsymbol{q}))d\boldsymbol{\omega} \\
&= \mathbb{E}_{\boldsymbol{\omega}}[\exp(i \boldsymbol{\omega}^{\top}(\boldsymbol{p} - \boldsymbol{q}))] \\
&= \mathbb{E}_{\boldsymbol{\omega}}[\cos(\boldsymbol{\omega}^{\top}(\boldsymbol{p} - \boldsymbol{q}))] \\
&= \mathbb{E}_{\boldsymbol{\omega},b}[\sqrt{2}\cos(\boldsymbol{\omega}^{\top}\boldsymbol{p} + b) \cdot \sqrt{2}\cos(\boldsymbol{\omega}^{\top}\boldsymbol{q} + b)] \\
&\approx \frac{1}{R} \sum_{r=1}^{R} \sqrt{2}\cos(\boldsymbol{\omega}_r^{\top}\boldsymbol{p} + b_r) \cdot \sqrt{2}\cos(\boldsymbol{\omega}_r^{\top}\boldsymbol{q} + b_r).
\end{split}
\end{align}</p><p>ここで、$\boldsymbol{\omega} \sim p(\boldsymbol{\omega}), b \sim \text{Uniform}(0, 2\pi)$である。
なお、$p(\boldsymbol{\omega})$は利用するカーネル関数によって異なるが、ガウスカーネルの場合、$\boldsymbol{w} = (w_d)^{1 \leq d \leq D}, w_d \sim \mathcal{N}(0, \sigma^2)$となる。</p><p>最後の行は、この確率分布の期待値（$=$カーネル関数の結果）を$R$個のサンプリング結果の平均で近似することを示している。</p><p>すなわち、各サンプルから求めた結果を、$z_r(\boldsymbol{x}) = \cos(\boldsymbol{\omega}_{r}^{\top}\boldsymbol{x} + b_r)$、$R$個の$z_r$を$\boldsymbol{z}(\boldsymbol{x}) = \sqrt{\frac{2}{R}}(z_1(\boldsymbol{x}),\ldots,z_R(\boldsymbol{x}))^{\top}$とおくと、カーネル関数$k$の近似$\hat{k}$が$\hat{k}(\boldsymbol{p},\boldsymbol{q}) = \boldsymbol{z}(\boldsymbol{p})^{\top}\boldsymbol{z}(\boldsymbol{q})$のように得られる。
また、学習データ$X$に対する$\boldsymbol{z}$の集合を$Z = (\boldsymbol{z}(\boldsymbol{x}_1)^{\top}, \ldots, \boldsymbol{z}(\boldsymbol{x}_N)^{\top})^{\top} \in \mathbb{R}^{N \times R}$とすると、$\hat{K} = ZZ^{\top}$の操作によって$N \times N$行列の各要素がカーネル関数$k$の近似$\hat{k}(\boldsymbol{x}_i, \boldsymbol{x}_j) = \boldsymbol{z}(\boldsymbol{x}_i)^{\top}\boldsymbol{z}(\boldsymbol{x}_j)$となるグラム行列$K$の近似$\hat{K}$を得られる。</p><p>よって、これらの近似を用いたカーネルリッジ回帰のパラメータ$\boldsymbol{\alpha}$の近似$\hat{\boldsymbol{\alpha}}$は、$\hat{\boldsymbol{\alpha}} = (\hat{K} + \lambda I_{N})^{-1}\boldsymbol{y}$となる。
ただし、この手法では、$\hat{K} = ZZ^{\top}$であることを利用して、計算量を学習データ数$N$ではなくサンプリング数$R$のオーダーに変えることができる。
そのため、$R \ll N$であるならば、非常に効率よく予測が可能となる。</p><p>以下に、$\hat{K}$や$\hat{\boldsymbol{\alpha}}$を消去していく経過と合わせて、この手法における予測式を示す。</p><p>\begin{align}
\begin{split}
\hat{y} &= \sum_{n=1}^{N} \hat{\alpha}_n \hat{k}(\boldsymbol{x}_n, \boldsymbol{x}) \\
&= \sum_{n=1}^{N} \hat{\alpha}_n \hat{k}(\boldsymbol{x}, \boldsymbol{x}_n) \\
&= \sum_{n=1}^{N} \hat{\alpha}_n \boldsymbol{z}(\boldsymbol{x})^{\top}\boldsymbol{z}(\boldsymbol{x}_n) \\
&= \boldsymbol{z}(\boldsymbol{x})^{\top} \sum_{n=1}^{N} \hat{\alpha}_n \boldsymbol{z}(\boldsymbol{x}_n) \\
&= \boldsymbol{z}(\boldsymbol{x})^{\top} Z^{\top} \hat{\boldsymbol{\alpha}} \\
&= \boldsymbol{z}(\boldsymbol{x})^{\top} Z^{\top} (\hat{K} + \lambda I_{N})^{-1}\boldsymbol{y} \\
&= \boldsymbol{z}(\boldsymbol{x})^{\top} Z^{\top} (ZZ^{\top} + \lambda I_{N})^{-1}\boldsymbol{y} \\
&= \boldsymbol{z}(\boldsymbol{x})^{\top} (Z^{\top}Z + \lambda I_{R})^{-1}Z^{\top} \boldsymbol{y}.
\end{split}
\end{align}</p><p>よって、$A=(Z^{\top}Z + \lambda I_{R}) \in \mathbb{R}^{R \times R}$、$\boldsymbol{b} = (Z^{\top} \boldsymbol{y}) \in \mathbb{R}^{R}$、$\boldsymbol{\beta} = A^{-1}\boldsymbol{b}$として、$\hat{y} = \boldsymbol{z}(\boldsymbol{x})^{\top} \boldsymbol{\beta}$と予測できる。
$Z$は$N \times R$であるものの、逆行列のサイズは$R \times R$となること、$\hat{y}$の計算も、新しい入力$\boldsymbol{x}$に対して$R$回の計算で済む$\boldsymbol{z}(\boldsymbol{x})$のみで良いことから、計算量が抑えられることが分かる。</p><p>なお、最後の行では逆行列の補題（$P(I_N + QP)^{-1} = (I_R +PQ)^{-1}P, P \in \mathbb{R}^{R \times N}, Q \in \mathbb{R}^{N \times R}$）を用いた。</p><h2 id=参考>参考</h2><h3 id=線形回帰モデル>線形回帰モデル</h3><ul><li><a href=https://manabitimes.jp/math/1128>正規方程式の導出と計算例</a></li><li><a href=https://www.kspub.co.jp/book/detail/5161968.html>スタンフォード　ベクトル・行列からはじめる最適化数学</a></li><li><a href=https://www.kspub.co.jp/book/detail/1529267.html>ガウス過程と機械学習</a></li></ul><h3 id=カーネル法による線形回帰モデル>カーネル法による線形回帰モデル</h3><ul><li><a href=https://qiita.com/wsuzume/items/09a59036c8944fd563ff>線形な手法とカーネル法（回帰分析）</a></li><li><a href=https://qiita.com/kilometer/items/66e6116cc661019ead59>カーネルトリック</a></li><li><a href=https://www.slideshare.net/KeisukeSugawara/slide0629>PRML第６章「カーネル法」</a></li><li><a href=https://www.slideshare.net/hagino_3000/prml-61-17081123>PRML 6.1章 カーネル法と双対表現</a></li><li><a href=https://www.iwanami.co.jp/book/b257891.html>カーネル多変量解析 非線形データ解析の新しい展開</a></li><li><a href=https://towardsdatascience.com/truly-understanding-the-kernel-trick-1aeb11560769>Understanding the Kernel Trick with fundamentals</a></li><li><a href=https://en.wikipedia.org/wiki/Radial_basis_function_kernel>Radial basis function kernel</a></li></ul><h3 id=random-fourier-features>Random Fourier Features</h3><ul><li><a href=https://qiita.com/githug0906/items/448daec79fac2ffd82a0>乱択化フーリエ特徴を用いたリッジ回帰</a></li><li><a href=https://www.kyoritsu-pub.co.jp/book/b10003381.html>機械学習のためのカーネル100問 with Python</a></li><li><a href=https://gregorygundersen.com/blog/2019/12/23/random-fourier-features/>Random Fourier Features</a></li><li><a href=https://proceedings.neurips.cc/paper/2007/hash/013a006f03dbc5392effeb8f18fda755-Abstract.html>Rahimi, Ali, and Benjamin Recht. &ldquo;Random features for large-scale kernel machines.&rdquo; Advances in neural information processing systems 20 (2007).</a></li></ul></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/regression>regression</a></li></ul><div class=clear></div></footer></div></article><a href=/post/ class=archives>Archives</a></div></div><footer class=footer><div class=author></div><p class=author-name><a href=https://twitter.com/monochromegane target=_blank>@monochromegane</a></p><p>monochromegane (モノクロめがね) と申します。</p><p>最近はもっぱらGoに夢中です。普段は研究開発をやっています。</p><ul class=social><li><a href=https://twitter.com/monochromegane target=_blank><i class="fa fa-twitter"></i></a></li><li><a href=https://github.com/monochromegane target=_blank><i class="fa fa-github"></i></a></li><li><a href=/index.xml target=_blank><i class="fa fa-rss"></i></a></li></ul><p class=copyright><small>&copy; <span>Powered by <a href=http://gohugo.io target=_blank>Hugo</a>, Designed by <a href=https://twitter.com/keita_kawamoto target=_blank>&copy;keita_kawamoto</a></span></small></p></footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/go.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/vim.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-38374674-1","auto"),ga("send","pageview")</script></body></html>