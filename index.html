<!doctype html><html><head><meta name=generator content="Hugo 0.154.2"><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=author content><title>THINKING MEGANE</title><meta name=twitter:card content="summary"><meta name=twitter:site content="@monochromegane"><meta property="og:description" content="THINKING MEGANE"><meta property="og:title" content="THINKING MEGANE"><meta property="og:url" content="https://blog.monochromegane.com/"><meta property="og:image" content="https://blog.monochromegane.com/images/ogp.png"><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href='//fonts.googleapis.com/css?family=Source+Code+Pro' type=text/css><link rel=stylesheet href='//fonts.googleapis.com/css?family=Montserrat' type=text/css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/ir_black.min.css><link rel=stylesheet href=/css/text.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/layout.css><link rel=apple-touch-icon-precomposed sizes=57x57 href=/images/apple-touch-icon-57-precomposed.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/images/apple-touch-icon-114-precomposed.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/images/apple-touch-icon-72-precomposed.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=/images/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/images/favicon.ico><link rel=canonical href=https://blog.monochromegane.com/><link href=https://blog.monochromegane.com/index.xml rel=alternate type=application/rss+xml title="THINKING MEGANE"><script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_CHTML' async>MathJax.Hub.Config({HTML:["input/TeX","output/HTML-CSS"],TeX:{Macros:{bm:["\\boldsymbol{#1}",1],argmax:["\\mathop{\\rm arg\\,max}\\limits"],argmin:["\\mathop{\\rm arg\\,min}\\limits"]},extensions:["AMSmath.js","AMSsymbols.js"],equationNumbers:{autoNumber:"AMS"}},extensions:["tex2jax.js"],jax:["input/TeX","output/HTML-CSS"],tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},"HTML-CSS":{availableFonts:["TeX"],linebreaks:{automatic:!0}}})</script></head><body><div class=header><header><h1 class=logo><a href=https://blog.monochromegane.com/>THINKING MEGANE</a></h1><nav><ul class=menu><li><a href=/self-introduction/>Home</a></li><li><a href=/post/>Archives</a></li><li><a href=/diary/>Diary</a></li><li><a href=http://thinking-megane.blogspot.jp/>Old Blog</a></li></ul></nav></header></div><div class=container><div class=posts><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2026/01/11/popup/>tmuxのpopupを使ってターミナル画面でClaude Codeと棲み分ける</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2026-01-11</div></time></header><div class=post-inner><p>Claude CodeをはじめとするCLI型のコーディングエージェントはターミナル画面中の一定領域を占有します。</p><p>元々自分は、ターミナルマルチプレクサであるtmuxを利用していて、リポジトリをプロジェクトとみなし、一つのウィンドウを対応させ、その中でペインを分ける構成をとっていました。
その配置と各ペインのサイズのなかで、エージェントの入る余地はなく、どうしてもペイン内で共有させるか、異なるウィンドウを割り当てる必要がありました。
しかしながら、役割を共有させたペインの裏側や異なるウィンドウに散らばったエージェントのセッションを探し回るのは非常に面倒に感じていました。</p><p>そんな中、以下のtmux popupの活用記事がしっくりきたので、参考にさせてもらいました。</p><ul><li><a href=https://qiita.com/hanlio/items/432ed4065073a2e6196a>【Tmux】Claude Code を popup で快適に使う</a></li><li><a href=https://zenn.dev/skanehira/articles/2020-10-25-tmux-toggle-popup>tmuxのpopupが便利</a></li></ul><h2 id=利用の様子>利用の様子</h2><p><img src=/images/2026/01/popup.png alt=Popup></p><p>画面の中央の前面領域がtmux popupでClaude Codeを動かしている箇所です。
このpopupの表示・非表示を指定したキーバインドで瞬時にトグルできる体験が非常に良いです。
トグルの様子は、上記の記事のデモが分かりやすいのでぜひご覧いただきたいです。</p><p>特に、tmuxのセッションのdetachとattachを行うため、popupを隠しても処理が継続され、ターミナル領域をお気に入りの配置のままコードの確認などが快適に行えるのが非常に有用です。
また、以下の設定で見ていただける通り、tmux側のpopupやキーバインドを使うため、操作中のClaude Codeに干渉しない点もポイントが高いです。</p><p>（余談ですが<code>IS_DEMO</code>環境変数をつけてClaude Codeを起動すると組織名やメールアドレスが非表示になってこういうスクリーンショットの時に便利です）</p><h2 id=実際の設定>実際の設定</h2><p>上記の記事はfishだったのでzshで使うために以下のようにしました。</p><p><code>functions/_tmuxpopup</code>でカレントディレクトリ（リポジトリ名）をベースにセッション名を組み立て、セッションがなければ作成、あればattachとdetachをトグルできるようにしています。
セッション名の組み立てのところを自分の環境に合わせると使いまわせると思います。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#66d9ef>function</span> _tmuxpopup<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  local initial_cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>1<span style=color:#66d9ef>:-</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  local title<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>2<span style=color:#66d9ef>:-</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local width<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;80%&#39;</span>
</span></span><span style=display:flex><span>  local height<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;80%&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local session
</span></span><span style=display:flex><span>  session<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>tmux display-message -p -F <span style=color:#e6db74>&#39;#{session_name}&#39;</span> 2&gt;/dev/null<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local pane_path
</span></span><span style=display:flex><span>  pane_path<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>tmux display-message -p -F <span style=color:#e6db74>&#39;#{pane_current_path}&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local home_src<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>HOME<span style=color:#e6db74>}</span><span style=color:#e6db74>/src&#34;</span>
</span></span><span style=display:flex><span>  local key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$pane_path<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>${</span>home_src<span style=color:#e6db74>}</span>/*/*/*<span style=color:#f92672>(</span>|/*<span style=color:#f92672>)</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    local rest<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pane_path#<span style=color:#e6db74>${</span>home_src<span style=color:#e6db74>}</span>/<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local parts<span style=color:#f92672>=(</span><span style=color:#e6db74>${</span>(s:/:)rest<span style=color:#e6db74>}</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    local org<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>parts[2]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    local repo<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>parts[3]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    repo<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>repo%-wt<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>org<span style=color:#e6db74>}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>${</span>repo<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pane_path:t<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local safe_key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>key//<span style=color:#ae81ff>\/</span>/_<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  safe_key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>safe_key//[^A-Za-z0-9_.-]/_<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local popup_session<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;popup_</span><span style=color:#e6db74>${</span>title<span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span>safe_key<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span>$session<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>==</span> popup_* <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    tmux detach-client
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local exec_cmd
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> -n <span style=color:#e6db74>&#34;</span>$initial_cmd<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    exec_cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tmux attach -t </span><span style=color:#e6db74>${</span>popup_session<span style=color:#e6db74>}</span><span style=color:#e6db74> || tmux new -s </span><span style=color:#e6db74>${</span>popup_session<span style=color:#e6db74>}</span><span style=color:#e6db74> &#39;</span><span style=color:#e6db74>${</span>initial_cmd<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    exec_cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tmux attach -t </span><span style=color:#e6db74>${</span>popup_session<span style=color:#e6db74>}</span><span style=color:#e6db74> || tmux new -s </span><span style=color:#e6db74>${</span>popup_session<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  tmux display-popup <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    -d <span style=color:#e6db74>&#34;#{pane_current_path}&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    -xC -yC <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    -w <span style=color:#e6db74>&#34;</span>$width<span style=color:#e6db74>&#34;</span> -h <span style=color:#e6db74>&#34;</span>$height<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    -T <span style=color:#e6db74>&#34;</span>$title<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    -E <span style=color:#e6db74>&#34;</span>$exec_cmd<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>上記の関数はpopup時に起動したいコマンドとpopupのタイトルを受け付けられる共通関数なので、Claude Codeを立ち上げるため具体的な実装を<code>functions/_tmuxpopup-claude</code>に記述しました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#66d9ef>function</span> _tmuxpopup-claude<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  _tmuxpopup <span style=color:#e6db74>&#34;claude&#34;</span> <span style=color:#e6db74>&#34;claude&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>上記の関数たちを<code>.zshrc</code>でautoloadしておきます。これでこの関数がいつでも呼び出せるようになります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>autoload -Uz _tmuxpopup
</span></span><span style=display:flex><span>autoload -Uz _tmuxpopup-claude
</span></span></code></pre></div><p>実際の呼び出しはコマンドではなく<code>tmux.conf</code>にキーバインドとして登録しておきます。こうすることで、popup内のClaude Code起動中でもpopupをいつでも隠すことができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>bind , run-shell <span style=color:#e6db74>&#39;zsh -ic &#34;_tmuxpopup-claude&#34;&#39;</span>
</span></span></code></pre></div><p>これでprefix + &lsquo;,&lsquo;でpopupをトグルできるようになりました。非常に快適です。</p><h2 id=並列実行>並列実行</h2><p>これだけだと再紹介にしかならないので、並列実行のために試しているものも紹介しておきます。</p><p><a href=https://github.com/kbwo/ccmanager>ccmanager</a>はClaude Codeをはじめとするコーディングエージェントの並列実行を管理するためのツールです。
エージェント単位でgit worktreeを割り当てることができるので、並列実行時のコンフリクトなども回避することができます。</p><p>上で紹介した<code>_tmuxpopup</code>は起動したいコマンドを差し替えるだけで使えるのでccmanagerを呼ぶようにするだけで良いです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#66d9ef>function</span> _tmuxpopup-ccmanager<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  _tmuxpopup <span style=color:#e6db74>&#34;ccmanager&#34;</span> <span style=color:#e6db74>&#34;ccmanager&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>これでプロジェクトごとの並列実行はかなり便利になりますが、いわゆる承認疲れの現象が発生するため、ある程度の権限を持たせた上で安全に実行したくなります。
そこで、Dev Containerと組み合わせます。
幸い、ccmanagerはDev Containerの利用も視野に入れているようで、探すと専用のオプションがあります。
それを踏まえて、先の関数を以下のように変更できます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#66d9ef>function</span> _tmuxpopup-ccmanager<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  _tmuxpopup <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;ccmanager --devc-up-command &#34;devcontainer up --docker-path podman --workspace-folder .&#34; --devc-exec-command &#34;devcontainer exec --docker-path podman --workspace-folder .&#34;&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;ccmanager&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><code>podman</code>を使う場合のオプションが含まれているので環境に応じて適宜読み替えていただければと思います。
また、予め<a href=https://github.com/devcontainers/cli>Dev Container CLI</a>もインストールしておく必要があります。</p><p>これで、プロジェクトのDev Containerの設定（<code>.devcontainer</code>ディレクトリ）を使ってccmanagerがよしなにやってくれます。
なお、コンテナ内にClaude Codeが含まれる必要があるため、<a href=https://github.com/anthropics/devcontainer-features>Dev Container Features</a>などで追加しておくと良いです。</p><p>以下のように設定し、Claude Codeのpopupと使い分けることができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>bind . run-shell <span style=color:#e6db74>&#39;zsh -ic &#34;_tmuxpopup-ccmanager&#34;&#39;</span>
</span></span></code></pre></div><h2 id=おわりに>おわりに</h2><p>tmux popupを使うことでClaude Codeとターミナル領域をうまく棲み分けることができて非常に快適になりました。
しかしながら、並列実行の部分は実はまだ試行錯誤中です。
特に、Dev Container + git worktree + Claude Codeの相性はあまり良くないと思っていて、マウント周りを工夫する必要があり、なかなか全てのリポジトリで気軽に使えてないのが現状です。
また、Dev Containerであれローカルであれ、単純に自分が起点にエージェントとやりとりする構造から逆転させないと目指す並列は近づけないなあとも思っているので、引き続き試行錯誤していきたいと思います。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/tmux>tmux</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2026/01/10/stamp/>プロジェクトのスケルトンをテンプレートから展開するstampというCLIツールを作った</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2026-01-10</div></time></header><div class=post-inner><p>CLIツールを多く作っていると、最初のコミットまでに機械的に準備する自分なりの一式（利用するコマンドラインパーサーによる初期実装、GitHub Actionの定義、Makefile、ライセンスファイル等々）ができてくるかと思います。
このような一式を予め用意しておくことが、普段通りの開発作法に従ってスムーズに開発を始めるための土台となります。
また、最近では、コーディングエージェントへ依頼する際に、このような一式を揃えて実装時の補助線としてもらう方が、認識が揃うことも多いように感じています。</p><p>自分の場合、この一式の準備には直近のリポジトリからコピーしてくることが多いですが、細々とした置換などが面倒でした。
秘蔵スクリプトを持っている方も多いのではないでしょうか。</p><p>このようなニーズのため、プロジェクトのスケルトンを管理するツールが開発されています（<a href=https://github.com/copier-org/copier>copier</a>などがあるようです）。
一方で、これらのツールはテンプレートの適用後の継続的な同期まで面倒を見るために、プロジェクト開始時に一度展開できれば良いという自分のユースケースに対しては機能的に持て余してしまう印象がありました。</p><p>そこで、自分用に<a href=https://github.com/monochromegane/stamp>stamp</a>と言うCLIツールを作りました。</p><p>機能は単純で、予め用意しておいた、テンプレート一式（ツールがスタンプなのでシートと呼んでいます）をディレクトリ構造のままコピーしてくるだけです。
各ファイルはGo言語のテンプレートとして処理されるため、<code>{{.name}}</code>のような記述に対して、動的な値を設定できます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># my-appシートにhello.txtを登録（拡張子.stampでテンプレートとして解釈）</span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;Hello {{.name}}!&#34;</span> &gt; <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>stamp config-dir<span style=color:#66d9ef>)</span><span style=color:#e6db74>/sheets/my-app/hello.txt.stamp&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># my-appシートを適用</span>
</span></span><span style=display:flex><span>$ cd /path/to/workspace
</span></span><span style=display:flex><span>$ stamp -s my-app name<span style=color:#f92672>=</span>alice
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># 結果を確認</span>
</span></span><span style=display:flex><span>$ ls
</span></span><span style=display:flex><span>hello.txt
</span></span><span style=display:flex><span>$ cat hello.txt
</span></span><span style=display:flex><span>Hello alice!
</span></span></code></pre></div><p><a href=https://www.chezmoi.io/>chezmoi</a>をご存知の方は、これを都度任意のディレクトリへapplyできるものと考えてもらうと想像しやすいかもしれません。</p><h2 id=使用例>使用例</h2><p>自身の具体的な利用ケースとして、Go言語のCLIのリポジトリを作成するシートを用意しています（というかこのために作った）。
拡張子.stampのファイルに含まれるモジュール名などを作成したいCLIツールの名称等に合わせてコピー時に設定することができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ tree <span style=color:#66d9ef>$(</span>stamp config-dir<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>~/.config/stamp/
</span></span><span style=display:flex><span>├── sheets
</span></span><span style=display:flex><span>│   └── go-cli            <span style=color:#75715e># go-cliというシート名で配下のディレクトリ構造を管理</span>
</span></span><span style=display:flex><span>│       ├── bootstrap.sh  <span style=color:#75715e># go mod tidyやgitのinitial commitなどを行う（後述）</span>
</span></span><span style=display:flex><span>│       ├── cmd           <span style=color:#75715e># 以下はCLIツールのスケルトンやMakefile、LICENSEなど</span>
</span></span><span style=display:flex><span>│       │   ├── cli_test.go
</span></span><span style=display:flex><span>│       │   ├── cli.go.stamp
</span></span><span style=display:flex><span>│       │   └── version.go
</span></span><span style=display:flex><span>│       ├── go.mod.stamp
</span></span><span style=display:flex><span>│       ├── internal
</span></span><span style=display:flex><span>│       │   └── greet
</span></span><span style=display:flex><span>│       │       ├── greet_test.go
</span></span><span style=display:flex><span>│       │       └── greet.go
</span></span><span style=display:flex><span>│       ├── LICENSE.stamp
</span></span><span style=display:flex><span>│       ├── main.go.stamp
</span></span><span style=display:flex><span>│       ├── Makefile.stamp
</span></span><span style=display:flex><span>│       └── README.md.stamp
</span></span><span style=display:flex><span>└── stamp.yaml            <span style=color:#75715e># ユーザー名などのデフォルト値を管理（後述）</span>
</span></span></code></pre></div><p>以下のように実行すると、テストが通る状態でプロジェクトを開始できます。また、GitHubにpushすれば<a href=https://github.com/Songmu/tagpr>tagpr</a>を用いたリリースの設定まで完了した状態になります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>APPNAME<span style=color:#f92672>=</span>sample; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>mkdir <span style=color:#e6db74>&#34;</span>$APPNAME<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  <span style=color:#f92672>&amp;&amp;</span> cd <span style=color:#e6db74>&#34;</span>$APPNAME<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  <span style=color:#f92672>&amp;&amp;</span> stamp -s go-cli appname<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$APPNAME<span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  <span style=color:#f92672>&amp;&amp;</span> sh bootstrap.sh
</span></span></code></pre></div><p>興味がある方はこちらを参照ください。シートをさらにchezmoiで管理していますが内容はそのまま確認できます。</p><ul><li><a href=https://github.com/monochromegane/dotfiles/commit/56ccfd6dc17e53df25e027b86ba142ba29fcab4a>Go言語のCLIのリポジトリを作成するテンプレート一式（シート）</a></li></ul><h2 id=便利な機能>便利な機能</h2><p>stampの基本機能はこれだけですが、利用にあたり少し便利な機能ももう少し作っているので軽く紹介します。</p><h3 id=シート登録の支援>シート登録の支援</h3><p>既存のディレクトリやファイルをシートとして登録するための<code>collect</code>サブコマンドを用意しています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># カレントディレクトリを再帰的にテンプレートとして（.stamp拡張子をつけて）</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sampleシートとして登録</span>
</span></span><span style=display:flex><span>$ stamp collect -s sample -t .
</span></span></code></pre></div><h3 id=デフォルト値の指定>デフォルト値の指定</h3><p><code>$(stamp config-dir)/stamp.yaml</code>にシートのテンプレート展開時にデフォルトで指定する値をキーごとに設定しておくことができます。
コマンド実行時に指定があればそちらが優先されます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>year: <span style=color:#ae81ff>2026</span>
</span></span><span style=display:flex><span>username: monochromegane
</span></span></code></pre></div><h3 id=パラメータ不足チェック機能>パラメータ不足チェック機能</h3><p>事前にテンプレートに必要なパラメータの値を覚えておいたり覗いて回って思い出すのは時間がかかります。
stampでは、必要なパラメータをうろ覚えのまま実行しても、不足があれば適用前に教えてくれます。どのファイルに何のパラメータが必要かが分かるので、便利です。</p><p>例えば、先ほどのgo-cliでは、stamp.yamlで定義しているデフォルトの値の他に、必ずappnameと言うキーに対して値を与えなければなりませんが、これをせずに実行するとこういうエラーがでます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># stamp -s go-cli appname=monochromeganeとして呼ぶべき</span>
</span></span><span style=display:flex><span>$ stamp -s go-cli
</span></span><span style=display:flex><span>Error: stamp failed: missing required template variables:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - appname
</span></span><span style=display:flex><span>    used in:
</span></span><span style=display:flex><span>      - .gitignore.stamp
</span></span><span style=display:flex><span>      - LICENSE.stamp
</span></span><span style=display:flex><span>      - Makefile.stamp
</span></span><span style=display:flex><span>      - README.md.stamp
</span></span><span style=display:flex><span>      - cmd/cli.go.stamp
</span></span><span style=display:flex><span>      - go.mod.stamp
</span></span><span style=display:flex><span>      - main.go.stamp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Provide missing variables using:
</span></span><span style=display:flex><span>  - Command line: stamp -s &lt;sheet&gt; -d &lt;dest&gt; appname<span style=color:#f92672>=</span>&lt;value&gt;
</span></span><span style=display:flex><span>  - Config file: Create stamp.yaml in sheet or config directory
</span></span></code></pre></div><h3 id=その他>その他</h3><p>将来シートを増やした際の共通シートが欲しくなることを想定して、複数シートを同時に指定できる機能なども設けています。</p><p>なお、機能をシンプルに保ちたいため、適用後に実施したいスクリプトなどを実行する機能は持たせないことにしました。
ひとまずは、シート中に以下のような<code>bootstrap.sh</code>などを用意し、stampコマンド実行後に続けて実行する運用にしています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env sh
</span></span></span><span style=display:flex><span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>go mod tidy
</span></span><span style=display:flex><span>git init
</span></span><span style=display:flex><span>git add . <span style=color:#e6db74>&#34;:!./</span>$0<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#34;Add project skeleton&#34;</span>
</span></span><span style=display:flex><span>make test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rm -- <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h2 id=おわりに>おわりに</h2><p>今回のツール実装はClaude Codeに任せ、コマンドラインとしての使い心地の観点からコメントしながら進めました。
ただし、出発点は上述のシート相当のプロジェクト構成を与えた上で実装を開始してもらったため、実装の方向性については想定した範囲に収まりやすかったかなと感じています。</p><p>CLIツール開発の着手時の迅速化のみならず、コーディングエージェントへの実装補助線を与えるという点でも役立つツールかなと思いますので、よければ使ってみてください。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/golang>golang</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2026/01/03/dotfiles/>dotfilesを5年ぶりに整備した</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2026-01-03</div></time></header><div class=post-inner><p>なんとdotfilesも5年更新していなかった。
なにかと気忙しいのではあるが、木こりのジレンマに陥らないよう再起動していきたい。</p><p>さて、昨年末にMacbook Proを新調してまっさらな開発環境が手に入ったのに合わせてdotfilesを見直した。</p><ul><li><a href=https://github.com/monochromegane/dotfiles>monochromegane/dotfiles</a></li></ul><p>大きくは以下。</p><ul><li>dotfiles管理を<a href=https://www.chezmoi.io/>chezmoi</a>に変更</li><li>開発ツール管理を<a href=https://mise.jdx.dev/>mise</a>に変更</li><li>ターミナルエミュレーターを<a href=https://ghostty.org/>Ghostty</a>に変更</li></ul><p>以下、それぞれについて簡単にメモをしておく。</p><h2 id=chezmoi>chezmoi</h2><p>各ツールの設定などは大幅に変えていないのだが、dotfiles管理には<a href=https://www.chezmoi.io/>chezmoi</a>を導入した。
これまで自作インストールスクリプトは、メンテナンスできていなかったし、設定ファイルの変更後のリポジトリへの反映ルールのようなものがなく反映漏れなど生じていたので、これを機にchezmoiの流儀に任せることにした。</p><h3 id=設定ファイル>設定ファイル</h3><p>既存dotfilesがある場合、ファイルを<code>chezumoi add</code>していくと、chezmoiの命名規則に沿ったファイル名でリポジトリに加えていくことができる。
命名規則はホームディレクトリ以下のディレクトリもしくはファイル名のそれぞれについて<code>.</code>を<code>dot_</code>に置き換えたものになる。
例えば、<code>~/.config/zsh/.zshrc</code>であれば<code>dot_config/zsh/dot_zshrc</code>として管理する。</p><p>自分の場合は、このタイミングでXDG Base Directoryに合わせるようにもしたかったのと新しいPCで<code>~</code>が綺麗だったのもあり、chezmoi側（<code>chezmoi cd</code>で移動できるリポジトリのclone先。<code>~/.local/share/chezmoi</code>）で上記の命名に合わせて変更した上で、<code>chezmoi apply</code>をすることで反映する方法を取った。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ chezmoi init git@github.com:monochromegane/dotfiles.git
</span></span><span style=display:flex><span>$ chezmoi cd
</span></span><span style=display:flex><span>$ mv zshrc dot_config/zsh/dot_zshrc
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>snip<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>$ chezmoi apply
</span></span></code></pre></div><p>今もリポジトリへの反映を忘れないよう基本はchezmoi側で修正してapplyをする運用にしている。</p><p>なお、dotfiles内の実行権限が必要なファイルについてはファイルに属性付与ではなく、<code>bin/executable_git_diff_wrapper</code>のように命名規則で制御する必要がある。</p><h3 id=インストールスクリプト>インストールスクリプト</h3><p>chezmoiではインストールスクリプトも管理できる。
dotfilesリポジトリの直下におくこともできるが<code>.chezmoiscripts</code>という名前のディレクトリを作ると複数スクリプトがあっても整理されるのでこの構成を採用した。</p><p>管理用ツールを導入するからには動作確認の必要な自作スクリプトの役割は最低限にしたかったので、パッケージ管理ツールのインストールのみに抑え、各パッケージのインストールなどはパッケージマネージャーに任せるようにしている。</p><p>具体的には、ツールや開発環境のパッケージ管理のためのHomebrew、miseと、Vim用のミニマルなパッケージ管理である<a href=https://github.com/k-takata/minpac>minpac</a>だけをインストールしている。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ chezmoi cd
</span></span><span style=display:flex><span>$ ls .chezmoiscripts
</span></span><span style=display:flex><span>run_once_after_01_install-brew.sh   run_once_after_03_install-mise.sh
</span></span><span style=display:flex><span>run_once_after_02_install-minpac.sh
</span></span></code></pre></div><p>上記のような命名にすることで、apply後に一度だけスクリプトが順番に実行される。</p><h2 id=mise>mise</h2><p>開発環境やツール類はHomebrewで雑多に入れていたのと、言語ランタイムの<code>*env</code>系が増えてしまっていたのを整理すべく、<a href=https://mise.jdx.dev/>mise</a>に寄せることにした。</p><p>&ldquo;The front-end to your dev env"というコンセプト通り、開発環境構築に関連する多くのことができるのだが、ひとまずは、グローバルに各種言語ランタイムといくつかのツールを入れるようにしている。
ディレクトリごとに<code>mise.toml</code>を作って利用するツールを使い分けられるのはとても良さそう。</p><p>例えば、このブログで使っている<a href=https://gohugo.io/>hugo</a>コマンドなどはブログ用のリポジトリでだけ使えれば良いので<code>mise use go:github.com/gohugoio/hugo@latest</code>とすれば、そのディレクトリ配下では<code>~/.local/share/mise/installs/go-github-com-gohugoio-hugo/0.154.2/bin/hugo</code>がPATH環境変数に追加されてコマンドが認識される状態になる。</p><p>なお、caskが便利なのもあり、しばらくはBrewfileによるHomebrewと併用していくことになると思う。</p><h2 id=ghostty>Ghostty</h2><p>長年iTerm2を使っていて特に不満はなかったが、chezmoi導入にあたって設定をファイルで管理したくなり、Ghosttyを使ってみることにした。</p><p>&ldquo;Zero Configuration Philosophy"を謳っているだけあり、以下の設定で十分、動作も軽快で特に問題なく利用できている。念の為iTerm2もまだ入れているがこのまま乗り換えで良さそう。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>command = /opt/homebrew/bin/zsh -l
</span></span><span style=display:flex><span>mouse-hide-while-typing = true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Theme
</span></span><span style=display:flex><span>theme = Dracula+
</span></span><span style=display:flex><span>background = #0f1015
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Title bar
</span></span><span style=display:flex><span>macos-titlebar-proxy-icon = hidden
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Font
</span></span><span style=display:flex><span>font-family = Moralerspace Neon
</span></span><span style=display:flex><span>font-thicken = true
</span></span><span style=display:flex><span>font-thicken-strength = 1
</span></span><span style=display:flex><span>font-feature = -dlig
</span></span><span style=display:flex><span>font-size = 15
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># Cursor
</span></span><span style=display:flex><span>shell-integration-features = no-cursor
</span></span><span style=display:flex><span>cursor-style = block
</span></span><span style=display:flex><span>cursor-style-blink = false
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># TERM
</span></span><span style=display:flex><span>term = &#34;xterm-256color&#34;
</span></span></code></pre></div><h3 id=フォントとテーマ>フォントとテーマ</h3><p>せっかくなので、フォントやテーマも変更してみた。</p><p>Ghosttyの標準だと日本語表示が微妙だったので、フォントとして<a href=https://github.com/yuru7/moralerspace>Moralerspace</a>を導入し、<code>Neon</code>を設定し、上記設定にあるように太め大きめにしている。</p><p>また、テーマには、ダーク系のテーマでVim側ともマッチするものとして、<code>Dracula+</code>テーマを採用した。
<a href=https://draculatheme.com/ghostty>Dracula Theme for Ghostty</a>としてもあるが、標準で選択できるようになっている。
Vim側も<a href=https://draculatheme.com/vim>Dracula Theme for Vim</a>として公開されているので、minpackで以下のように設定を追加した。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vimrc data-lang=vimrc><span style=display:flex><span><span style=color:#a6e22e>call</span> <span style=color:#a6e22e>minpac</span>#<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#39;dracula/vim&#39;</span>, {<span style=color:#e6db74>&#39;name&#39;</span>: <span style=color:#e6db74>&#39;dracula&#39;</span>})
</span></span></code></pre></div><p>テーマそのままだと背景がグレー寄りで個人的にはややぼやけたように見えてしまうので、Ghostty側で<code>background</code>を設定し、以下のようにctermbgをNoneにすることでGhostty側の背景色と同じにして統一感を出している。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vimrc data-lang=vimrc><span style=display:flex><span><span style=color:#75715e>&#34;colorschemeを設定する</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span>! <span style=color:#a6e22e>s</span>:<span style=color:#a6e22e>customize_dracula_bg</span>() <span style=color:#a6e22e>abort</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>highlight</span> <span style=color:#a6e22e>Normal</span>       <span style=color:#a6e22e>ctermbg</span>=<span style=color:#a6e22e>None</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>highlight</span> <span style=color:#a6e22e>CursorLine</span>   <span style=color:#a6e22e>ctermbg</span>=<span style=color:#a6e22e>None</span> <span style=color:#a6e22e>cterm</span>=underline
</span></span><span style=display:flex><span><span style=color:#66d9ef>endfunction</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>augroup</span> <span style=color:#a6e22e>DraculaCustomization</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>autocmd</span>!
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>autocmd</span> <span style=color:#a6e22e>ColorScheme</span> <span style=color:#a6e22e>dracula</span> <span style=color:#a6e22e>call</span> <span style=color:#a6e22e>s</span>:<span style=color:#a6e22e>customize_dracula_bg</span>()
</span></span><span style=display:flex><span><span style=color:#a6e22e>augroup</span> <span style=color:#a6e22e>END</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>colorscheme</span> <span style=color:#a6e22e>dracula</span>
</span></span></code></pre></div><p>GhosttyでDraculaで、背景色<code>#0f1015</code>の青みがかった夜空みたいな色でコンセプト的にも統一できてなかなか気に入っている。</p><h2 id=その他>その他</h2><p>いわゆるコーディングエージェント系の設定も見直していってるが長くなるのでまた次回とする。</p><h2 id=後記的なもの>後記的なもの</h2><p>昨年、ブログを一本も書いていないことに気づいたのが今日。
年始に『<a href=https://www.kodansha.co.jp/book/products/0000415692>「書くこと」の哲学　ことばの再履修</a>』を読みながら、今回の記事のような、やったことや事実ベースの「書きえる」ことすら書かずして、何を書けようという気持ちからブログ再開してみたのであるが、ただ書き出すことの爽快さを思い出せてとても良かった。
気負わずに再開していきたい。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/></a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2024/12/31/2024/>2024</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2024-12-31</div></time></header><div class=post-inner><p>今年は、九州大学大学院システム情報科学府博士後期課程を修了し、博士（情報科学）の学位を授与されたことが、一番のハイライトだった。
指導くださった先生方、ペパボ研究所の皆さんをはじめとする同僚、切磋琢磨した社会人学生の皆さん、そして家族へ、改めて心から感謝したい。</p><p>達成感でいっぱいであるものの、年度中の博士論文執筆と事業への貢献の両立は、想像以上に大変だった。
研究においては元々、事業への貢献も求められるため、自身の専門領域から様々な分析や提案、実装を並行して進めていたが、博士論文の執筆中は、その複雑さと膨大さゆえに脳内のリソースを極限まで使い続ける日々であり、これまで以上に研究と実務の両立の難易度が高かったように思う。
それでも、最後までやり切ることができたことに、今はただ安堵している。
一方で、これらの分析や提案については、伝え方や巻き込む人々の選定をもっと考えることで、より事業成果につなげられたのではないかという反省もある。</p><p>来年は博士として、今の専門性に加え、さらに高い期待が寄せられる立場となるはずである。
不確実で混沌とした課題領域において、比較・体系化・言語化を通じて、誰もがその課題を共有し、迅速かつ効果的な対策を講じられる基盤を整えることが求められる。
このスキルを活かし、事業に携わる人々が互いの専門性を最大限に発揮し、成果につながる環境を作り上げることを目指していきたい。</p><p>振り返れば、多忙の連続であった一年で、正直なところ鮮明な記憶が残っていない。
それでも、この積み重ねや振り返りが今後の糧になると信じ、今後も一歩一歩進んでいきたい。
来年もどうぞよろしくお願いいたします。</p><h1 id=実績>実績</h1><p>以下、実績を列挙する。</p><h2 id=論文>論文</h2><p>博論と国際会議論文1本。本数としては少なくなってしまったが博論と並行して国際会議に投稿・発表し、博論の質を向上させることができたのは自身を褒めてあげたい。
来年はより水準の高い会議へも挑戦していきたい。</p><ul><li>三宅 悠介, 多様かつ継続的に変化する環境に適応する情報システム, 九州大学博士学位論文, 2024. <a href=https://speakerdeck.com/monochromegane/thesis-defense-presentation>[発表資料]</a></li><li>Yusuke Miyake, Ryuji Watanabe, Tsunenori Mine, <a href=https://ieeexplore.ieee.org/document/10633680>Online Nonstationary and Nonlinear Bandits with Recursive Weighted Gaussian Process</a>, The 48th IEEE International Conference on Computers, Software, and Applications (COMPSAC 2024), pp.11-20, Jul 2024. <a href=https://speakerdeck.com/monochromegane/online-nonstationary-and-nonlinear-bandits-with-recursive-weighted-gaussian-process>[発表資料]</a></li></ul><h2 id=国内発表>国内発表</h2><p>福岡で開催した技術イベントで1回（博論の公聴会を除く）。
来年は全国規模の技術イベントへの復帰を果たしたいところ。</p><ul><li>三宅 悠介 <a href=https://speakerdeck.com/monochromegane/fukuokago20-afa>Go言語でターミナルフレンドリーなAIコマンド、afaを作った</a>, <a href=https://fukuokago.connpass.com/event/330951/>Fukuoka.go#20</a>, 2024年10月.</li></ul><h2 id=oss>OSS</h2><p>AIを開発環境に取り込んでいくためのツール群を整えた。来年はもう一歩先の統合を目指したい。</p><ul><li><a href=https://github.com/monochromegane/afa>AFA - AFA is a terminal-friendly AI command.</a></li><li><a href=https://github.com/monochromegane/afa-tui>AFA-TUI - AFA-TUI is a rich Text User Interface for AFA.</a></li></ul><h2 id=コミュニティ活動>コミュニティ活動</h2><p>Fukuoka.goを再開できたのがよかった。いつの間にか10周年だったので来年3月ごろにお祝い的な会も開催を考えている。学会系では、研究会の運営委員を継続している。</p><ul><li><a href=https://fukuokago.connpass.com/event/330951/>Fukuoka.go#20</a></li></ul><h2 id=ブログ>ブログ</h2><p>3本。ここ数年に比べると増えた。OSS紹介、思い出、考えのまとめなど雑多な内容だが、博士課程が終わってとにかく思いついたら書くことができているので来年も継続的に書いていきたい。</p><ul><li><a href=https://blog.monochromegane.com/blog/2024/09/16/afa/>ターミナルフレンドリーなAIコマンド、afaを作った</a></li><li><a href=https://blog.monochromegane.com/blog/2024/10/05/doctor-information-science/>ペパボに入って12年が経った。気付けば博士になっていた</a></li><li><a href=https://blog.monochromegane.com/blog/2024/12/23/nakayoku/>みんなと仲良くすること</a></li></ul><h2 id=その他>その他</h2><p>研究所で開催した社内向けの勉強会の記事。来年はAI前提を踏まえこれらを事業にどんどん適用していく。</p><ul><li><a href=https://rand.pepabo.com/article/2024/03/28/ai/>AIを前提とした体験の実現に向けての勉強会を開催しました</a></li></ul><p>国際会議採択のニュースリリース。
来年はプレスリリース目指して頑張りたい。</p><ul><li><a href="https://pepabo.com/news/information/202404231200/?_gl=1*19uunue*_ga*MTM3Mjc5NzQyMC4xNzEzODUwNzk1*_ga_LER6JRTV8K*MTczNTY1MzAwMS42MC4xLjE3MzU2NTQ4MzcuMC4wLjA.#_ga=2.198738415.1525457293.1735640790-1372797420.1713850795">ペパボ研究所の論文がIEEEの国際会議「COMPSAC 2024」に採択</a></li></ul></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/%E3%81%B5%E3%82%8A%E3%81%8B%E3%81%88%E3%82%8A>ふりかえり</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2024/12/23/nakayoku/>みんなと仲良くすること</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2024-12-23</div></time></header><div class=post-inner><p>ここ数ヶ月、思うように成果が出なかったことに対するボスからのフィードバックを中心に自分なりに来年の仕事の指針としてまとめておく。</p><p>多くの事業では、環境の変化へ追従するためにプロジェクトの優先順位は目まぐるしく整理・最適化されていく。
また、近年では、データ駆動な意思決定、機械学習やAIのような新しい自動化の導入によって、事業に求められる水準も高度化している。
このような質・量ともに認知負荷の高い状況に対処するため、専門性を高めた分業やチーム体制が出来上がるのは必然である。
しかしながら、例え、各々が目的やビジョンを揃えていたとしても、皆が足並みを揃えて進むことは存外に難しい。
この要因として、分業した専門の観点ごとにゴールまでの過程における課題の内容や具体度が異なることが考えられる。
描く経路が異なれば、当然、足並みが揃うことはない。</p><p>よって、ある程度以上の規模や難易度の仕事を成功させるなら、関わる人々の間での関心度を高めないといけない。
しかし、分業による過程のカプセル化と無関心は紙一重である。
せっかく認知負荷を下げることができたのだから、わざわざ相手の事情を汲むような工程を挟まずに、阿吽の呼吸で足並みを揃えて進んでほしいと思いたくもなる。
それでもやはり、関わる範囲が広範囲だったり内容が高度になるに伴い、表面上の理解や想像による補完では立ち行かなくなってしまう。
だからこそ、互いの専門領域の広さと難しさを前提とし、労力を払って関心を維持することが仕事を成功させるために必要になってくる。</p><p>もちろん、全体としてのコミュニケーションコストを低減させるため、各々の専門領域に照らした道程について、聞き手に応じた表現で過不足なく効率的に伝えることが求められる。
そのために、伝えたいことを抽象的な概念上の枠組みに変換し、効率的に伝えるために図解をはじめとした表現方法を駆使するスキルが求められる。
発信側の労力も抑えるため、この実現にはAIも積極的に活用し、聞き手に応じたバリエーション生成まで即時に行える仕組みも構築したい。
また、関心は関係する人々がそれぞれ双方向に接続されている状態が望ましいが、返報性の原理を期待して、まずは制御可能な自身から関心を維持することを始めるのが良いだろう。</p><p>ペパボで大切にしている三つのことのうち一つに「みんなと仲良くすること」というものがある。
これを表面上の摩擦がない状態と捉えてしまうと無関心に通じてしまうので、仕事の達成を念頭において、伝えるべきことをしっかり伝えるというのが、自身のこれまでの理解であった。
ただ、これも一方向のコミュニケーションに過ぎず、ある種の無関心とも言えるのではないかと考え直したのが今回である。
今後は、仕事を達成するため、もう一段階踏み込んだ「みんなと仲良くすること」を常に意識的に実施していきたい。
そうすることで、無関心による安易な想像に起因する問題を回避したり、問題が生じたとしても、なぜ齟齬が発生しているのかを構造ベースで捉えて建設的に解決に進めることができると思う。</p><hr><p>実際はフィードバックは以下のように端的にまとめてくれていたのだが、自分なりの解釈に落とし込むために書いてみました。これぐらいズバッとまとめられるようになりたい。</p><p><img src=/images/2024/12/boss.png alt=feedback></p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/></a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2024/10/05/doctor-information-science/>ペパボに入って12年が経った。気付けば博士になっていた</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2024-10-05</div></time></header><div class=post-inner><p>先月、博士（情報科学）の学位を取得した。</p><p>12年前、<code>福岡 おもしろい it 会社</code>と検索をして、株式会社paperboy&amp;co.（現GMOペパボ株式会社）に運用開発エンジニアとして転職した時<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>からすると、予想だにしなかった状態である。
転機は2017年1月だった。
ペパボで切磋琢磨できる仲間に恵まれ、OSS活動や登壇を通したアウトプット、社内での成果を自負する一方で、社内でもレベルの高いエンジニアとの仕事の機会を通して、自分の限界も感じ始めていた。
そんな折、研究所の所長から研究職への打診があった。
確か、当時進めていたログ活用基盤の構築とその内容の研究所のコンセプトへの親和性からだったように記憶している。
感じていた限界を「コンピュータサイエンス」ってやつや「研究的アプローチ」ってやつで突破できるかもしれない、研究って何もわからないけれども何とかなるだろう、渡りに船だとばかりにこの誘いに乗ることにした。</p><p>結果、丸々二年間、滑稽なぐらい迷走した<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>。
「研究」をするぞと意気込みは空回りし、研究所の同僚からのアドバイスも虚しく、納得する成果を出せずに時間だけが過ぎ、短時間で効果が出るものを求め悪循環が始まった。
元来の己の精神的な弱さ、四十歳前後という年齢特有の焦り、人生最高潮に達したあらゆるものに対する固執が目を曇らせ、足を引っ張った。
長く暗い時期だったが、ほんとうにほんとうにありがたいことに、さまざまな人に支えられ、何度も内省を進めることでかろうじて持ち直していった。
研究所の同僚、エンジニアと研究者が集うWSA研<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>、研究者の先輩方、そして家族には感謝の念が尽きることはない。
それでも距離をおくことを選択した縁もあり、たくさん迷惑をかけてしまった。</p><p>「研究」は難しい。
これは高度という意味での難しさではなく、ソフトウェアによる課題解決とは目的が違うことに起因する難しさについてである。
博士課程を終えて、研究とは「人類が新たに学べる領域を作り出すこと」であると考えるようになった。
すなわち、ソフトウェアによる課題解決は、目的に連なる目標のうちの一つであり、その解決も含めて、新たに学べる状態に仕上げねばならない。
そして、後進が学べる状態であるには、どこがこれまでの方法と異なるのか、どれぐらいの効果があるのか、それらが主張とその裏付けという形で明確に述べられたかといった要件に落とし込まれる。
これは、論文における「新規性」「有用性」「了解性」の観点に対応し、論文を記述する際には、これらの観点を満たすための様々なサーベイやライティング手法を駆使して臨むことになる。
そのような過程を経ることで初めてそのアウトプットは、未来の誰かの手による学べる領域の更なる拡大を支えていくことができる。
落とし穴は、ソフトウェアによる課題解決を目標ではなく目的に据えてしまうことである。
ここに陥ると、課題の解決こそが研究であり、課題解決のみで研究であるためには、大層な水準の課題を解決せねばならないとなりかねない。
自分が最初に躓いたのはここではないかと思う。</p><p>この頃の自身の振り返りを読むと、感情との付き合い方<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>の他に、研究とは何かを手探りで模索している様子が見て取れる<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup> <sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>。
解決したことを伝えていかないといけないのだな、そのためにはたくさんの根拠を示さないといけないのだな、だから一朝一夕じゃ無理で時間をかけて向き合うことが必要なんだな、程度の理解度ではあるものの、この辺りから前に進み出したのだろうと思う。
2020年6月に初めてジャーナルの採録通知を受け取り<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>、10月には社会人学生として九州大学大学院システム情報科学府博士後期課程へ社会人学生として進学した<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup>。
進学の後押しも研究所の所長だったと思う。
これまでの経緯もあり、及び腰だった自分に「研究職続けるなら博士号はあった方がいいし、いずれは取るのだから最短で効果が出せることをやったらいいんじゃないですか」と言われ、それもそうだなと挑戦を決めた。
暗中模索の中でも進めていた十本弱の研究報告やジャーナルの実績をもって修士を飛ばしての出願と入学が認められたこともあり、積み重ねは無駄じゃなかったなあ、ようしやるぞとここからは順風満帆。
といかないのがいかにも自分らしくて思い出しても苦笑してしまうのだが。</p><p>博士課程の修了には一定数の実績が必要となる。
自分の場合は、在学中に国内ジャーナル論文をもう一本、一定水準以上の国際会議での採択が一回が最低基準であった。
国内ジャーナルこそなんとか通せたものの、国際会議については、2021年5月の初投稿から丸二年、七回目の挑戦にしてようやくの採択となり長い我慢の時期を過ごした<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup>。
そんな中、指導教官は一貫して、研究という最短ルートはない道程において、同じ道を回ることなく、常に何かしらの前進という成果を得るためのアドバイスを与えてくれたと思う。
それは例えば「難しいものと認識した上でそれに挑戦する喜び」であったり「ダメだった場合は改善してただ次に行くだけ」であったり、「自分で決めて悔いのないように進む」こと、そして「結果に対して本質的な面白さを見出して言語化し、これまでの取り組みと有機的に関連づけていくこと」などである。
博士課程という自分の研究の型を体得していく中で、指導教官の存在は本当にありがたいものであった。
指導教官は、分野の専門性が重なっていることが望ましいが、それ以上に相性があると思うので、できれば共著を先に一度執筆するなどコミュニケーションを取れると良いと思う。
幸い、自分の場合は、進学前の共同研究の際に知り合うことができたのでこの点でも恵まれていたと思う。</p><p>とはいえ、博士課程は、自身で主体的に研究を推進しなければならない。
これは、博士課程が「人類が新たに学べる領域を作り出すこと」という研究を達成する、「その方法論を、特定の研究テーマに基づく実践を通して身につける課程」だからだと思われる。
新たに学べる領域を作り上げているのであるから、指導教官にとってもわからない部分を切り開いていくのであり、そしてその開拓の方法は、自身でやり方を模索していかなければならない。
主体性については、能動的に動くことが前提の社会人であれば特段問題にならないかと思う。
博士課程での大変さは、この研究を推し進めるやり方の模索に対するフィードバックが、アウトプットに対してのみ得られるという点だったと思う。
それは主に査読結果や、国際会議での発表に対する議論の形を取るが、いずれにせよ論文の形にまとめる必要がある。
これは研究を学ぶには研究をしなければならないという構造であり、研究テーマ自体も発展させなければならないことも相まって、随分鍛えられたと感じている。
幸い、指導教官のアドバイスはこれに即したものであり、博士論文に着手する前の三年間で研究報告や不採択のものも含めると十六本、おおよそ二、三ヶ月に一本は何かしら研究成果を出して論文執筆していたことになる。
成長が遅いのは仕方ないとはいえ、研究開発員として、事業への貢献も求められる中でも諦めずに課程を継続したことは自分を褒めてあげたい。</p><p>2024年4月には、追加でもう一つ国際会議に採択され、最終的に、入学前のジャーナル論文と合わせて計四本の実績をもとに、学位申請のための博士論文を執筆した<sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup>。
博論の執筆では、これまでの実績を「人類が新たに学べる領域」として再構成する。
四本の論文の整合性を取りながら、領域の世界観の確立も必要で、非常に難易度の高い執筆であり、実績達成以上にまだ大変な工程が残っているのかと驚いた。
しかしながら、この工程を通して初めて、ボトムアップな進め方であった自身の研究テーマに対し、トップダウンからの位置付けを与えることができたように思える。
実際に、自身の研究観である「人類が新たに学べる領域を作り出すこと」というのもこの段階を経て感じるようになった。
これまで各論文においても「新規性」「有用性」「了解性」の観点を満たせるよう突き詰めてきたが、複数論文をまとめる中で、それぞれの点が関連し、補い合う形で（まだ非常に狭いながら）初めて領域として形をなしていったように思う。
なお、世界観の確立については、ペパボ研究所のコンセプトである「なめらかなシステム」についての、所長との数年間に渡るディスカッションが非常に役立った。
このようなハイコンセプトな思考だけでなく実践的にも抽象的にも自在に観点を行き来しながら多面的に研究を見直す機会があるのがペパボ研究所の長所だと思う。
博士課程を考えている方はぜひ検討してほしい。
その後、公聴会を経て、2024年9月25日付けで博士（情報科学）の学位を授与された。
在学は四年間。
標準年度の三年には間に合わなかったが、なんとか修了に漕ぎ着けることができて安堵している。</p><p>さて、ここまでして博士課程を終了する必要はあったのか。そしてこれからも研究をする必要はあるのか。
サンクコストを差し引いたとしても、自分自身としては「はい」と答えたい。
「課題解決」と「研究（新たに学べる領域を作り出すこと）」は相補的な関係であり、それぞれの存在がお互いを必要としていると思う。
また、特にソフトウェアやエンジニアリングの分野においては、それぞれは明確に分離している訳でもないと思う。
研究的なアプローチによって、同じ課題に対しても体系化・一般化・言語化・比較整理などを通して、多面的に捉え直し、新しい観点からちょっと面白い発想が出るかもしれない。
研究による成果物によって、ある課題に対してある状況において有用な方式を広く適用できるかもしれない。
その方式がうまくいかない場合も、理論的な裏付けもしくは再現可能な部分評価を元に、そこから学んで最短で適用できる改善を思いつけるかもしれない。
学べる状態にするのは手間がかかる。
それでもどこかの誰かの巨人の肩になるのだと信じて、研究というのを仕事にする人がいても良いのではないかと思う。</p><p>もちろん、企業研究所に所属する研究員としては、より実践的に、博士課程で得たスキルを早速活用していきたい。
改めて、博士号を取得したということは、不確実で混沌とした課題領域においても、比較・体系化・言語化を通して、誰もがその課題を共有し、時間をかけることなく効果のある対策を講じられる基盤を整えられるスキルを持つ、すなわち、学べる領域を作り出せる人材であることが期待されるようになったのだと思う。
今後は、自身の研究テーマの推進はもちろんのこと、さまざまな施策において、所属する研究所のミッションである「研究開発により『事業を差別化できる技術』を生み出す」ことができるよう、さらに精進していきたい。
そして、これまで辛抱強く支えてくれたペパボに恩返ししていきたい。</p><p>ペパボに入社して十二年。
タイトルの「気付けば」も大袈裟ではなくて、特に研究職になってからは時間が飛ぶようにすぎていった。
それでも、いろんなことがあったけれども、誰かと比較してではなく、過去最高の自分に仕上がっているというのは四十三歳にしては悪くないのではないか。
これからも「虚仮の一念、岩をも通す」の精神で頑張っていきたい。</p><h3 id=お知らせ>お知らせ</h3><p>僕のキャリアを支援してくれたことからも分かるように、GMOペパボ株式会社はどうすればインターネットを面白くできるのか、これを真面目に考えてさまざまななやり方で取り組んでいます。
研究開発的なアプローチに対してでも良いですし、事業に対してでも大丈夫です。
こんなペパボに興味持たれた方、もっと雰囲気知りたい方、お気軽にお声がけください。</p><p><a href=https://rand.pepabo.com/>ペパボ研究所</a></p><h3 id=参考>参考</h3><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=/blog/2016/10/30/5th-year-at-pepabo/>ペパボに入って4年が経った</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=/blog/2017/12/31/2017/>2017年, 12月のライオン</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://websystemarchitecture.hatenablog.jp/>WSA研</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=/blog/2018/08/16/reason/>理性の人</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=/blog/2019/02/25/entrance-of-research/>わかるとわからないの間</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=/blog/2019/11/27/guidepost_for_writing_paper/>論文執筆の道しるべ</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><a href=/blog/2019/12/31/2019/>2019</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><a href=/blog/2020/06/28/my-first-journal/>ペパ研から研究をはじめてジャーナルでのアクセプトまでいけた日</a>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p><a href=/blog/2020/09/21/isee-kyushu-u/>九州大学大学院システム情報科学府博士後期課程に入学します</a>&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p><a href=/blog/2023/12/30/international-conference-struggles/>社会人大学院生の七転び八起き国際会議奮闘記</a>&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p><a href=https://rand.pepabo.com/article/2024/09/25/miyakey-doctor/>博士後期課程を修了し、博士（情報科学）の学位を授与されました</a>&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/%E5%8D%9A%E5%A3%AB%E5%BE%8C%E6%9C%9F%E8%AA%B2%E7%A8%8B>博士後期課程</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2024/09/16/afa/>ターミナルフレンドリーなAIコマンド、afaを作った</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2024-09-16</div></time></header><div class=post-inner><p>Go言語で、AIモデルに対する推論をコマンドラインで実行する<a href=https://github.com/monochromegane/afa>afa</a>というツールを作りました。入出力としてテキストストリームを前提としており、パイプやリダイレクトを用いて他のコマンドと連携しやすいのが特徴です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ echo $ERROR_MESSAGE | afa new -p <span style=color:#e6db74>&#34;What is happening?&#34;</span> /path/to/file1 /path/to/file2
</span></span></code></pre></div><p>与えるプロンプトやコンテキスト情報によってAIモデルが柔軟に振る舞いを変えてくれるので、これまでの個別ツールでは対応が難しかった用途における自動化にも有用でしょう。
また、テキストストリームを扱えるリッチなTUIのコマンド<a href=https://github.com/monochromegane/afa-tui>afa-tui</a>も別途提供しているので、ターミナル上でのチャットも快適です。</p><h2 id=デモ>デモ</h2><h3 id=リッチtuiによるチャット>リッチTUIによるチャット</h3><p>快適なインタラクティブチャットのため、Markdownを装飾して描画しつつ、<code>less</code>コマンド相当の操作感のページャーと、プロンプトの入力欄を持つViewerと連携できます。</p><p><img src=/images/2024/09/chat.gif alt=Chat></p><h3 id=zsh-line-editorzleを用いたターミナル上でのコマンド提案>Zsh Line Editor(ZLE)を用いたターミナル上でのコマンド提案</h3><p>ZLEと連携すれば、コマンドライン上でのプロンプトをそのまま提案されたコマンドに置き換えて実行できます。</p><p><img src=/images/2024/09/command_suggestion.gif alt="Command Suggestions"></p><h3 id=vim上でのコード提案>Vim上でのコード提案</h3><p>Vimと連携すれば、選択範囲のコードを提案されたものに置換できます。使い慣れたエディタであればdiff表示や差分の部分反映もお手のものですね。</p><p><img src=/images/2024/09/code_suggestion.gif alt="Code Suggestions"></p><h2 id=機能一覧>機能一覧</h2><ul><li>ターミナルフレンドリーなAIコマンドとして機能します。</li><li>リッチなターミナルユーザーインターフェース（TUI）を持つチャットクライアントとして機能します。</li><li>システムとユーザーのための文脈に応じたプロンプトをテンプレートを使用してサポートします。</li><li>プロンプト、標準入力、およびファイルパスを文脈として受け付けます。</li><li>セッションを管理し、<code>resume</code> サブコマンドを介して迅速に再開できるようにします。</li><li>安全にエスケープされたJSONオプションで構造化された出力をサポートし、他のコマンドとの統合を容易にします。</li><li>コアアプリケーションはサードパーティライブラリに依存せずに独立して動作します。</li><li>AIモデルとして<code>OpenAI</code>をサポートします（他のAIモデルのサポートは将来計画されています）。</li></ul><p>なお、この文章は、英語で書かれたafaのREADMEのFeatures項目をコピーして、<code>pbpaste | afa new -script -p "翻訳して" | pbcopy</code>で貼り付けました。便利ですね。</p><h2 id=基本的な使い方>基本的な使い方</h2><p>Viewerを使用しないシンプルなチャットを起動する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ afa new
</span></span></code></pre></div><p>Viewerを使用してチャットを起動する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ afa new -V
</span></span></code></pre></div><p>コンテキスト情報を加えてチャットを起動する。コンテキスト情報には「標準入力」「プロンプトメッセージ(-pオプションによるもの)」、そして「ファイルパス」を与えることができる。
ただし、仕様上、標準入力を与えるとキーボードからの入力を継続できないため、インタラクティブなチャットはできない。この場合は、プロセス置換（<code>&lt;()</code>）をファイルパスとして与えることを検討されたい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ echo $ERROR_MESSAGE | afa new -p <span style=color:#e6db74>&#34;What is happening?&#34;</span> /path/to/file1 /path/to/file2
</span></span><span style=display:flex><span><span style=color:#75715e># Please be cautious; when standard input is provided, interactive mode is disabled.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Consider using process substitution.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#=&gt; afa new -p &#34;What is happening?&#34; /path/to/file1 /path/to/file2 &lt;( echo $ERROR_MESSAGE )</span>
</span></span></code></pre></div><p>直近のセッションを再開する。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ afa resume
</span></span></code></pre></div><p>指定したセッションを再開する。なお、<code>afa list</code>コマンドでセッション一覧を表示できる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># The command `afa list` displays past sessions.</span>
</span></span><span style=display:flex><span>$ afa source -l SESSION_NAME
</span></span></code></pre></div><p>ユーザープロンプトを指定する。ユーザープロンプトは、Go言語のテンプレート形式であり、テンプレート内ではプリセットの値としてコンテキスト情報に対応する、<code>Message</code>、<code>MessageStdin</code>、そして <code>Name</code>と<code>Content</code>をメンバとする<code>File</code>構造体のリストである<code>Files</code>を以下のように呼べる。これにより動的なプロンプトの生成が可能となる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># `Message`, `MessageStdin`, and `Files` that include `File` with `Name` and `Content` members can be used in the template file.</span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;Please explain the following.\n{{ (index .Files 0).Content }}&#34;</span> &gt; CONFIG_PATH/templates/user/explain.tmpl
</span></span><span style=display:flex><span>afa -u explain /path/to/file
</span></span></code></pre></div><p>スクリプトモードを指定して起動する。コマンドライン実行に適したモードのオプション設定を一括で行う<code>-script</code>オプションを指定することで、他のコマンドとの連携が容易になる。具体的には<code>-I=false -H=false -S=false -V=false -L=false</code>が設定される。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>pbpaste | afa new -script -p <span style=color:#e6db74>&#34;Transrate this&#34;</span> | pbcopy
</span></span></code></pre></div><p><code>OpenAI</code>の独自機能として提供される<code>Structured Output</code>用のスキーマを指定できる。これは指定したJSON構造体に沿うような出力を強制する機能である。例えば、余分な説明が不要なコマンド提案などに適している。
クオート文字のエスケープを担う<code>-Q</code>オプションと合わせて使うことで<code>jq</code>による整形が容易になるので活用されたい。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat <span style=color:#f92672>&lt;&lt;&lt;</span> EOS &gt; CONFIG_PATH/schemas/command_suggestion.json
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;properties&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;suggested_command&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;additionalProperties&#34;</span>: false,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;required&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;suggested_command&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>EOS
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ P<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;List Go files from the directory named &#39;internal&#39; and print the first line of each file.&#34;</span>
</span></span><span style=display:flex><span>$ afa new -script -Q -j command_suggestion -p $P | jq <span style=color:#e6db74>&#39;. | fromjson&#39;</span> | jq -r <span style=color:#e6db74>&#39;.suggested_command&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#=&gt; find internal -name &#39;*.go&#39; -exec head -n 1 {} \;</span>
</span></span></code></pre></div><h2 id=実践例>実践例</h2><p>実践例を列挙します。
もし使いたい例があれば、GitHubのリポジトリの<a href="https://github.com/monochromegane/afa?tab=readme-ov-file#practical-examples">README</a>にプロンプトや設定例と共に載せているので参考にしてみてください。</p><ul><li>Zsh Line Editor(ZLE)を用いたターミナル上でのコマンド提案<ul><li>デモで紹介したものです</li></ul></li><li>Vim上でのコード提案<ul><li>これもデモで紹介したものです</li></ul></li><li>ターミナルに表示されたエラーメッセージの分析<ul><li><code>tmux</code>の<code>capture-pane</code>を使って直近の実行結果を分析できます。複数行にわたるエラーメッセージのコピペの手間が省けて便利ですね</li></ul></li><li>GitHubのプルリクエストの自動生成<ul><li><code>git diff</code>と<code>git log</code>の情報を元にタイトルと要約を生成してプルリクエストを開きます。ZLEを想定しているので背景情報も踏まえて考えてもらえるようになっています。また、既存のテンプレートの上に要約を差し込む形にしているので、どのリポジトリでも使いやすいかなと思います。</li></ul></li><li>pecoを用いたセッションの絞り込みと読み込み<ul><li>インタラクティブな絞り込みで素早く過去のセッションにアクセスできます。</li></ul></li></ul><h2 id=afa>AFA</h2><p>AFAは<code>AI for All</code>の略で、あらゆるコマンドラインツールに対して連携可能（$\forall x \in X , \exists \mathrm{AI}(x)$、つまりコマンドラインツールの集合<code>X</code>の全ての要素<code>x</code>に対し、その結果を入力とする<code>AI(x)</code>な組み合わせが存在する）なAIコマンドになるといいなと思って付けた名前です。</p><p>現時点でもまだViewerの入力欄が不調になることがあったりWindowsでの動作確認ができていないなど課題はありますが、通常使う分には十分な品質になったと思うので公開しました。よく使うオプションセットをconfigに設定し、いくつかのユーザープロンプトを登録しておいて<code>alias af='afa new'</code>とするだけで、個人的には、調べ物やチャットを含め、ブラウザの利用頻度がかなり減ったことを実感しています。</p><p>Homebrewによるインストール<code>brew install monochromegane/tap/afa monochromegane/tap/afa-tui</code>も提供していますので、よければ使ってみてください。</p><p>将来的には、サーバー上での異常検知のような定式化の難易度が高いタスクでの適用も検討しています（サードパーティー製ライブラリへの非依存とViewerツールとの分離は、そのためでもあります）。AFAであれば、他のコマンドラインツールとの親和性を活かして、通知やロギングは従来の仕組みも活用できると考えています。適用例など共有してもらえたら嬉しいです。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/></a></li></ul><div class=clear></div></footer></div></article><a href=/post/ class=archives>Archives</a></div></div><footer class=footer><div class=author></div><p class=author-name><a href=https://twitter.com/monochromegane target=_blank>@monochromegane</a></p><p>monochromegane (モノクロめがね) と申します。</p><p>最近はもっぱらGoに夢中です。普段は研究開発をやっています。</p><ul class=social><li><a href=https://twitter.com/monochromegane target=_blank><i class="fa fa-twitter"></i></a></li><li><a href=https://github.com/monochromegane target=_blank><i class="fa fa-github"></i></a></li><li><a href=/index.xml target=_blank><i class="fa fa-rss"></i></a></li></ul><p class=copyright><small>&copy; <span>Powered by <a href=http://gohugo.io target=_blank>Hugo</a>, Designed by <a href=https://twitter.com/keita_kawamoto target=_blank>&copy;keita_kawamoto</a></span></small></p></footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/go.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/vim.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-38374674-1","auto"),ga("send","pageview")</script></body></html>