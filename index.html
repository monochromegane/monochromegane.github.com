<!doctype html><html><head><meta name=generator content="Hugo 0.59.0"><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=author content><title>THINKING MEGANE</title><meta name=twitter:card content="summary"><meta name=twitter:site content="@monochromegane"><meta property="og:description" content="THINKING MEGANE"><meta property="og:title" content="THINKING MEGANE"><meta property="og:url" content="https://blog.monochromegane.com/"><meta property="og:image" content="https://blog.monochromegane.com/images/ogp.png"><link rel=stylesheet href=/css/reset.css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Source+Code+Pro" type=text/css><link rel=stylesheet href="//fonts.googleapis.com/css?family=Montserrat" type=text/css><link rel=stylesheet href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/ir_black.min.css><link rel=stylesheet href=/css/text.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/layout.css><link rel=apple-touch-icon-precomposed sizes=57x57 href=/images/apple-touch-icon-57-precomposed.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/images/apple-touch-icon-114-precomposed.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/images/apple-touch-icon-72-precomposed.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=/images/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/images/favicon.ico><link rel=canonical href=https://blog.monochromegane.com/><link href=https://blog.monochromegane.com/index.xml rel=alternate type=application/rss+xml title="THINKING MEGANE"><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async>MathJax.Hub.Config({HTML:["input/TeX","output/HTML-CSS"],TeX:{Macros:{bm:["\\boldsymbol{#1}",1],argmax:["\\mathop{\\rm arg\\,max}\\limits"],argmin:["\\mathop{\\rm arg\\,min}\\limits"]},extensions:["AMSmath.js","AMSsymbols.js"],equationNumbers:{autoNumber:"AMS"}},extensions:["tex2jax.js"],jax:["input/TeX","output/HTML-CSS"],tex2jax:{inlineMath:[['$','$'],["\\(","\\)"]],displayMath:[['$$','$$'],["\\[","\\]"]],processEscapes:true},"HTML-CSS":{availableFonts:["TeX"],linebreaks:{automatic:true}}});</script></head><body><div class=header><header><h1 class=logo><a href=https://blog.monochromegane.com>THINKING MEGANE</a></h1><nav><ul class=menu><li><a href=/self-introduction/>Home</a></li><li><a href=/post/>Archives</a></li><li><a href=/diary/>Diary</a></li><li><a href=http://thinking-megane.blogspot.jp/>Old Blog</a></li></ul></nav></header></div><div class=container><div class=posts><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2020/09/21/isee-kyushu-u/>九州大学大学院システム情報科学府博士後期課程に入学します</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2020-09-21</div></time></header><div class=post-inner><p>先日8/7、九州大学大学院システム情報科学府博士後期課程に無事合格しました。
10/1より入学します。
専攻は情報知能工学[*1]です。</p><p>39歳、文系学士から修士を飛ばして理系の博士課程への挑戦となった経緯や入試に向けた準備などまとめます。</p><h2 id=略歴>略歴</h2><p>大学では環境政策を学びましたが、工学的なアプローチの解決手法の方に興味を持ち、いろいろあってソフトウェアを扱える仕事につきました。
2012年に転職し、現職のGMOペパボでインターネットサービスのWebアプリケーションの開発・運用維持業務に携わってきました。
2017年より同社の研究職として情報システムの自律適応等の研究に従事しています。</p><h2 id=研究員になった理由>研究員になった理由</h2><p>サービスの運用開発の傍ら、<a href=https://speakerdeck.com/monochromegane/pepabo-log-infrastructure-bigfoot>ログ活用基盤の構築</a>に取り組み、サービスを動的に改善していくための仕組みづくりと機械学習に興味を持ち始めたところ、その前年に設立した<a href=https://rand.pepabo.com/>ペパボ研究所</a>でやってみませんかと<a href=https://kentarokuribayashi.com/>@antipop所長</a>に誘われました。</p><p>当時、ソフトウェア開発という非常に強力で柔軟な相棒を得て、OSSを楽しく量産する一方で、独学でやってきたこともあり、解決できる課題規模やアルゴリズムなど実装力に関する頭打ちを感じていました。
そんな折、コンピュータサイエンスや研究的なアプローチを学ぶことでここを突破できるのはないかと思えるこの誘いは非常に魅力的でした。</p><p>完全に未知の職種であること、天職だと思っていたエンジニアからの職種転換ということなど、悩む部分は正直多かったですが、所長との面談の中で「今までやっていることに論文書くのが加わるだけです」と後押しされ、その日のうちに決めました。（今思えば論文として研究をまとめるそれが一番難しいじゃ〜〜という気持ちでいっぱいですが興味があればやってみましょうと後押ししてくれたんだと思ってます）</p><p>実際に、今進めている研究も、インターネットサービスの運用維持の中で発生する課題を、研究というアプローチを用いて解決、サービスへ還元するという、エンジニアリングに研究が加わった方式で進めており、これまでのスキルも十分に活かしながら、研究観点での新規性・有効性・信頼性を追求することができています。</p><h2 id=博士後期課程に入学した理由-大学の選定理由>博士後期課程に入学した理由（大学の選定理由）</h2><p>自身の研究の発展はもちろんのこと、研究を推し進めていく力を高めたいと考え、博士後期課程へ挑戦しました。</p><p>僕の3年間の研究への取り組みは全く順調ではなく、研究活動もテーマも解決手段も評価も論文執筆も暗中模索で、そのくせいつの間にか年齢と共に大きくなっていた自意識が、光となるはずの先達からのアドバイスも歪めてしまっていました。
結果として、<a href=https://blog.monochromegane.com/blog/2017/12/31/2017/>最初の2年ほどは迷走</a>しており、研究所の皆さんには迷惑をかけてしまいました。</p><p><a href=https://blog.monochromegane.com/blog/2020/06/28/my-first-journal/>今年の6月に初めてジャーナルの採録通知をもらい</a>、研究者としての一歩を踏み出したものの、研究への取り組み方はまだまだ下手くそだなあと自分自身考えています。
具体的には、課題解決だけでなく、問題自体への向き合う時間を見直していく必要がありそうです。
過去の迷走の中で、かろうじて掴んだことは、「研究とは、ある問題設定に対する解釈を深めることであり、その問題設定に対して向き合った量が結果につながる（のではないか）」というものでした。
何が課題なのか、どういう世界があるべきなのか、これらは瞬時に明確になるものではなく、試行錯誤やアウトプットとフィードバックによって徐々に練られていく問いですが、この工程を避けてしまうと小手先や思いつきの対策に留まる、もしくは不要に複雑なだけの解法の適用に陥ってしまいます。
周りを見ても、良い研究だなあと思うものは、課題そのものを高度に解決するのはもちろんのこと、問題設定自体にきちんと向き合うことで、研究の位置付けを明確にし、提案手法の汎用性を高めているものがたくさんあります。
特に、モノの見方自体を少しでも変えるような問題設定に昇華した研究には尊敬すら覚えます。
博士後期課程では、自分の研究というものを確立する過程を通して、世界をよくするような研究を推し進める力を高められたらと考えています。</p><p>10月より指導いただく峯先生とは、幸い、既に共著で論文執筆する機会があり、専門性の観点だけでなく、研究の課題や貢献に対する気づきを多数アドバイスいただき、この面でも学ぶことができると考えています。
また、通学が可能な範囲、学費の面での国公立の大学という諸条件も九州大学は満たしており、受験を決めました。</p><h2 id=博士後期課程に向けての準備など>博士後期課程に向けての準備など</h2><p>九州大学大学院システム情報科学府では、社会人特別選抜試験が用意されており、こちらを受験することとなりました。
前提として指導教官との受け入れに関する合意が必要ですが、僕の場合、幸い、既に先生と共著で論文執筆する機会があり、その繋がりで指導についてお願いすることができました。</p><p>出願について、学士である僕は、修士相当の学力を持つという出願資格を認めてもらうため、事前審査が必要でした。
そのため、以下の出願資格を満たすことを証明する内容と研究実績を事前に提出しています。</p><blockquote><p>(7) 文部科学大臣の指定した者
A) 大学を卒業し，大学，研究所等において，２年以上研究に従事した者で，本学府において，当
該研究の成果等により，修士の学位を有する者と同等以上の学力があると認めた者</p></blockquote><p>事前審査のため、通常の出願スケジュールより前倒しで各種書類なども合わせて準備する必要があります。
僕の場合、2020年10月入学の入試に向けて、5月下旬が事前審査の書類提出でしたので4月下旬ごろから関係書類を集めていたようです。
ここで落ちるようなら、修士から臨もうと考えていましたが、幸いにも出願資格を認めてもらうことができました。
もしかしたらここが一番緊張したかもしれません。</p><p>2020年10月入学の入学試験は、口頭試問でした。
これまでの研究実績と博士課程での研究計画に関して発表し、質疑応答という形式です。
限られた時間で3年間の研究実績と研究計画に触れなければならず、羅列ではなくストーリーの中での位置付けと重要な部分の抜粋が必要となり、資料の作成には苦労しました。
それでも、資料作成を通して研究テーマや位置付けの整理が一段階進み、結果として自分の研究とこれからを見直す良い機会になったなあと思います。
せっかくなので公開可能な範囲で資料を公開しておきます。</p><script async class=speakerdeck-embed data-id=74e88544d5e9470d9ef95e2ac094fdcc data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><p>試験を終えた感想としては、事前審査にしろ口頭試問にしろ、そのために慌てて頑張って準備が間に合うようなものではなく、きちんとこれまで積み重ねてきた実績やその課題設定に向き合ってきた量というのが試されたんだろうなあと思います。
なお、完全に余談ですが、マスクをつけて30分程度の発表と質疑応答は酸欠で倒れそうになったので、今後もこのような状況が続くようであればフェイスマスクのような呼吸が楽な装備をお勧めします。</p><h2 id=会社の支援>会社の支援</h2><p>10月より社会人博士課程に挑むことになりますが、所属する研究所において、業務との両立について理解をいただけています。
特に、博士課程の研究テーマにサービスの改善に適用可能なものを選択したことが理解を得やすかった点だと思います。</p><h2 id=これから>これから</h2><p>研究としては、今取り組んでいる推薦システムの自律適応について発展させていきたいと考えています。
<a href=https://www.isee.kyushu-u.ac.jp/internal/isee_tebiki.html>シラバス</a>を見る限り、博士論文に向けて色々指導の時間（指導教官以外の取り組む研究テーマの分野ごとの研究指導や関連研究調査など）があるようで、研究そのものの発展はもちろんのこと目的としている研究力の向上も図れるのではないかなと、今から楽しみです。</p><hr><ul><li>[*1] 2021年度より「情報知能工学専攻」は「情報理工学専攻」に<a href=http://www.isee.kyushu-u.ac.jp/reorganization.html>改組されるとのこと</a>です。</li></ul></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/%E5%8D%9A%E5%A3%AB%E5%BE%8C%E6%9C%9F%E8%AA%B2%E7%A8%8B>博士後期課程</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2020/06/28/my-first-journal/>ペパ研から研究をはじめてジャーナルでのアクセプトまでいけた日</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2020-06-28</div></time></header><div class=post-inner><p>先週の6/22、初めてジャーナルの採録通知をいただいた。</p><p>大学は情報系ではなく、大学院にも行っていないので、研究なるものを始めたのが、<a href=https://rand.pepabo.com/>ペパボ研究所</a>に入った2017年1月から。3年半もかかってしまった。</p><p>元々、サービスの運用開発をしていた経緯もあり、2017年の前半はその延長で研究報告を2本書き切った。
初めての研究報告は、論文の型みたいなのを徹底的に教えてもらえた。
今も執筆時に気をつけるところのほとんどはここで教えてもらったことが根底にあると思う。
2017年の後半から、研究の内容自体も「すごいもの」にしようとした結果、迷走が始まる。
自分のやってきたことを深堀するわけでもなく、先達の研究を調べるわけでもなく、自分の能力を高めるわけでもなく、ただ、目新しいことに挑んでは当然のように跳ね返され、焦りから近道を探し、悪循環に陥る。
研究所内で、（今にして思えばほぼ八つ当たりな）相談したり、WSA研でいろいろな人の研究に対する考え方を聞きながら、自分の中の蓄積や道標をきちんと整備していかなければと考えるようになった。</p><p>2018年は、アドバイス制度を利用して初めてジャーナル投稿に挑戦した。
当時としては全力で取り組んだ論文はあらゆる直接的間接的な表現で「よくわからないです」とアドバイスをいただき、心砕け撃沈した。
まだまだ付け焼き刃な研究は、専門性に対する脆い知識や理論構成であり、指摘に対して一気に瓦解する。
やれることは、専門性を高めることだけなのだが、分野のあまりの広さ・難しさに途方に暮れていた。
この時期は、指摘をまだアドバイスと見なすことができず辛い時期であった。</p><p>2019年の前半は、転換の兆しが見えたが苦しい時期でもあった。
わからないなりに勉強を続け、サーベイを進めた。
自分なりの方向性を見つけ、評価し、効果がある研究ができた。
それでも相変わらず研究報告を上手く書けない。
文章として形が見えていく中で、新しい前提や課題が明らかになり、議論は活発になる。
当たり前のことであり、むしろ喜ばしいことであるのだが、どこかで形を決めなければならない。
この時期は、これは、もっといけるはずだという期待に応えたい気持ちとそれを時間内に解決できない自分の無力感で悪循環に陥ることが多かったのではないかと思う。
そして、この時期の振り返りで、自分と向き合った結果、「結局は、無能だと判断されたくないだとか、集中することができれば大きな成果を出せるはずだとか、心の奥底に対外的な評価が中心に据えられて、自己評価とのギャップと相まって動けなくなっていたことが原因だと思い至」った。</p><p>2019年の後半、これを踏まえ冷静になりつつ、いろいろな人に助力をいただきながら、前に進んだ。
学術系ではないがGo言語の国際カンファレンスのトークセッションに採択された。
ポスターセッションではあるものの学術系では初めて査読ありセッションで採択された。
ジャーナルへももう一度挑戦した。結果はリジェクトであったが、査読者の判定は、条件付き採録と不採録で別れ、メタ査読者からは前半（研究の前提や既存研究に対する位置づけ）は非常に読みやすいとのコメントをいただけた。
後半の提案手法やその評価について、アーキテクチャ含め更新、年内にまた別のジャーナルに提出へこぎつけた。</p><p>2020年、3月にその論文が条件付き採録となり、これに応えて晴れて採録通知を受けたのが先週。
「ペパ研から研究をはじめてジャーナルでのアクセプトまでいけた日」は研究所の所長が言ってくれた。
本当にそうだなあとこれまでのことを思い返して、泣けた。
今にして思えば遠回りばかりして、勝手に袋小路に迷い込んで非効率極まりない反面教師の塊だと思うけれどもこの過程と振り返りがなければ、今の研究もできていないだろうし小さな人間のままだったかもしれない。
これからまた難航することがあるかもしれないが、今はこの経験が今度は乗り切れるのではないかと思わせてくれる。
なんにせよ、自分のような人間が、ジャーナルを通せるところまでたどり着くことができたのは、ひとえに見捨てずに見守りアドバイスをくれ、相談に乗ってくれる周りの方々のおかげです。
遠回りばかりしていますが、これから、改めて巨人の肩に乗ることから逃げずに真摯に向き合い一歩づつ精進していこうと思います。</p><hr><p>今年は他にも、研究チームとしての側面も取り組んで、研究報告ではあるが、はじめて2本ラストオーサーを務めた。
研究所での論文読みや勉強会などの新しい習慣も定着し、今後が楽しみ。
また、自身の研究も前進させ、ジャーナルのアドバイスもうまく取り込めていると思う。
国際会議なども狙っていきたい。
そして、博士課程に挑戦することにした。
まだ結果はわからないが、これまで模索してきた取り組みを加速できると良いなと思う。</p><h1 id=過去の振り返り>過去の振り返り</h1><ul><li><a href=https://blog.monochromegane.com/blog/2017/12/31/2017/>2017年, 12月のライオン</a></li><li><a href=https://blog.monochromegane.com/blog/2018/06/30/first-half-2018/>First Half of 2018</a></li><li><a href=https://blog.monochromegane.com/blog/2018/08/16/reason/>理性の人</a></li><li><a href=https://blog.monochromegane.com/blog/2019/12/31/2019/>2019</a></li></ul></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/%E3%83%9A%E3%83%91%E3%83%9C>ペパボ</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2020/05/31/simulation-framework-stage/>Go言語でシミュレーション用のシンプルなフレームワークStageをつくった</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2020-05-31</div></time></header><div class=post-inner><p>時系列に対するコンピュータシミュレーションを開発する機会が増えてきたので、共通する処理の流れをフレームワーク化した。</p><iframe src="//hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2Fmonochromegane%2Fstage" title=monochromegane/stage class="embed-card embed-webcard" scrolling=no frame border=0 style="width:100%;height:155px;max-width:500px;margin:10px 0">&lt;a href="https://github.com/monochromegane/stage"&gt;monochromegane/stage&lt;/a&gt;</iframe><h2 id=コンピュータシミュレーション>コンピュータシミュレーション</h2><p>状況に応じたクリック数の最大化や変化点検出のような、システムの適応的な振る舞いを検証するために、時系列に対するコンピュータシミュレーションを行うことがある。
また、実環境で発生するランダムな誤差を表現する場合、乱数を用いたシミュレーション技法であるモンテカルロ法も利用することになる。</p><p>このようなシミュレーションのプログラムでは、変化する時系列を入力に、振る舞いのシミュレーション結果を出力するだけではなく、乱数によって発生する誤差を均すためにシミュレーションを数百〜数千回繰り返す必要がある。</p><h2 id=stage>Stage</h2><p>Stageは、これらの一連の流れの実行とこれに伴う煩雑な処理（シミュレーションの並列化、乱数の管理、進捗の監視、ログ出力）を開発者から隠蔽する。
開発者は、時系列や振る舞い、ログフォーマットをGo言語で記述するだけで良い。</p><p>Stageで行っているメイン処理の「疑似コード」は以下の通りシンプルである。</p><pre><code class=language-go>for i := 0; i &lt; iter; i++ {
    sem &lt;- struct{}{}

    go func() {
        scenario := NewScenarioFn(rnd.Int63())
        actor := NewActorFn(rnd.Int63())

        for scenario.Scan() {
            action, _ := actor.Act(scenario.Line())
            w.Write(action.String())
        }
        &lt;-sem
    }()
}
</code></pre><p>このフレームワークでは、メタファーとして劇場(Stage)を採用した。
劇場は、劇を開催する。
その劇は台本(Scenario)があり、演者(Actor)は台本の1行づつのセリフ(Line)に沿って演技を行い、結果(Action)を出力する、といった形だ。
そして劇は何度も繰り返される。</p><p>開発者は、時系列や振る舞いをそれぞれ、ScenarioとActorのinterfaceを実装によって記述する。
また、ログフォーマットもAction interfaceで指定するだけで良い。</p><pre><code class=language-go>type Scenario interface {
	Scan() bool
	Line() Line
}

type Actor interface {
	Act(Line) (Action, error)
}

type Action interface {
	String() string
}
</code></pre><p>あとは実装したScenarioとActorを生成する関数を指定して必要な回数実行。</p><pre><code class=language-go>dir := &quot;log&quot;                    // Directory for output
concurrency := runtime.NumCPU() // Number of concurrency for scenario
seed := 1                       // Seed for random
iter := 3                       // Number of iteration

s := stage.New(dir, concurrency, seed)
s.Run(iter, NewActorFn, NewScenarioFn, stage.NoOpeCallbackFn)
</code></pre><p>結果は、指定したログディレクトに出力され、実行日時や利用した乱数シードも確認することができる。</p><pre><code class=language-sh>log
└── 20200530184234-1 # Timestamp-Seed
    ├── iter_00-a_7947919477105006377-s_5355116748216652230.log # Iteration log files
    ├── iter_01-a_4846631296614585111-s_2007235010091403794.log #   with seed for actor(a)
    └── iter_02-a_0610076349056253918-s_3540139325796113853.log #   and  seed for scenario(s)
</code></pre><p>なお、出力後の解析、グラフ出力については、Stageでは取り扱わない。
任意のフォーマットで出力できるのでお好みの言語やツールで操作して欲しい。</p><p>各インターフェースの具体的な実装方法については<a href=https://github.com/monochromegane/stage/blob/master/README.md>README</a>を参照のこと。</p><h2 id=複数のシナリオを持つシミュレーション例>複数のシナリオを持つシミュレーション例</h2><p>例えば、以下の青線のような変化の仕方が異なるシナリオを切り替えて、橙の線のような振る舞いの違いをシミュレーションすることができる。</p><table><thead><tr><th>Abrupt changes</th><th>Gradual changes</th></tr></thead><tbody><tr><td><img src=https://user-images.githubusercontent.com/1845486/83343338-f8bcbe00-a333-11ea-983b-81ba9a6f8b08.png alt=example_adwin_abrupt></td><td><img src=https://user-images.githubusercontent.com/1845486/83343344-10944200-a334-11ea-9364-b4d4cedcdff6.png alt=example_adwin_gradual></td></tr></tbody></table><ul><li><a href=https://github.com/monochromegane/stage/tree/master/_examples/adwin>複数シナリオの実装例</a></li></ul><h2 id=長時間かかるシミュレーション例>長時間かかるシミュレーション例</h2><p>また、シミュレーションに時間がかかる場合は、各シナリオの完了時に呼ばれるCallback関数を指定することで、進捗の監視もできる。
お好みのProgress barライブラリを使えば進捗バーも表示できる。</p><pre><code class=language-sh>$ go run _examples/progress/main.go
180 / 200 [----------------------------&gt;___] 90.00% 40 p/s
</code></pre><ul><li><a href=https://github.com/monochromegane/stage/tree/master/_examples/progress>プログレスバーの実装例</a></li></ul><h1 id=まとめ>まとめ</h1><p>普段よりアルゴリズムの理解を深めるため手に馴染んだGo言語で実装を試みるので、必然的にシミュレーションもGoで書くことが多くなったことからGo言語での実装となった。
完全に自分用途でつくったフレームワークではあるが、各シミュレーションにおいてシナリオとアクターという要素のみを意識すればよくなり実装の効率が格段に上がりコードの見通しもよくなった。
また、Go言語を使うことで並列化が容易に実装できシンプルなフレームワークでありながら十分に安定して高速化を達成できていると思う。
付加的な利点として、ログ構成などが統一されたことで後段の解析やグラフ化のスクリプトも共通化が進んでおり、個人的に満足度が高いものができたと思う。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/golang>golang</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2020/05/16/bandit-algorithm-ucb1/>多腕バンディット問題におけるUCB方策を理解する</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2020-05-16</div></time></header><div class=post-inner><p>多腕バンディット問題における解法の一つであるUCB1方策では以下のスコアを各腕に対して求め、最大のものを選択する。</p><p>\[
\overline{x}_j+\sqrt{\frac{2\ln{n}}{n_j}} \tag{1}\label{eq-1}
\]</p><p>ここで、$\overline{x}_j$は腕$j$に対して観測された平均報酬、$n_j$は腕$j$が選択された回数、$n$は全体の試行回数である。
第2項は選択された回数$n_j$が少ないほど大きくなることから、評価が不確かな腕ほど積極的に探索を行う（<code>Optimism in face of uncertainty</code>）。</p><p>本エントリでは、この第2項について上記の振る舞い以上の理解を進める。</p><h1 id=確率不等式>確率不等式</h1><p>\eqref{eq-1}式は確率不等式の一種であるヘフディングの不等式に基づいたものであるため、まず確率不等式を学ぶ。
確率不等式は、確率の分布に依らない確率の近似的な評価に利用される不等式である。
簡単には、稀に発生する事象についての確率の上限を求めることができる。</p><h2 id=マルコフの不等式-markov-s-inequality>マルコフの不等式 Markov&rsquo;s inequality</h2><p>非負の確率変数$X\geq0$と任意の正数$a &gt; 0$に対して</p><p>\[
Pr \left[ X \geq a \right] \leq \frac{E[X]}{a} \tag{2}\label{eq-2}
\]</p><p>が成り立つ。\eqref{eq-2}をマルコフの不等式と呼ぶ。</p><p>この不等式を用いることで、確率変数$X$の実現値が$a$以上になる確率の上限を、確率分布に依らず期待値$E[X]$から求めることができる（ただし$a \leq E[X]$だと実用的な値にならない）。</p><p>マルコフの不等式を用いて例えば「期待値が10の確率変数で100以上が出る確率は10%以下」（$Pr \left[ X \geq 100 \right] \leq \frac{10}{100} = 0.1$）などと求めることができる。</p><p>証明は</p><p>\begin{align}
E[X] &amp;= \int_0^\infty x f(x) dx \notag \\ &amp;= \int_0^a x f(x) dx + \int_a^\infty x f(x) dx \notag \\ &amp;\geq \int_a^\infty x f(x) dx \notag \\ &amp;\geq \int_a^\infty a f(x) dx = a \int_a^\infty f(x) dx = a Pr [X \geq a] \notag \<br>\end{align}</p><p>となる。なお、2行目から3行目は、右辺第1項が$\geq 0$であるため。3行目から4行目は積分区間で最も小さい$a$を使うため。</p><h2 id=チェビシェフの不等式-chebyshev-s-inequality>チェビシェフの不等式 Chebyshev’s inequality</h2><p>確率変数$X$が期待値$E[X]=\mu$、分散$\sigma^2$を持つとき、任意の正数$a &gt; 0$に対して</p><p>\[
Pr \left[ \mid X - \mu \mid \geq a \sigma \right] \leq \frac{1}{a^2} \tag{3}\label{eq-3}
\]</p><p>が成り立つ。\eqref{eq-3}をチェビシェフの不等式と呼ぶ。</p><p>この不等式を用いることで、確率変数$X$の実現値と期待値$\mu$の差が標準偏差$\sigma$の$a$倍以上になる確率の上限を、確率分布に依らず期待値$\mu$と分散$\sigma^2$から求めることができる。</p><p>証明は、マルコフの不等式に対して$X = (X-\mu)^2$と$a=a^2\sigma^2$とおいた時、</p><p>\[
Pr[(X-\mu)^2 \geq a^2\sigma^2] \leq \frac{E[(X-\mu)^2]}{a^2\sigma^2} = \frac{\sigma^2}{a^2\sigma^2} = \frac{1}{a^2} \\ Pr[\mid X-\mu \mid \geq a\sigma] \leq \frac{1}{a^2}
\]</p><p>となる。なお、少し工夫して$a=a^2$とすると</p><p>\[
Pr[(X-\mu)^2 \geq a^2] \leq \frac{E[(X-\mu)^2]}{a^2} = \frac{\sigma^2}{a^2} \\ Pr[\mid X-\mu \mid \geq a] \leq \frac{\sigma^2}{a^2}
\]</p><p>のように、確率変数$X$の実現値と期待値$\mu$の差を標準偏差$\sigma$を使わずに表現できる。この場合例えば「期待値が10で標準偏差が5の確率変数で100以上が出る確率は0.31%未満」（$Pr[X-10 \geq 90] \leq \frac{5^2}{90^2} = 0.00308&hellip;$）などと求めることができる。</p><h2 id=ヘフディングの不等式-hoeffding-s-inequality>ヘフディングの不等式 Hoeffding’s inequality</h2><p>独立な$n$個の確率変数$X[a,b]$において平均を$\overline{X}$、期待値を$E\left[\overline{X}\right]$とおいた時、任意の正数$u &gt; 0$に対して</p><p>\[
Pr \left[\overline{X}-E\left[\overline{X}\right] \geq u\right] \leq \exp\left(-\frac{2n^2u^2}{\sum_{i=1}^{n}(b_i-a_i)^2}\right) \tag{4}\label{eq-4}
\]</p><p>が成り立つ。\eqref{eq-4}をヘフディングの不等式と呼ぶ。</p><p>この不等式を用いることで、n個の確率変数$X$の平均と期待値の誤差が$u$以上になる（すなわち真の期待値を過大評価している）確率の上限を、確率分布に依らずに求めることができる。</p><p>同様に真の期待値を過小評価している確率の上限は、</p><p>\[
Pr \left[-\overline{X}+E\left[\overline{X}\right] \geq u\right] \leq \exp\left(-\frac{2n^2u^2}{\sum_{i=1}^{n}(b_i-a_i)^2}\right) \tag{5}\label{eq-5}
\]</p><p>であり、真の期待値に対して$u$以上の誤差が生じる確率の上限は\eqref{eq-4}と\eqref{eq-5}を合わせた、</p><p>\[
Pr \left[\mid \overline{X}-E\left[\overline{X}\right] \mid \geq u\right] = Pr \left[\overline{X}-E\left[\overline{X}\right] \geq u\right] + Pr \left[-\overline{X}+E\left[\overline{X}\right] \geq u\right] \tag{6}\label{eq-6}
\]</p><p>となる。</p><p>また、確率変数$X[a,b]$で$a=0,b=1$の時、\eqref{eq-4}より</p><p>\[
Pr \left[\overline{X}-E\left[\overline{X}\right] \geq u\right] \leq \exp\left(-\frac{2n^2u^2}{n}\right) = \exp\left(-2nu^2\right)\tag{7}\label{eq-7}
\]</p><p>同じく\eqref{eq-5}より</p><p>\[
Pr \left[-\overline{X}+E\left[\overline{X}\right] \geq u\right] \leq \exp\left(-\frac{2n^2u^2}{n}\right) = \exp\left(-2nu^2\right)\tag{8}\label{eq-8}
\]</p><p>である。証明は論文に譲る。</p><h1 id=ucb1方策>UCB1方策</h1><p>UCB1方策では、ヘフディングの不等式\eqref{eq-8}を用いて、腕$j$の報酬の期待値の信頼区間の上側の上限である\eqref{eq-1}を求める。
\eqref{eq-1}を再掲する。</p><p>\[
\overline{x}_j+\sqrt{\frac{2\ln{n}}{n_j}} \tag{1}
\]</p><p>腕$j$の報酬の期待値を$x^*_j$とすると\eqref{eq-8}は</p><p>\[
Pr \left[x^*_j \geq \overline{x}_j + u\right] \leq \exp\left(-2n_ju^2\right)\tag{9}\label{eq-9}
\]</p><p>\eqref{eq-9}は真の期待値を過小評価している確率の上限であり、これを試行回数$n$が進むごとに小さくしたいと考える。そこで右辺を$n^{-m}=\frac{1}{n^m}$とすると、</p><p>\begin{align}
\exp\left(-2n_ju^2\right) &amp;= \frac{1}{n^m} \notag \\ -2n_ju^2 &amp;= \ln{\frac{1}{n^m}} \notag \\ &amp;= \ln{1} - \ln{n^m} \notag \\ &amp;= 0 - m\ln{n} \notag \\ 2n_ju^2 &amp;= m\ln{n} \notag \\ u^2 &amp;= \frac{m\ln{n}}{2n_j} \notag \\ u &amp;= \sqrt{\frac{m\ln{n}}{2n_j}} \notag
\end{align}</p><p>が得られる。理論限界より$n$回目の試行において$1/n$の確率で各腕が選択する必要があるとされており、これに従えば$m=1$だが、論文では$m=4$としている（すなわち$u = \sqrt{\frac{2\ln{n}}{n_j}}$）。</p><p>これを\eqref{eq-9}に代入し</p><p>\[
Pr \left[x^*_j \geq \overline{x}_j + \sqrt{\frac{2\ln{n}}{n_j}}\right] \leq \frac{1}{n^4}\tag{10}\label{eq-10}
\]</p><p>よって$1/n^4$の上限において、\eqref{eq-1}のスコアを用いて報酬の期待値を最も低く見積もっているであろう腕を選択することができる。すなわち<code>Optimism in face of uncertainty</code>に従う。</p><h1 id=参考>参考</h1><ul><li><a href=https://ja.wikipedia.org/wiki/%E3%83%9E%E3%83%AB%E3%82%B3%E3%83%95%E3%81%AE%E4%B8%8D%E7%AD%89%E5%BC%8F>マルコフの不等式</a></li><li><a href=https://ja.wikipedia.org/wiki/%E3%83%81%E3%82%A7%E3%83%93%E3%82%B7%E3%82%A7%E3%83%95%E3%81%AE%E4%B8%8D%E7%AD%89%E5%BC%8F>チェビシェフの不等式</a></li><li><a href="https://www.youtube.com/watch?v=d-ugoDdXWrU">【大学数学】チェビシェフの不等式【確率統計】- 予備校のノリで学ぶ「大学の数学・物理」</a></li><li><a href="http://stat.inf.uec.ac.jp/lib/exe/fetch.php?media=prob:prob-9-note-and-quizes-20120614.pdf">確率論 (Probability Theory) 第 9 週</a></li><li><a href=https://en.wikipedia.org/wiki/Hoeffding%27s_inequality>Hoeffding&rsquo;s inequality</a></li><li><a href=http://repository.lib.ncsu.edu/bitstream/1840.4/2170/1/ISMS_1962_326.pdf>Hoeffding, Wassily (1963). &ldquo;Probability inequalities for sums of bounded random variables&rdquo;. Journal of the American Statistical Association. 58 (301): 13–30.</a></li><li><a href=https://homes.di.unimi.it/~cesabian/Pubblicazioni/ml-02.pdf>Auer, Peter, Nicolo Cesa-Bianchi, and Paul Fischer. &ldquo;Finite-time analysis of the multiarmed bandit problem.&rdquo; Machine learning 47.2-3 (2002): 235-256.</a></li><li><a href=https://ludu-vorton.hatenablog.com/entry/2019/06/06/073000>ヘフディングの不等式(Hoeffding&rsquo;s inequality)と諸々の確率の評価の不等式</a></li><li><a href=https://qiita.com/usaito/items/ad15394547bd5daf8937>バンディットアルゴリズムで最適な介入を見つける（基本編）</a></li><li><a href=https://research.miidas.jp/2020/02/%E3%83%90%E3%83%B3%E3%83%87%E3%82%A3%E3%83%83%E3%83%88%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0%E3%81%AE%E7%B6%9A%E3%81%8D/>バンディットアルゴリズムの続き</a></li><li><a href=https://www.slideshare.net/nishio/1-70974083>強化学習その1</a></li><li><a href=https://www.amazon.co.jp/dp/406152917X/>バンディット問題の理論とアルゴリズム (機械学習プロフェッショナルシリーズ)</a></li></ul></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/bandit>bandit</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2020/04/29/why-fukuokago/>なぜ勉強会「だった」のか</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2020-04-29</div></time></header><div class=post-inner><p>主催するFukuoka.goでは2〜3ヶ月に一度の割合で登壇形式の勉強会を開催している。
昨今の状況を受けて前回こそYouTubeを使ってリアルタイム配信を行ったものの、この状況が続くあるいは当たり前になるならば、地域言語コミュニティをどう運営していくべきか考えないといけないだろうなと思う。</p><p><blockquote class=twitter-tweet><p lang=ja dir=ltr>Fukuoka.go#16 をそろそろやろうかなと思いつつ、オンライン開催が前提で、もはや地理的な制約もない中で、このコミュニティで本当に実現したいことを改めて考えてみるなど。さて、どう楽しみますかねえ</p>&mdash; モノクロメガネ研究員 (@monochromegane) <a href="https://twitter.com/monochromegane/status/1255359093058961412?ref_src=twsrc%5Etfw">April 29, 2020</a></blockquote><script async src=https://platform.twitter.com/widgets.js></script></p><p>このエントリは、これまでの勉強会やカンファレンスではなぜ物理的に集合するのか、を自分の中で整理した上で、オンライン開催のありようを考える材料を見つけようとするものです。</p><h1 id=なぜ物理的に集合するのか>なぜ物理的に集合するのか</h1><p>これまでの勉強会やカンファレンスではなぜ物理的に集合していたのか。</p><p>今年、オンラインでの開催を余儀なくされた様々な勉強会やカンファレンスでは（それなりの運営の苦労はありつつも）比較的スムーズに移行できており、これはそのようなインフラが整っていたということに他ならない。
一方で、これだけのインフラがある中、必要に迫られるまでは物理的に集合していたということは、この行為になんらかの利点があると考えるのが妥当だと思う。</p><p>物理的に集合する勉強会やカンファレンスでは、登壇者の発表を聞き、質疑があり、飲食の機会が提供される。
同じ場に集ってリアルタイムに同時多発的に発生した議論によって、場には総体として大きくなった知が形成される。
参加者は、場によって増幅された知を様々な形で受け取る。
あるひとは有意義な情報として、あるひとはモチベーションとして。
想定より多くの量を得ることができる人もいれば、あまり得るものがなかった人もいるかもしれない。
主催者は、なるべくその機会を増やすべく、趣向を凝らす。</p><p>勉強会やカンファレンスというのは、興味関心を同じくするものの初対面の人たちを含む集団が限られた時間で効率よく、知の増幅を場に形成するための枠組みであると言える。</p><ul><li>発表者が資料を用意して丁寧に説明することで、「同じ事」を、</li><li>日程や会場を揃えることで、「同じタイミング」で、</li><li>質疑応答の機会や飲食による雰囲気を使って、「同じ立場」で、</li></ul><p>参加者は一緒に考え、場を作っていく。</p><p>これまでは、物理的な集合を伴う勉強会やカンファレンスを開催することで、自然とこの枠組みに乗って、知の増幅を場に形成する機会を提供できていた。
物理的な集合を伴わないオンライン開催が前提になれば、これらを達成するための仕組みを意識的に演出しなければならない（あるいは目的自体を変える？）</p><h1 id=オンライン開催は代替となるのか>オンライン開催は代替となるのか</h1><p>せっかくオンラインでやれるのだから、漠然とこれまでの勉強会の代替ではなく、目的を明確にした上で技術的に解決できるといいなと思っている。</p><p>知の増幅を場に形成するのであれば、物理的な集合を伴わないオンライン開催であっても、登壇のリアルタイム配信によって参加者が、同じことを同じタイミングで考えることは有効だろう。
実際、難しいのは、「同じ立場」の部分だと思う。</p><p>興味関心を同じくするものの初対面の人たちが短時間で気兼ねなく議論できる状態を作りたい。
明示的な質疑応答の機会はもちろん必要だろう。
それでも、議論が深くなるとき、もしくは個別化しそうな時、同じミーティングルーム内で即座に個別かつ双方向に話せるだろうか。
昨年、登壇したGopherConでは、発表後はもちろんのこと、廊下でのすれ違うタイミングで感想や質問をたくさん受けた。そういうことを再現できないだろうか。</p><p>問題意識の方向性やレベル感が同じくする人を積極的に見つけて、同じ立場の中でクラスタリングされて、その問題を本当に考えたい人が凝縮して、それぞれの知を増幅して、総体として大きくなった知が形成される。</p><p>この辺りの、集団から始まって最終的に、個と個をダイナミックにつなげる部分をなんとか解決していきたいと思う。</p><h1 id=fukuoka-goはどうするのか>Fukuoka.goはどうするのか</h1><p>どうしよう。</p><p>Fukuoka.goは長期的にみて知の増幅を地域に形成できる（といいな）というあたりを狙っているので、主催者が楽しんで継続できることを大切にしています。
色々それらしきことを述べてみたものの、主催者のモチベは単純には「僕の最近のGo取り組みで面白かったものを聞いてください。よければご飯もどうですか」だったりもするので、オンライン飲みの余興で発表、とか、登壇を動画で配信とかでもいいのかもしれない。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/></a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2020/04/29/wsa6_sifter/>軽量なインデックス機構を用いた全文検索ツールの高速化の検討</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2020-04-29</div></time></header><div class=post-inner><p>このエントリは、<a href=https://websystemarchitecture.hatenablog.jp/entry/2019/12/11/165624>第6回 Web System Architecture 研究会 (WSA研)</a>の予稿です。</p><h1 id=概要>概要</h1><p>コマンドラインによる全文検索ツールの検索速度は、キャッシュ機構、並列化や効率的なアルゴリズムの導入によって高速化が図られている。一方で、これらのツールは、検索対象の変更や削除への追従を避けるためインデックスの採用を行なっておらず、都度検索対象に対して全探索を行う。</p><p>全文検索ツールに対するインデックス機構の課題を整理、解決し、インデックス機構を採用することができれば、検索対象を限定した、より高速な検索が可能になると考えられることから、本稿では、軽量なインデックス機構を用いた全文検索ツールの高速化の検討を行う。</p><p>提案手法では、インデックス機構に計算量と情報量の観点で効率的に扱うことのできるブルームフィルタを採用する。 まず全ての検索対象に対してブルームフィルタを作成し、結合・転置した軽量なインデックスを生成する。 次に検索対象へのクエリを行う前にインデックスから候補を取得し、全文検索ツールがこれを検索する。 検索対象の変更や削除への追従に対しては、インデックスを都度再生成する方式を採用するが、生成の高速化により利用者が負担とすることなくこれを行える。</p><p>評価では、提案手法を組み合わせることで、全文検索ツールの検索時間が短縮することを確認する。</p><h1 id=発表スライド>発表スライド</h1><p>提案手法のアーキテクチャ、ならびに具体的な実装である<a href=https://github.com/monochromegane/sifter>monochromegane/sifter</a>とこれによる軽量・高速・汎用性についての評価は発表スライドを参照のこと。</p><script async class=speakerdeck-embed data-id=b290ecaaf9d24927b528991ac76f9c89 data-ratio=1.77777777777778 src=//speakerdeck.com/assets/embed.js></script><h1 id=まとめ>まとめ</h1><p>本研究会では軽量なインデックス機構を用いた全文検索ツールの高速化の検討とその参考実装を評価した。
インデックス機構としてブルームフィルタを用いることで少ないメモリ使用量と問い合わせの高速化が達成でき、インデックス操作のツールに分離することで任意の全文検索ツールとの連携による汎用性を備えることができた。
結果として、評価では全文検索ツールとの組み合わせにおいて大幅な検索時間の短縮を確認した。</p><p>一方で、インデックス構築時間の長さを解消することは、利用者にとっての負担の改善の観点から最優先で取り組まなければならない。
ブルームフィルタにおけるハッシュ関数のボトルネックは多く研究されていることから、これを取り込むこと、また、ハッシュ関数の実行回数を減らしながら精度を保つことができるような効率的なトークン化を調べる必要がある。
実装面ではハッシュ関数の結果は再利用できるため、キャッシュ機構の導入も効果があると考える。</p><p>今後は問い合わせ自体にオーバーヘッドが発生するようなアーキテクチャとの連携も検討し、Webシステムの分野へ研究を発展させたい。</p><h1 id=発表を終えて>発表を終えて</h1><p>今回のWSA研は初のリモート開催で新しい顔ぶれも揃い、6回目ながらに新鮮な気持ちで楽しめた。
自身の発表でも、あまり気負いすぎずに頭の中で温めていたアイディアを形にして議論として発展できればいいなぐらいで臨んだ。
結果的に、まずは発表に向けて形にして評価することで長所短所が明確になり、参加者から新しいアイディアのヒントをもらうことができた。
特に、これまでプラチナサーチャーでの全文検索の高速化は、システムコールやバッファ確保の効率化やタスクの並列化といったプログラミングの実装面でのアプローチがほとんどであったため、アルゴリズムの観点からの取り組むためのとっかかりを色々議論できたと思う。
この分野は先人の知恵が大量にある分野なので、色々勉強しつつプラチナサーチャーの進化系も考えていきたい（研究会終わった後の夜中に考えていた方法がSuffix Trieと同じだと気づいて、巨人の肩に乗るべく、まずは<a href="https://www.amazon.co.jp/gp/product/4000069748/ref=as_li_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4000069748&amp;linkCode=as2&amp;tag=monochromeg03-22&amp;linkId=1f321dceee1ea3723f7c384f5f3460cb">高速文字列解析の世界――データ圧縮・全文検索・テキストマイニング (確率と情報の科学)</a>を注文した）</p><p>このような普段の研究から少し離れた取り組みであっても、定期的に発表を促されることで形にすることができるのはとても大切で、やりっぱなし学びっぱなしではなく一つの区切りまで考え実装することで次回以降の研究への糧となる。
Webシステムアーキテクチャに関する運用知見を研究的アプローチで前進させること興味がある方は次回開催の参加を検討してみてはいかがでしょうか。</p><ul><li><a href=https://websystemarchitecture.hatenablog.jp/entry/2017/11/16/182041>Web System Architecture研究会の発足と挨拶</a></li><li><a href=https://websystemarchitecture.hatenablog.jp/purpose>研究会の目的</a></li></ul><p>＊次回は9月の後半のようです。</p></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/wsa%E7%A0%94>WSA研</a></li></ul><div class=clear></div></footer></div></article><article><div class=post><header><h1><a href=https://blog.monochromegane.com/blog/2020/03/11/dynamic-gamma-poisson/>Dynamic Gamma-Poisson modelを試す</a></h1><time><div class=day><i class="fa fa-calendar-o day-icon"></i>2020-03-11</div></time></header><div class=post-inner><p><a href=https://speakerdeck.com/monochromegane/fukuokago15-adwin-exphist>以前のADWINのように</a>、変化する環境において適応的に振る舞うための仕組みについて調べる中で以下の論文で紹介されていたDynamic Gamma-Poissonモデルについてベイズ推定の理解を兼ねて試してみたのでメモ。</p><ul><li><a href=http://www2009.wwwconference.org/proceedings/pdf/p21.pdf>Agarwal, Deepak, Bee-Chung Chen, and Pradheep Elango. &ldquo;Spatio-temporal models for estimating click-through rate.&rdquo; Proceedings of the 18th international conference on World wide web. 2009.</a></li></ul><h1 id=ベイズ推定>ベイズ推定</h1><p>統計モデルとは</p><blockquote><p>「ある確率変数$Y$の実現値$y=\{y_1,y_2,..,y_n\}$から、$Y$が本来従う確率分布（真の分布）を推定するためのもの」</p></blockquote><p>とされている。
ベイズ推定はベイズの定理に基づいて観測したデータと過去の情報からデータの本来従う確率分布を推定する。</p><p>ベイズの定理 $p(\theta \mid y) \propto p(y \mid \theta)p(y)$ に対して右辺（尤度x事前確率）が具体的な確率値でかつ分布が数え上げられるような単純な場合は理解は比較的容易。</p><ul><li><a href=https://mathtrain.jp/bayesinfer>ベイズ推定の簡単な例と利点</a></li></ul><p>一方で、データの確率分布がパラメタによって変動するような確率質量関数や確率密度関数に従う場合、<strong>そのパラメタ（母数）の分布を推定する</strong>ことで、（分布の種類が分かっていればパラメタの推定が分布の特定になるので）データの従う確率分布を推定できる。
この時、データの分布の種類に応じた事前分布を選択することで事後分布が求めやすくなる（共役事前分布）。</p><p>このようなパラメタを推定するようなベイズ推定に関しては以下の資料が理解の助けになる。</p><ul><li><a href=https://www.slideshare.net/miyoshiyuya/ss>ベイズ統計学入門</a></li><li><a href=https://mutopsy.net/pdf/note_sta_bayesian01.pdf>ベイズ推定の初歩 二項分布を例に</a></li><li><a href=https://ocw.mit.edu/courses/mathematics/18-443-statistics-for-applications-spring-2015/lecture-notes/MIT18_443S15_LEC8.pdf>Parameter Estimation Fitting Probability Distributions Bayesian Approach</a></li></ul><p>以下、ポアソン分布のパラメタ推定を例にベイズ推定の理解を深め、これを拡張したDynamic Gamma-Poissonモデルを説明する。</p><h2 id=ポアソン分布>ポアソン分布</h2><p>単位時間に平均$\lambda$回起きる事象が単位時間に$k$回発生する分布。</p><p>平均が$\lambda$のポアソン分布を表す確率質量関数は\[P(X=k)=\frac{\lambda^{k}}{k!}\cdot e^{-\lambda}\]であり平均$E[X]$は$\lambda$となる。</p><h2 id=ポアソン分布のパラメタ-lambda-を推定する>ポアソン分布のパラメタ$\lambda$を推定する</h2><p><a href=https://ocw.mit.edu/courses/mathematics/18-443-statistics-for-applications-spring-2015/lecture-notes/MIT18_443S15_LEC8.pdf>Parameter Estimation Fitting Probability Distributions Bayesian Approach</a>のp.19の例を元に説明する。</p><ul><li>$X_1,X_2,..,X_n$ $i.i.d.$ $Poisson(\lambda)$<ul><li>単位時間に平均$\lambda$回起きる分布に従う確率変数の実現値を$n$回観測</li><li>$X_i$は0以上の整数値</li></ul></li><li>$lik(\lambda) = f(x_1, x_2,..,x_n \mid \lambda) = \prod_{i=1}^n f(x_i \mid \lambda)$<ul><li>尤度はパラメタ$\lambda$において観測した値が得られる確率（この場合は上述したポアソン分布の確率質量関数$P(X=x_i)$）</li><li>複数回観測した場合はその同時確率</li></ul></li><li>$\lambda \sim Gamma(\alpha, \nu)$<ul><li>事前分布、つまり、$\lambda$が「ある値（の範囲）」を取る確率</li><li>今回は事前分布にガンマ分布を仮定する（ポアソン分布の共役事前分布）</li><li>$\pi(\lambda)$</li></ul></li><li>$\pi(\lambda \mid x) \propto lik(\lambda) \times \pi(\lambda)$<ul><li>ベイズの定理より事後分布は尤度x事前分布で求められる</li><li>$P(x\mid\lambda)P(\lambda)$なので、$\lambda$の分布から観測値$x$が得られる確率と言える</li></ul></li><li>$Gamma(\alpha^*,\nu^*)$ with $\alpha^*=\alpha+\sum_{1}^n x_i$ and $\nu^*=\nu+n$<ul><li>上を計算すると事後分布は観測された$x$の値の合計を$\alpha$に、観測回数$n$を$\nu$に加えたものをパラメタとするガンマ分布とみなせる</li><li>観測したデータから$\lambda$の分布（確率変数が従う確率分布（分布の種類はわかっているのでそのパラメタ））を推定した</li></ul></li></ul><h1 id=dynamic-gamma-poissonモデル>Dynamic Gamma-Poissonモデル</h1><p>論文3.1によれば、クリック数$c$、閲覧数$v$、CTRを$\theta$としたときに、</p><ul><li>平均$v\theta$(=$\lambda$)である$Poisson(\lambda)$に従い観測されたクリック数から</li><li>$\theta$の事前分布に平均が$\alpha/\gamma$、分散が$\alpha/\gamma^2$である$Gamma(\alpha,\gamma)$を仮定して</li><li>$\theta$の事後分布を$Gamma(\alpha+c,\gamma+v)$として得られるとしている</li></ul><p>ただし、実際はこの推定は$\lambda$の推定であるため、CTRとして考えるために以下のように考える。</p><ul><li>$\lambda$を1閲覧($v$)の間の平均回数と考える（つまり$\lambda=1*\theta$）</li><li>1閲覧に該当する期間を閲覧数分、観測した</li><li>これによって推定された$\lambda$は$\theta$と等しくなる</li></ul><p>ここで、$Gamma$のパラメタはこれまでのクリック総数と閲覧総数であることから、$\lambda$の値が変化する場合に過去のデータに引きづられてしまい、速やかな追従を行うことができない。
論文では、Dynamic Gamma-Poissonモデルとして過去の観測結果に対する割引の概念を導入することでこれを解決する。
実現はシンプルで、割引率$(0&lt; \delta \leq1)$を導入し、事後分布を$Gamma(\delta\alpha_{t-1}+c_t,\delta\gamma_{t-1}+v_t)$のように求める。
これによって累積された過去の総数を減らし、直近のデータに重み付けが行われる。
論文中では0.95から1の間ぐらいが良い結果を得たとしている。</p><p>以下、実際に同じ条件での$\lambda$の推定を通常のGamma-PoissonモデルとDynamic Gamma-Poissonモデルで行ったものを比較する。
評価では、CTRが0.4のアイテムに対して1ステップごとに7回の閲覧が行われた際のクリック数を観測データとした。
また、20ステップ目にCTRが半分の0.2になっている。</p><p><img src=/images/2020/03/dgp.gif alt=dgp></p><p>評価期間内では通常の推定の期待値0.3程度までの追従に止まったが、Dynamicな手法ではより早く実際のCTRである0.2に近づけたことが分かる。</p><h1 id=動作確認用のコード>動作確認用のコード</h1><p>動作確認用のコードは以下にある．</p><ul><li><a href=https://gist.github.com/monochromegane/942444fdf89735e7e273d5c7126df449>dgp.py</a></li></ul><p>このような感じで利用できる．</p><pre><code class=language-sh>python dgp.py --lambda_ 0.4 --view 7 --delta 0.9
</code></pre></div><footer class=tag><i class="fa fa-tags tag-icon"></i><ul><li><a class=tag-link href=/tags/></a></li></ul><div class=clear></div></footer></div></article><a href=/post/ class=archives>Archives</a></div></div><footer class=footer><div class=author></div><p class=author-name><a href=https://twitter.com/monochromegane target=_blank>@monochromegane</a></p><p>monochromegane (モノクロめがね) と申します。</p><p>最近はもっぱらGoに夢中です。普段は研究開発をやっています。</p><ul class=social><li><a href=https://twitter.com/monochromegane target=_blank><i class="fa fa-twitter"></i></a></li><li><a href=https://github.com/monochromegane target=_blank><i class="fa fa-github"></i></a></li><li><a href=/index.xml target=_blank><i class="fa fa-rss"></i></a></li></ul><p class=copyright><small>&copy; <span>Powered by <a href=http://gohugo.io target=_blank>Hugo</a>, Designed by <a href=https://twitter.com/keita_kawamoto target=_blank>&copy;keita_kawamoto</a></span></small></p></footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/go.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/languages/vim.min.js></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-38374674-1','auto');ga('send','pageview');</script></body></html>